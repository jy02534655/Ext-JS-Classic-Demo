Ext.define('Ext.exporter.excel.PivotXlsx',{extend:'Ext.exporter.Base',alias:['exporter.pivotxlsx'],requires:['Ext.exporter.file.ooxml.Excel'],config:{titleStyle:{alignment:{horizontal:'Center',vertical:'Center'},font:{fontName:'Arial',family:'Swiss',size:18,color:'#1F497D'}},matrix:null,pivotTableStyle:{name:'PivotStyleMedium7'}},fileName:'export.xlsx',charset:'ascii',mimeType:'application/zip',binary:!0,aggregateMap:{avg:'average',sum:'sum',count:'count',countNumbers:'countNums',min:'min',max:'max',variance:'var',varianceP:'varp',stdDev:'stdDev',stdDevP:'stdDevp'},titleRowHeight:22.5,columnLabelsText:'Column Labels',rowLabelsText:'Row Labels',valuesText:'Values',totalText:'Total',grandTotalText:'Grand total',getContent:function(){var c=this,e=c.getMatrix(),a,f,g,b,d;a=new Ext.exporter.file.ooxml.Excel({properties:{title:c.getTitle(),author:c.getAuthor()}});b=e&&e.store;if(!e||!b||!b.isStore||b.isDestroyed){a.addWorksheet({rows:[{cells:'Unable to export the pivot table since no raw data is available'}]});return a.render()}f=a.addWorksheet();g=a.addWorksheet();d=c.generateDataSheet({store:b,worksheet:g});c.generatePivotSheet({worksheet:f,data:d});d=a.render();a.destroy();return d},generateDataSheet:function(c){var d=c.store,b=c.worksheet,a;a=this.buildStoreRows(d);a.worksheet=b;b.beginRowRendering();b.renderRows([a.fields]);b.renderRows(a.rows);b.endRowRendering();return a},generatePivotSheet:function(d){var a=this,c=a._matrix,e=d.worksheet,b=d.data;e.beginRowRendering();a.generatePivotSheetTitle(e);a.setupUniqueAggregateNames(b.fields);a.setupUniqueValues(c.aggregate,b.uniqueValues);a.setupUniqueValues(c.leftAxis.dimensions,b.uniqueValues);a.setupUniqueValues(c.topAxis.dimensions,b.uniqueValues);a.generatePivotSheetData(d);e.endRowRendering()},generatePivotSheetTitle:function(a){a.renderRow({height:this.titleRowHeight,cells:[{mergeAcross:5,value:this.getTitle(),styleId:a.getWorkbook().addCellStyle(this.getTitleStyle())}]})},generatePivotSheetData:function(a){var b=this,c=a.worksheet;b.generatePivotConfig(a);b.generatePivotLocation(a);b.generatePivotDataFields(a);b.generatePivotFields(a);b.generatePivotRowFields(a);b.generatePivotColumnFields(a);c.addPivotTable(a.pivotConfig)},generatePivotConfig:function(d){var c=this._matrix,e=d.data,b=e.worksheet,f=c.leftAxis.dimensions.items.length,a;a=d.pivotConfig={grandTotalCaption:c.textGrandTotalTpl,location:{ref:'',firstHeaderRow:1,firstDataRow:1,firstDataCol:1},cacheDefinition:{cacheSource:{worksheetSource:{ref:b.getTopLeftRef()+':'+b.getBottomRightRef(),sheet:b.getName()}},cacheFields:[],cacheRecords:{items:e.cache}},pivotTableStyleInfo:this.getPivotTableStyle(),pivotFields:[],rowFields:[],colFields:[],dataFields:[],rowItems:[],colItems:[]};a.rowHeaderCaption=this.rowLabelsText;a.colHeaderCaption=this.columnLabelsText;a.viewLayoutType=c.viewLayoutType},generatePivotLocation:function(a){var b=this,g=b._matrix,o=a.worksheet,f=a.pivotConfig.location,h=a.data.uniqueValues,e=g.aggregate.items.length,c=g.leftAxis.dimensions.items.length,d=g.topAxis.dimensions.items.length,j,p,q,l,i,n,k,m;a.header=[];a.body=[];a.totals=[];a.dataIndexes=[];a.columns=[];if(c===0&&d===0){if(e===0){b.generatePivotDataEmpty(a)}else {b.generatePivotDataAgg(a)}}else {f.firstDataRow+=d+(e>1?1:0);f.firstDataCol=1;f.firstHeaderRow=1;b.generatePivotHeader(a);if(e===0){if(d&&c){b.generatePivotDataLeftTopAgg(a)}else if(c){b.generatePivotDataLeft(a)}else {b.generatePivotDataTop(a)}}else {if(d&&c){b.generatePivotDataLeftTopAgg(a)}else if(c){b.generatePivotDataLeftAgg(a)}else {b.generatePivotDataTopAgg(a)}}b.generatePivotBody(a);b.generatePivotRowTotals(a)}b.generatePivotData(a)},generatePivotDataEmpty:function(b){var a;b.header.push({cells:[null,null,null]});for(a=0;a<17;a++){b.header.push({cells:[null,null,null]})}},generatePivotDataAgg:function(h){var a=this._matrix,i=h.pivotConfig.location,g=a.aggregate.items.length,j,k,b,f,e,c,d;f={cells:[{value:null}]};e={cells:[{value:this.totalText}]};h.header.push(f,e);for(b=0;b<g;b++){d=a.aggregate.items[b];f.cells.push({value:d.excelName});c=a.results.items.map[a.grandTotalKey+'/'+a.grandTotalKey];e.cells.push({value:c?c.values[d.id]:null})}if(g>1){i.firstHeaderRow=0}},generatePivotDataLeftTopAgg:function(e){var b=this._matrix,m=e.pivotConfig,o=m.location,h=m.viewLayoutType,g=b.aggregate.items.length,f=b.leftAxis.dimensions.items.length,n=b.topAxis.dimensions.items.length,l=e.dataIndexes,d=e.header,k=d[0],j=d.length,a,c,i;for(a=0;a<j;a++){if(h==='compact'){Ext.Array.insert(d[a].cells,0,[{value:a===j-1?this.rowLabelsText:(a===0&&g===1?b.aggregate.items[0].excelName:null)}])}else {for(c=0;c<f;c++){if(a===0&&c===0&&g===1){i={value:b.aggregate.items[0].excelName}}else {i={value:a===j-1?b.leftAxis.dimensions.items[c].dataIndex:null}}Ext.Array.insert(d[a].cells,c,[i])}}}if(h==='compact'){k.cells.push({value:this.columnLabelsText});Ext.Array.insert(l,0,[{aggregate:!1,dataIndex:b.compactViewKey}])}else {for(a=0;a<f;a++){Ext.Array.insert(l,a,[{aggregate:!1,dataIndex:b.leftAxis.dimensions.items[a].id}])}for(a=0;a<n;a++){k.cells.push({value:b.topAxis.dimensions.items[a].dataIndex})}if(g>1){k.cells.push({value:this.valuesText})}}this.generatePivotColTotals(e,d[1]);o.firstDataCol=(h==='compact'?1:f)},generatePivotDataLeftTop:function(e){var b=this._matrix,j=e.pivotConfig,m=j.location,g=j.viewLayoutType,f=b.leftAxis.dimensions.items.length,l=b.topAxis.dimensions.items.length,i=e.dataIndexes,c=e.header,k=c[0],h=c.length,a,d;for(a=0;a<h;a++){if(g==='compact'){Ext.Array.insert(c[a].cells,0,[{value:a===h-1?this.rowLabelsText:null}])}else {for(d=0;d<f;d++){Ext.Array.insert(c[a].cells,d,[{value:a===h-1?b.leftAxis.dimensions.items[d].dataIndex:null}])}}}if(g==='compact'){k.cells.push({value:this.columnLabelsText});Ext.Array.insert(i,0,[{aggregate:!1,dataIndex:b.compactViewKey}])}else {for(a=0;a<f;a++){Ext.Array.insert(i,a,[{aggregate:!1,dataIndex:b.leftAxis.dimensions.items[a].id}])}for(a=0;a<l;a++){k.cells.push({value:b.topAxis.dimensions.items[a].dataIndex})}}this.generatePivotColTotals(e,c[1]);m.firstDataCol=(g==='compact'?1:f)},generatePivotDataLeftAgg:function(b){var a=this._matrix,h=b.pivotConfig,d=h.location,j=h.viewLayoutType,k=a.aggregate.items.length,i=a.leftAxis.dimensions.items.length,g=b.dataIndexes,f=b.header[0],c,e;if(j==='compact'){f.cells.push({value:this.rowLabelsText});g.push({aggregate:!1,dataIndex:a.compactViewKey})}else {for(c=0;c<i;c++){e=a.leftAxis.dimensions.items[c];f.cells.push({value:e.dataIndex});g.push({aggregate:!1,dataIndex:e.id})}}this.generatePivotColTotals(b,f);d.firstHeaderRow=k>1?0:1;d.firstDataRow=1;d.firstDataCol=(j==='compact'?1:i)},generatePivotDataLeft:function(d){var c=this._matrix,f=d.pivotConfig,j=f.location,h=f.viewLayoutType,g=c.leftAxis.dimensions.items.length,i=d.header[0],b=d.dataIndexes,a,e;if(h==='compact'){i.cells.push({value:this.rowLabelsText});b.push({aggregate:!1,dataIndex:c.compactViewKey})}else {for(a=0;a<g;a++){e=c.leftAxis.dimensions.items[a];i.cells.push({value:e.dataIndex});b.push({aggregate:!1,dataIndex:e.id})}}b.push({aggregate:!1});j.firstDataCol=(h==='compact'?1:g)},generatePivotDataTopAgg:function(c){var b=this._matrix,i=c.pivotConfig,g=i.viewLayoutType,f=b.aggregate.items.length,j=b.topAxis.dimensions.items.length,h=c.dataIndexes,d=c.header,e=d[0],k=d.length,a;for(a=0;a<k;a++){Ext.Array.insert(d[a].cells,0,[{value:f===1&&a===0?b.aggregate.items[0].excelName:null}])}Ext.Array.insert(h,0,[{aggregate:!1,dataIndex:g==='compact'?b.compactViewKey:''}]);if(g==='compact'){e.cells.push({value:this.columnLabelsText})}else {for(a=0;a<j;a++){e.cells.push({value:b.topAxis.dimensions.items[a].dataIndex})}if(f>1){e.cells.push({value:this.valuesText})}}this.generatePivotColTotals(c,d[1])},generatePivotDataTop:function(b){var d=this._matrix,e=b.pivotConfig,g=e.location,h=e.viewLayoutType,f=d.topAxis.dimensions.items.length,j=b.dataIndexes,c=b.header,i=c[0],k=c.length,a;Ext.Array.insert(j,0,[{aggregate:!1,dataIndex:h==='compact'?d.compactViewKey:''}]);for(a=0;a<k;a++){Ext.Array.insert(c[a].cells,0,[{value:null}])}if(h==='compact'){i.cells.push({value:this.columnLabelsText})}else {for(a=0;a<f;a++){i.cells.push({value:d.topAxis.dimensions.items[a].dataIndex})}}this.generatePivotColTotals(b,c[1]);g.firstDataCol=1;g.firstDataRow=f+1},generatePivotHeader:function(a){var j=this,c=a.columns,g,d,e,b,i,f,h;j.generateTopAxisColumns(a,-1);g=a.header;g.push({cells:[]});b=c.length;for(d=0;d<b;d++){h={cells:[]};f=c[d];i=f.length;for(e=0;e<i;e++){h.cells.push({value:f[e].value})}g.push(h)}if(b){a.pivotConfig.colItems=Ext.Array.pluck(c[b-1],'colItem');a.dataIndexes=c[b-1]}},generatePivotBody:function(e,a){var d=this._matrix,b,c;if(!a){a=d.leftAxis.getTree()}c=a.length;for(b=0;b<c;b++){this.generatePivotBodyItem(e,a[b])}},generatePivotBodyItem:function(a,b){var l=this._matrix,q=a.worksheet,m=a.data.uniqueValues,i=a.dataIndexes,o=i.length,k=a.pivotConfig.viewLayoutType,p=a.body,n=a.pivotConfig.rowItems,f,d,c,g,j,h,e;j={r:b.level,x:[Ext.Array.indexOf(m[b.dimension.dataIndex],b.value)]};h={cells:[]};for(f=0;f<o;f++){d=i[f];c={value:null};if(d.aggregate){g=l.results.items.map[b.key+'/'+d.key];c.value=g?g.values[d.dataIndex]:null}else if(d.dataIndex===b.dimensionId){c.value=b.value}else if(k==='compact'&&d.dataIndex===l.compactViewKey){a.styles=a.styles||{};e='level'+b.level;a.styles[e]=a.styles[e]||q.getWorkbook().addCellStyle({alignment:{horizontal:'left',indent:b.level*2}});c.styleId=a.styles[e];c.value=b.value}h.cells.push(c)}n.push(j);p.push(h);if(b.children){if(k==='tabular'){this.generatePivotBodyTabularItem(a,b,b)}else {this.generatePivotBody(a,b.children)}}},generatePivotBodyTabularItem:function(f,e){var o=this._matrix,m=f.data.uniqueValues,p=e.children,r=p.length,k=f.dataIndexes,n=k.length,l=f.body,i=l[l.length-1].cells,j=f.pivotConfig.rowItems,q=j[j.length-1],h,c,a,d,g,b;for(h=0;h<r;h++){b=p[h];if(h===0){q.x.push(Ext.Array.indexOf(m[b.dimension.dataIndex],b.value));for(c=0;c<n;c++){a=k[c];d=i[c];if(a.aggregate){g=o.results.items.map[b.key+'/'+a.key];d.value=g?g.values[a.dataIndex]:null}else if(a.dataIndex===b.dimensionId){d.value=b.value}}if(b.children){this.generatePivotBodyTabularItem(f,b)}}else {this.generatePivotBodyItem(f,b)}}j.push({r:e.level,t:'default',x:[Ext.Array.indexOf(m[e.dimension.dataIndex],e.value)]});i=[];for(c=0;c<n;c++){a=k[c];d={value:null};if(a.aggregate){g=o.results.items.map[e.key+'/'+a.key];d.value=g?g.values[a.dataIndex]:null}else if(a.dataIndex===e.dimensionId){d.value=e.data[a.dataIndex]+' '+this.totalText}i.push(d)}l.push({cells:i})},generatePivotRowTotals:function(e){var b=this._matrix,j=b.aggregate.items.length,i=b.leftAxis.dimensions.items.length,g=e.dataIndexes,l=g.length,m=e.totals,h=[],k=e.pivotConfig.rowItems,p,a,o,n,d,c,f;for(a=0;a<l;a++){d=g[a];c={value:null};if(a===0){c.value=i?this.grandTotalText:(j?this.totalText:null)}else if(d.aggregate){f=b.results.items.map[b.grandTotalKey+'/'+d.key];c.value=f?f.values[d.dataIndex]:null}h.push(c)}m.push({cells:h});k.push({t:'grand',x:0})},generatePivotColTotals:function(i,h){var b=this._matrix,g=i.pivotConfig.colItems,e=i.dataIndexes,f=b.aggregate.items,d=b.aggregate.items.length,j=b.topAxis.dimensions.items.length,a,c;if(j===0){for(a=0;a<d;a++){c=f[a];h.cells.push({value:c.excelName});e.push({aggregate:!0,key:b.grandTotalKey,dataIndex:c.id});g.push({t:'grand',i:a,x:0})}}else {if(d<=1){h.cells.push({value:this.grandTotalText});e.push({aggregate:!0,key:b.grandTotalKey,dataIndex:d?f[0].id:''});g.push({t:'grand',x:0})}else {for(a=0;a<d;a++){c=f[a];h.cells.push({value:this.totalText+' '+c.excelName});e.push({aggregate:!0,key:b.grandTotalKey,dataIndex:c.id});g.push({t:'grand',i:a,x:0})}}}},generatePivotData:function(a){var c=a.worksheet,d=a.pivotConfig.location,e,b,f;e=a.header.length;for(b=0;b<e;b++){f=c.renderRow(a.header[b]);if(b===0){d.ref=f.first+':'}}c.renderRows(a.body);c.renderRows(a.totals);d.ref+=c.getBottomRightRef()},generatePivotDataFields:function(d){var c=this._matrix,g=d.data.fields,f=this.aggregateMap,e=c.aggregate.items.length,b,a;for(b=0;b<e;b++){a=c.aggregate.items[b];d.pivotConfig.dataFields.push({name:a.excelName,fld:Ext.Array.indexOf(g,a.dataIndex),subtotal:f[a.aggregator]||'sum',baseField:0,baseItem:0})}},generatePivotFields:function(h){var f=this,e=f._matrix,l=h.data,j=l.fields,i=l.uniqueValues,n=e.aggregate.items.length,g,d,m,k,c,b,a;m=j.length;for(g=0;g<m;g++){c=j[g];b={showAll:!1};for(d=0;d<n;d++){a=e.aggregate.items[d];if(a.dataIndex===c){b.dataField=!0;break}}if(a=f.getDimension(e.aggregate,c)){}else if(a=f.getDimension(e.leftAxis.dimensions,c)){b.axis='axisRow';if(a.getSortable()){b.sortType=(a.direction==='ASC'?'ascending':'descending')}else {b.sortType='manual'}}else if(a=f.getDimension(e.topAxis.dimensions,c)){b.axis='axisCol';if(a.getSortable()){b.sortType=(a.direction==='ASC'?'ascending':'descending')}else {b.sortType='manual'}}if(a){b.items=[];k=i[c].length;for(d=0;d<k;d++){b.items.push({x:d})}b.items.push({t:'default'})}h.pivotConfig.cacheDefinition.cacheFields.push({name:c,sharedItems:{items:a&&!a.isAggregate?i[c]:[]}});h.pivotConfig.pivotFields.push(b)}},generatePivotRowFields:function(c){var b=this._matrix,e=c.data.fields,d=b.leftAxis.dimensions.items.length,a;for(a=0;a<d;a++){c.pivotConfig.rowFields.push({x:Ext.Array.indexOf(e,b.leftAxis.dimensions.items[a].dataIndex)})}},generatePivotColumnFields:function(c){var b=this._matrix,f=c.data.fields,d=b.aggregate.items.length,e=b.topAxis.dimensions.items.length,a;for(a=0;a<e;a++){c.pivotConfig.colFields.push({x:Ext.Array.indexOf(f,b.topAxis.dimensions.items[a].dataIndex)})}if(d>1){c.pivotConfig.colFields.push({x:-2})}},buildStoreRows:function(h){var a={rows:[],cache:[],fields:[],uniqueValues:{}},f,b,e,i,k,c,j,l,d,g;f=h.model.getFields();i=f.length;for(b=0;b<i;b++){c=f[b].getName();a.fields.push(c);a.uniqueValues[c]=[]}k=h.data.length;for(b=0;b<k;b++){j=[];g=[];l=h.data.items[b];for(e=0;e<i;e++){c=a.fields[e];d=l.get(c);j.push({value:d});g.push(d);if(Ext.Array.indexOf(a.uniqueValues[c],d)===-1){a.uniqueValues[c].push(d)}}a.rows.push(j);a.cache.push(g)}return a},setupUniqueAggregateNames:function(h){var g=this._matrix.aggregate,k=g.getCount(),j=h.length,i=[],e,d,b,c,f,a;for(d=0;d<k;d++){c=g.getAt(d);f=c.dataIndex||c.header;a=f;e=2;for(b=0;b<j;b++){if(String(a).toLowerCase()===String(h[b]).toLowerCase()||Ext.Array.indexOf(i,a)>=0){a=f+e;e++;b=-1}}i.push(a);c.excelName=a}},setupUniqueValues:function(e,d){var c=e.items,f=c.length,a,b;for(a=0;a<f;a++){b=c[a];d[b.dataIndex]=Ext.Array.pluck(b.values.items,'value')}},getDimension:function(a,c){var b=a.findIndex('dataIndex',c,0,!1,!0);return b>=0?a.getAt(b):null},generateTopAxisColumns:function(q,g,o){var s=this._matrix,u=q.data.uniqueValues,b=q.columns,n=s.aggregate.items,m=[],p,a,j,t,h,k,d,i,e,c,f,l,r;if(!o){o=s.topAxis.getTree()}t=o.length;h=n.length;for(p=0;p<t;p++){d=o[p];r=Ext.Array.indexOf(u[d.dimension.dataIndex],d.value);c=d.level;b[c]=b[c]||[];e={value:d.value==null?'(blank)':d.value,index:r};b[c].push(e);if(d.children){l=this.generateTopAxisColumns(q,g,d.children);k=l.length;for(a=1;a<k;a++){b[c].push({value:'',empty:!0})}for(a=0;a<h;a++){i=n[a];f={value:e.value+' '+(i.excelName)};b[c].push(f);l.push(f);k=b.length;for(j=c+1;j<k;j++){if(j===k-1){b[j].push({aggregate:!0,value:'',key:d.key,dataIndex:i.id,colItem:{t:'default',i:a,x:r}})}else {b[j].push({value:'',empty:!0})}}}Ext.Array.insert(m,m.length,l);g+=l.length}else {if(h<=1){m.push(e);g++;e.aggregate=!0;e.colItem=this.getColItem(g,0,b)}if(h===1){e.key=d.key;e.dataIndex=n[0].id}else if(h>1){c++;b[c]=b[c]||[];for(a=0;a<h;a++){i=n[a];g++;f={aggregate:!0,value:i.excelName,index:a,key:d.key,dataIndex:i.id};b[c].push(f);f.colItem=this.getColItem(g,a,b);m.push(f);if(a>0){b[c-1].push({value:'',empty:!0})}}}}}return m},getColItem:function(h,g,d){var c={i:g},e=0,f=[],i=d.length,b,a;for(b=0;b<i;b++){a=d[b][h];if(a){if(!a.empty){f.push(a.index)}else {}}else {e++}}c.r=e;c.x=f;return c}});Ext.define('Ext.pivot.Aggregators',{alternateClassName:['Mz.aggregate.Aggregators'],singleton:!0,customText:'Custom',sumText:'Sum',avgText:'Avg',minText:'Min',maxText:'Max',countText:'Count',countNumbersText:'Count numbers',groupSumPercentageText:'Group sum percentage',groupCountPercentageText:'Group count percentage',varianceText:'Var',variancePText:'Varp',stdDevText:'StdDev',stdDevPText:'StdDevp',sum:function(d,e,g,i,h){var f=d.length,a=g.calculateAsExcel?null:0,c,b;for(c=0;c<f;c++){b=d[c].get(e);if(b!==null){if(a===null){a=0}if(typeof b==='number'){a+=b}}}return a},avg:function(f,h,i,k,j){var g=f.length,e=i.calculateAsExcel,a=e?null:0,b=0,c,d;for(c=0;c<g;c++){d=f[c].get(h);if(typeof d==='number'){if(a===null){a=0}a+=d;b++}}if(!e){b=g}return (b>0&&a!==null)?(a/b):null},min:function(e,f,h,j,i){var g=e.length,b=null,d,a,c;for(d=0;d<g;d++){a=e[d].get(f);c=!0;if(h.calculateAsExcel){if(a!==null){if(typeof a!=='number'){a=0;c=!1}if(b===null){b=a}}else {c=!1}}if(c&&a<b){b=a}}return b},max:function(e,f,h,j,i){var g=e.length,b=null,d,a,c;for(d=0;d<g;d++){a=e[d].get(f);c=!0;if(h.calculateAsExcel){if(a!==null){if(typeof a!=='number'){a=0;c=!1}if(b===null){b=a}}else {c=!1}}if(c&&a>b){b=a}}return b},count:function(c,f,g,i,h){var d=c.length,a=null,b,e;if(g.calculateAsExcel){for(b=0;b<d;b++){e=c[b].get(f);if(e!==null){if(a===null){a=0}a++}}}else {a=d}return a},countNumbers:function(d,e,g,i,h){var f=d.length,a=null,b,c;for(b=0;b<f;b++){c=d[b].get(e);if(c!==null){if(a===null){a=0}if(typeof c==='number'){a++}}}return g.calculateAsExcel?a:a||0},groupSumPercentage:function(k,i,d,h,g){var j=Ext.pivot.Aggregators.sum,l=k.length,a=h.split(d.keysSeparator),f=null,c=null,e,b;if(!l){return null}a.pop();a=a.join(d.keysSeparator);if(Ext.isEmpty(a)){a=d.grandTotalKey}e=d.results.get(h,g);if(e){if(e.hasValue('groupSum')){f=e.getValue('groupSum')}else {f=e.calculateByFn('groupSum',i,j)}}b=d.results.get(a,g);if(b){if(b.hasValue('groupSum')){c=b.getValue('groupSum')}else {c=b.calculateByFn('groupSum',i,j)}}return (c!==null&&f!==null&&c!==0)?f/c*100:null},groupCountPercentage:function(k,j,d,h,g){var i=Ext.pivot.Aggregators.count,l=k.length,a=h.split(d.keysSeparator),f=null,c=null,e,b;if(!l){return null}a.pop();a=a.join(d.keysSeparator);if(Ext.isEmpty(a)){a=d.grandTotalKey}e=d.results.get(h,g);if(e){if(e.hasValue('groupCount')){f=e.getValue('groupCount')}else {f=e.calculateByFn('groupCount',j,i)}}b=d.results.get(a,g);if(b){if(b.hasValue('groupCount')){c=b.getValue('groupCount')}else {c=b.calculateByFn('groupCount',j,i)}}return (c!==null&&f!==null&&c!==0)?f/c*100:null},variance:function(e,i,k,m,l){var g=k.calculateAsExcel,c=Ext.pivot.Aggregators,h=g?c.countNumbers.apply(c,arguments):e.length,f=c.avg.apply(c,arguments),j=e.length,a=0,d,b;if(f>0){for(d=0;d<j;d++){b=e[d].get(i);if(g){if(typeof b==='number'){a+=Math.pow(b-f,2)}}else {a+=Math.pow(Ext.Number.from(b,0)-f,2)}}}return (a>0&&h>1)?(a/(h-1)):null},varianceP:function(e,i,k,m,l){var g=k.calculateAsExcel,c=Ext.pivot.Aggregators,h=g?c.countNumbers.apply(c,arguments):e.length,f=c.avg.apply(c,arguments),j=e.length,a=0,d,b;if(f>0){for(d=0;d<j;d++){b=e[d].get(i);if(g){if(typeof b==='number'){a+=Math.pow(b-f,2)}}else {a+=Math.pow(Ext.Number.from(b,0)-f,2)}}}return (a>0&&h>0)?(a/h):null},stdDev:function(f,e,g,d,c){var a=Ext.pivot.Aggregators,b=a.variance.apply(a,arguments);return b>0?Math.sqrt(b):null},stdDevP:function(f,e,g,d,c){var a=Ext.pivot.Aggregators,b=a.varianceP.apply(a,arguments);return b>0?Math.sqrt(b):null}});Ext.define('Ext.pivot.MixedCollection',{extend:'Ext.util.MixedCollection',alternateClassName:['Mz.aggregate.MixedCollection'],removeAt:function(a){Ext.destroy(this.callParent(arguments))},clear:function(){this.destroyItems();this.callParent(arguments)},removeAll:function(){this.destroyItems();this.callParent(arguments)},destroy:function(){this.clear()},destroyItems:function(){var b=this.items,d,a,c;if(b){d=b.length;for(a=0;a<d;a++){c=b[a];if(c.destroy){c.destroy()}}}}});Ext.define('Ext.pivot.filter.Base',{alternateClassName:['Mz.aggregate.filter.Abstract'],alias:'pivotfilter.base',mixins:['Ext.mixin.Factoryable'],isFilter:!0,operator:null,value:null,caseSensitive:!0,parent:null,constructor:function(a){var c=this,b=Ext.util.Format;c.thousandRe=new RegExp('['+b.thousandSeparator+']','g');c.decimalRe=new RegExp('['+b.decimalSeparator+']');Ext.apply(this,a);return this.callParent([a])},destroy:function(){var a=this;a.parent=a.thousandRe=a.decimalRe=null;a.callParent()},serialize:function(){var a=this;return Ext.apply({type:a.type,operator:a.operator,value:a.value,caseSensitive:a.caseSensitive},a.getSerialArgs()||{})},getSerialArgs:Ext.emptyFn,isMatch:function(f){var a=this,b=a.value,c,d,e,g,h;b=(Ext.isArray(b)?b[0]:b)||'';c=a.compare(f,b);if(a.operator=='='){return (c===0)}if(a.operator=='!='){return (c!==0)}if(a.operator=='>'){return (c>0)}if(a.operator=='>='){return (c>=0)}if(a.operator=='<'){return (c<0)}if(a.operator=='<='){return (c<=0)}b=a.value;g=(Ext.isArray(b)?b[0]:b)||'';h=(Ext.isArray(b)?b[1]:b)||'';d=a.compare(f,g);e=a.compare(f,h);if(a.operator=='between'){return (d>=0&&e<=0)}if(a.operator=='not between'){return !(d>=0&&e<=0)}return !0},parseNumber:function(a){var b;if(typeof a==='number'){return a}if(Ext.isEmpty(a)){a=''}b=String(a).replace(this.thousandRe,'');b=b.replace(this.decimalRe,'.');if(Ext.isNumeric(b)){return parseFloat(b)}return null},compare:function(a,b){var c=Ext.pivot.matrix.Base.prototype.naturalSort,d=this.parseNumber(a),e=this.parseNumber(b);if(Ext.isNumber(d)&&Ext.isNumber(e)){return c(d,e)}if(Ext.isDate(a)){if(Ext.isDate(b)){return c(a,b)}else {return c(a,Ext.Date.parse(b,Ext.Date.defaultFormat))}}return (this.caseSensitive?c(a||'',b||''):c(String(a||'').toLowerCase(),String(b||'').toLowerCase()))},deprecated:{'6.0':{properties:{mztype:null,from:null,to:null}}}});Ext.define('Ext.pivot.filter.Label',{alternateClassName:['Mz.aggregate.filter.Label'],extend:'Ext.pivot.filter.Base',alias:'pivotfilter.label',isMatch:function(b){var a=this,c;if(a.operator=='begins'){return Ext.String.startsWith(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='not begins'){return !Ext.String.startsWith(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='ends'){return Ext.String.endsWith(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='not ends'){return !Ext.String.endsWith(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='contains'){return a.stringContains(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='not contains'){return !a.stringContains(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='in'){return a.foundInArray(a.value)}if(a.operator=='not in'){return !a.foundInArray(a.value)}return a.callParent(arguments)},foundInArray:function(d){var c=Ext.Array.from(this.value),e=c.length,a=!1,b;if(this.caseSensitive){return Ext.Array.indexOf(c,d)>=0}else {for(b=0;b<e;b++){a=a||(String(d).toLowerCase()==String(c[b]).toLowerCase());if(a){break}}return a}},stringContains:function(b,a,d){var c=(a.length<=b.length);if(c){if(d){b=b.toLowerCase();a=a.toLowerCase()}c=(b.lastIndexOf(a)>=0)}return c},deprecated:{'6.0':{methods:{startsWith:Ext.emptyFn,endsWith:Ext.emptyFn}}}});Ext.define('Ext.pivot.filter.Value',{alternateClassName:['Mz.aggregate.filter.Value'],extend:'Ext.pivot.filter.Base',alias:'pivotfilter.value',dimensionId:'',topType:'items',topOrder:'top',topSort:!0,isTopFilter:!1,constructor:function(a){var b=this.callParent([a]);this.isTopFilter=(this.operator==='top10');return b},destroy:function(){this.dimension=null;this.callParent()},getDimension:function(){return this.parent.matrix.aggregate.getByKey(this.dimensionId)},getSerialArgs:function(){var a=this;return {dimensionId:a.dimensionId,topType:a.topType,topOrder:a.topOrder,topSort:a.topSort}},applyFilter:function(e,d){var a=this,b=a.topSort?d:Ext.Array.clone(d),c=[];if(d.length==0){return c}a.sortItemsByGrandTotal(e,b);switch(a.topType){case 'items':c=a.extractTop10Items(b);break;case 'sum':c=a.extractTop10Sum(b);break;case 'percent':c=a.extractTop10Percent(e,b);break;}if(!a.topSort){b.length=0}return c},extractTop10Items:function(b){var d=this,c=[],a;for(a=0;a<b.length;a++){if(c.indexOf(b[a]['tempVar'])<0){c.push(b[a]['tempVar']);if(c.length>d.value||(d.value<a+1&&a>0)){break}}}return Ext.Array.slice(b,a)},extractTop10Sum:function(b){var d=this,c=0,a;for(a=0;a<b.length;a++){c+=b[a]['tempVar'];if(c>=d.value){break}}return Ext.Array.slice(b,a+1)},extractTop10Percent:function(a,c){var k=this,j=0,f=c[0].key.split(a.matrix.keysSeparator),b,h,i,d,e,g;f.length--;d=(f.length>0?f.join(a.matrix.keysSeparator):a.matrix.grandTotalKey);h=(a.isLeftAxis?d:a.matrix.grandTotalKey);i=(a.isLeftAxis?a.matrix.grandTotalKey:d);e=a.matrix.results.get(h,i);g=(e?e.getValue(k.dimensionId):0);for(b=0;b<c.length;b++){j+=c[b]['tempVar'];if((j*100/g)>=k.value){break}}return Ext.Array.slice(c,b+1)},sortItemsByGrandTotal:function(a,c){var e=this,f,g,d,b;for(b=0;b<c.length;b++){f=(a.isLeftAxis?c[b].key:a.matrix.grandTotalKey);g=(a.isLeftAxis?a.matrix.grandTotalKey:c[b].key);d=a.matrix.results.get(f,g);c[b]['tempVar']=(d?d.getValue(e.dimensionId):0)}Ext.Array.sort(c,function(d,f){var b=a.matrix.naturalSort(d['tempVar'],f['tempVar']);if(b<0&&e.topOrder==='top'){return 1}if(b>0&&e.topOrder==='top'){return -1}return b})}});Ext.define('Ext.pivot.dimension.Item',{alternateClassName:['Mz.aggregate.dimension.Item'],requires:['Ext.pivot.MixedCollection','Ext.pivot.filter.Label','Ext.pivot.filter.Value','Ext.app.bind.Template'],$configPrefixed:!1,$configStrict:!1,config:{id:null,header:'',dataIndex:'',sortIndex:'',width:100,flex:0,align:'left',sortable:!0,direction:'ASC',sorterFn:null,caseSensitiveSort:!0,filter:null,labelRenderer:null,renderer:null,formatter:null,column:null,exportStyle:null,scope:null,grouperFn:null,blankText:'(blank)',showZeroAsBlank:!1,aggregator:'sum',values:[]},isAggregate:!1,matrix:null,constructor:function(b){var a=this;this.initConfig(b);if(!a.getId()){a.setId(Ext.id())}if(!a.grouperFn){a.groupFn=Ext.bind(a.defaultGrouperFn,a)}if(a.sortable){if(!a.sorterFn){a.sortFn=Ext.bind(a.defaultSorterFn,a)}}else {a.sortFn=Ext.bind(a.manualSorterFn,a)}if(Ext.isEmpty(a.getSortIndex())){a.setSortIndex(a.getDataIndex())}if(a.isAggregate&&!a.getFormatter()&&!a.getRenderer()){a.setRenderer(a.getDefaultFormatRenderer('0,000.00'))}return this.callParent([b])},destroy:function(){this.setConfig({values:null,grouperFn:null,sorterFn:null,filter:null,renderer:null,labelRenderer:null,aggregator:null});this.callParent()},serialize:function(){return this.getConfiguration(!0)},getConfiguration:function(b){var c=this,a=c.getConfig();delete (a.values);if(a.filter){a.filter=a.filter.serialize()}if(b&&typeof a.aggregator==='function'){a.aggregator='sum'}if(b&&typeof a.renderer==='function'){a.renderer=null}if(b&&typeof a.labelRenderer==='function'){a.labelRenderer=null}return a},applyId:function(a){return a?a:Ext.id()},updateExportStyle:function(a){if(a&&!a.id){a.id=this.getId()}},applyFilter:function(a,b){if(a==null){return a}if(a&&a.isFilter){a.parent=this;return a}if(Ext.isObject(a)){Ext.applyIf(a,{type:'label',parent:this});a=Ext.Factory.pivotfilter(a)}else {a=!1}return a},updateAggregator:function(a){var b=Ext.pivot.Aggregators;if(Ext.isString(a)&&Ext.isFunction(b[a])){this.aggregatorFn=Ext.bind(b[a],b)}else {this.aggregatorFn=a||'sum'}},updateGrouperFn:function(a){this.groupFn=(Ext.isFunction(a)?Ext.bind(a,this):a)},updateSorterFn:function(a){this.sortFn=(Ext.isFunction(a)?Ext.bind(a,this):a)},addValue:function(a,c){var b=this.values;if(!b.getByKey(a)){b.add({sortValue:a,value:a,display:c})}},applyValues:function(a,c){var b;Ext.destroy(c);if(a&&!a.isInstance){b=new Ext.pivot.MixedCollection();b.getKey=function(b){return b.value};b.addAll(a);return b}return a},sortValues:function(){if(this.sortable){this.values.sortBy(this.sortFn)}},defaultSorterFn:function(e,f){var d=this,a=e.sortValue,b=f.sortValue,c;if(a instanceof Date){a=a.getTime()}if(b instanceof Date){b=b.getTime()}if(!d.caseSensitiveSort){a=typeof a==='string'?a.toUpperCase():a;b=typeof b==='string'?b.toUpperCase():b}if(d.matrix.useNaturalSorting){c=d.matrix.naturalSort(a,b)}else {c=(a===b?0:(a<b?-1:1))}if(c<0&&d.direction==='DESC'){return 1}if(c>0&&d.direction==='DESC'){return -1}return c},manualSorterFn:function(d,e){var a=this.values,b=a?a.indexOfKey(d.value):0,c=a?a.indexOfKey(e.value):0;return (b===c?0:(b<c?-1:1))},getDefaultFormatRenderer:function(a){var b=this;return function(c){var d;if(Ext.isEmpty(a)){return c}if(Ext.isFunction(a)){return a.apply(b,arguments)}if(!Ext.isNumber(c)){return c}if(b.isAggregate&&c===0&&b.showZeroAsBlank){return ''}d=(c>=0);c=Math.abs(c);c=Ext.util.Format.number(c,a);return d?c:'-'+c}},defaultGrouperFn:function(a){return a.get(this.dataIndex)},getFormatterFn:function(){var c=this,a=c.getFormatter(),b;if(a){b=a.indexOf('this.')===0;if(b){a=a.substring(5)}a=Ext.app.bind.Template.prototype.parseFormat(a);if(b){a.scope=null}return function(b){return a.format(b,a.scope||c.getScope()||c.matrix.cmp.resolveListenerScope('self.controller')||this)}}},aggregatorFn:Ext.emptyFn,groupFn:Ext.emptyFn,sortFn:Ext.emptyFn});Ext.define('Ext.pivot.axis.Item',{alternateClassName:['Mz.aggregate.axis.Item'],level:0,key:'',value:'',sortValue:'',name:'',dimensionId:'',dimension:null,children:null,record:null,records:null,axis:null,data:null,expanded:!1,constructor:function(c){var a=this,b;Ext.apply(a,c||{});if(Ext.isEmpty(a.sortValue)){a.sortValue=a.value}b=a.axis;a.expanded=(b&&((b.isLeftAxis&&!b.matrix.collapsibleRows)||(!b.isLeftAxis&&!b.matrix.collapsibleColumns)));a.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.children);a.axis=a.data=a.dimension=a.record=a.children=a.records=null;a.callParent(arguments)},getTextTotal:function(){var a=this,b=Ext.XTemplate.getTpl(a.axis.matrix,'textTotalTpl');return b.apply({groupField:a.dimension.dataIndex,columnName:a.dimension.dataIndex,name:a.name,rows:a.children||[]})},expand:function(b){var a=this;a.expanded=!0;if(b===!0){a.expandCollapseChildrenTree(!0)}a.axis.matrix.fireEvent('groupexpand',a.axis.matrix,(a.axis.isLeftAxis?'row':'col'),a)},collapse:function(b){var a=this;a.expanded=!1;if(b===!0){a.expandCollapseChildrenTree(!1)}a.axis.matrix.fireEvent('groupcollapse',a.axis.matrix,(a.axis.isLeftAxis?'row':'col'),a)},expandCollapseChildrenTree:function(c){var a=this,b;a.expanded=c;if(Ext.isArray(a.children)){for(b=0;b<a.children.length;b++){a.children[b].expandCollapseChildrenTree(c)}}}});Ext.define('Ext.pivot.axis.Base',{alternateClassName:['Mz.aggregate.axis.Abstract'],alias:'pivotaxis.base',mixins:['Ext.mixin.Factoryable'],requires:['Ext.pivot.MixedCollection','Ext.pivot.dimension.Item','Ext.pivot.axis.Item'],dimensions:null,matrix:null,items:null,tree:null,levels:0,isLeftAxis:!1,constructor:function(b){var a=this,d,c;if(!b||!b.matrix){return}a.isLeftAxis=b.isLeftAxis||a.isLeftAxis;a.matrix=b.matrix;a.tree=[];a.dimensions=new Ext.pivot.MixedCollection();a.dimensions.getKey=function(a){return a.getId()};a.items=new Ext.pivot.MixedCollection();a.items.getKey=function(a){return a.key};Ext.Array.each(Ext.Array.from(b.dimensions||[]),a.addDimension,a)},destroy:function(){var a=this;Ext.destroyMembers(a,'dimensions','items','tree');a.matrix=a.dimensions=a.items=a.tree=null},addDimension:function(a){var b=a;if(!a){return}if(!a.isInstance){b=new Ext.pivot.dimension.Item(a)}b.matrix=this.matrix;this.dimensions.add(b)},addItem:function(a){var b=this;if(!Ext.isObject(a)||Ext.isEmpty(a.key)||Ext.isEmpty(a.value)||Ext.isEmpty(a.dimensionId)){return !1}a.key=String(a.key);a.dimension=b.dimensions.getByKey(a.dimensionId);a.name=a.name||Ext.callback(a.dimension.labelRenderer,a.dimension.scope||'self.controller',[a.value],0,b.matrix.cmp)||a.value;a.dimension.addValue(a.value,a.name);a.axis=b;if(!b.items.map[a.key]&&a.dimension){b.items.add(new Ext.pivot.axis.Item(a));return !0}return !1},clear:function(){this.items.clear();this.tree=null},getTree:function(){if(!this.tree){this.buildTree()}return this.tree},expandAll:function(){var a=this,c=a.getTree(),d=c.length,b;for(b=0;b<d;b++){c[b].expandCollapseChildrenTree(!0)}if(d>0){a.matrix.fireEvent('groupexpand',a.matrix,(a.isLeftAxis?'row':'col'),null)}},collapseAll:function(){var a=this,c=a.getTree(),d=c.length,b;for(b=0;b<d;b++){c[b].expandCollapseChildrenTree(!1)}if(d>0){a.matrix.fireEvent('groupcollapse',a.matrix,(a.isLeftAxis?'row':'col'),null)}},findTreeElement:function(d,c){var f=this.items,g=f.getCount(),e=!1,b,a;for(b=0;b<g;b++){a=f.items[b];if(Ext.isDate(c)?Ext.Date.isEqual(a[d],c):a[d]===c){e=!0;break}}return e?{level:a.level,node:a}:null},buildTree:function(){var b=this,e=b.dimensions.items,g=e.length,c,a,f,h,d;for(c=0;c<g;c++){e[c].sortValues()}b.tree=[];e=b.items.items;g=e.length;for(c=0;c<g;c++){a=e[c];f=String(a.key).split(b.matrix.keysSeparator);f=Ext.Array.slice(f,0,f.length-1);h=f.join(b.matrix.keysSeparator);d=b.items.map[h];if(d){a.level=d.level+1;a.data=Ext.clone(d.data||{});d.children=d.children||[];d.children.push(a)}else {a.level=0;a.data={};b.tree.push(a)}a.data[a.dimension.getId()]=a.name;b.levels=Math.max(b.levels,a.level)}b.sortTree()},rebuildTree:function(){var b=this.items.items,c=b.length,a;this.tree=null;for(a=0;a<c;a++){b[a].children=null}this.buildTree()},sortTree:function(){var a=arguments[0]||this.tree,e=a.length,c,b,d;if(a.length>0){c=a[0].dimension}if(c){Ext.Array.sort(a,c.sortFn)}for(b=0;b<e;b++){d=a[b];if(d.children){this.sortTree(d.children)}}},sortTreeByField:function(f,b){var a=this,d=!1,c,g,e;if(f==a.matrix.compactViewKey){d=a.sortTreeByDimension(a.tree,a.dimensions.items,b);g=a.dimensions.items.length;for(e=0;e<g;e++){a.dimensions.items[e].direction=b}}else {b=b||'ASC';c=a.dimensions.getByKey(f);if(c){d=a.sortTreeByDimension(a.tree,c,b);c.direction=b}else {d=a.sortTreeByRecords(a.tree,f,b)}}return d},sortTreeByDimension:function(b,f,g){var c=!1,i=Ext.Array.from(f),a,e,d,h;b=b||[];e=b.length;if(e>0){a=b[0].dimension}if(Ext.Array.indexOf(i,a)>=0){if(a.sortable){h=a.direction;a.direction=g;Ext.Array.sort(b,a.sortFn);a.direction=h}c=a.sortable}for(d=0;d<e;d++){c=this.sortTreeByDimension(b[d].children,f,g)||c}return c},sortTreeByRecords:function(a,d,c){var b,e;a=a||[];e=a.length;if(e<=0){return !1}if(a[0].record){this.sortTreeRecords(a,d,c)}else {this.sortTreeLeaves(a,d,c)}for(b=0;b<e;b++){this.sortTreeByRecords(a[b].children,d,c)}return !0},sortTreeRecords:function(d,b,a){var c=this.matrix.naturalSort;a=a||'ASC';Ext.Array.sort(d||[],function(h,i){var e,f=h.record,g=i.record;if(!(f&&f.isModel&&g&&g.isModel)){return 0}e=c(f.get(b)||'',g.get(b)||'');if(e<0&&a==='DESC'){return 1}if(e>0&&a==='DESC'){return -1}return e})},sortTreeLeaves:function(i,h,a){var g=this.matrix.naturalSort,f=this.matrix.results,b=this.matrix.model,e=Ext.Array.indexOf(Ext.Array.pluck(b,'name'),h),d,c;if(e<0){return !1}d=b[e]['col'];c=b[e]['agg'];a=a||'ASC';Ext.Array.sort(i||[],function(k,l){var j,b,e;b=f.get(k.key,d);if(b){b=b.getValue(c)}else {b=0}e=f.get(l.key,d);if(e){e=e.getValue(c)}else {e=0}j=g(b,e);if(j<0&&a==='DESC'){return 1}if(j>0&&a==='DESC'){return -1}return j})}});Ext.define('Ext.pivot.axis.Local',{alternateClassName:['Mz.aggregate.axis.Local'],extend:'Ext.pivot.axis.Base',alias:'pivotaxis.local',processRecord:function(h){var c=this,i=[],f='',g=!0,j=c.dimensions.items.length,b,d,a,e;for(e=0;e<j;e++){a=c.dimensions.items[e];b=Ext.callback(a.groupFn,a.scope||'self.controller',[h],0,c.matrix.cmp);d=f?f+c.matrix.keysSeparator:'';b=Ext.isEmpty(b)?a.blankText:b;d+=c.matrix.getKey(b);if(a.filter instanceof Ext.pivot.filter.Label){g=a.filter.isMatch(b)}if(!g){break}i.push({value:b,sortValue:h.get(a.sortIndex),key:d,dimensionId:a.getId()});f=d}if(g){return i}else {return null}},buildTree:function(){this.callParent(arguments);this.filterTree()},filterTree:function(){var a=this,d=a.dimensions.items.length,c=!1,b;for(b=0;b<d;b++){c=c||(a.dimensions.items[b].filter instanceof Ext.pivot.filter.Value)}if(!c){return}a.matrix.filterApplied=!0;a.filterTreeItems(a.tree)},filterTreeItems:function(a){var c=this,e,b,d;if(!a||!Ext.isArray(a)||a.length<=0){return}e=a[0].dimension.filter;if(e&&(e instanceof Ext.pivot.filter.Value)){if(e.isTopFilter){d=e.applyFilter(c,a)||[]}else {d=Ext.Array.filter(a,c.canRemoveItem,c)}c.removeRecordsFromResults(d);c.removeItemsFromArray(a,d);for(b=0;b<d.length;b++){c.removeTreeChildren(d[b])}}for(b=0;b<a.length;b++){if(a[b].children){c.filterTreeItems(a[b].children);if(a[b].children.length===0){c.items.remove(a[b]);Ext.Array.erase(a,b,1);b--}}}},removeTreeChildren:function(a){var b,c;if(a.children){c=a.children.length;for(b=0;b<c;b++){this.removeTreeChildren(a.children[b])}}this.items.remove(a)},canRemoveItem:function(b){var a=this,e=(a.isLeftAxis?b.key:a.matrix.grandTotalKey),f=(a.isLeftAxis?a.matrix.grandTotalKey:b.key),d=a.matrix.results.get(e,f),c=b.dimension.filter;return (d?!c.isMatch(d.getValue(c.dimensionId)):!1)},removeItemsFromArray:function(b,c){for(var a=0;a<b.length;a++){if(Ext.Array.indexOf(c,b[a])>=0){Ext.Array.erase(b,a,1);a--}}},removeRecordsFromResults:function(b){for(var a=0;a<b.length;a++){this.removeRecordsByItem(b[a])}},removeRecordsByItem:function(f){var a=this,c,d,b,g,e;if(f.children){a.removeRecordsFromResults(f.children)}if(a.isLeftAxis){e=a.matrix.results.get(f.key,a.matrix.grandTotalKey);b=a.matrix.results.getByLeftKey(a.matrix.grandTotalKey)}else {e=a.matrix.results.get(a.matrix.grandTotalKey,f.key);b=a.matrix.results.getByTopKey(a.matrix.grandTotalKey)}if(!e){return}for(d=0;d<b.length;d++){a.removeItemsFromArray(b[d].records,e.records)}c=f.key.split(a.matrix.keysSeparator);c.length=c.length-1;while(c.length>0){if(a.isLeftAxis){b=a.matrix.results.getByLeftKey(c.join(a.matrix.keysSeparator))}else {b=a.matrix.results.getByTopKey(c.join(a.matrix.keysSeparator))}for(d=0;d<b.length;d++){a.removeItemsFromArray(b[d].records,e.records)}c.length=c.length-1}}});Ext.define('Ext.pivot.feature.PivotStore',{config:{store:null,grid:null,matrix:null,clsGrandTotal:'',clsGroupTotal:''},totalRowEvent:'pivottotal',groupRowEvent:'pivotgroup',itemRowEvent:'pivotitem',constructor:function(a){this.initConfig(a);return this.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.storeListeners,a.matrixListeners);a.setConfig({store:null,matrix:null,grid:null});a.storeInfo=a.storeListeners=null;a.callParent(arguments)},updateStore:function(b){var a=this;Ext.destroy(a.storeListeners);if(b){a.storeListeners=b.on({pivotstoreremodel:a.processStore,scope:a,destroyable:!0})}},updateMatrix:function(b){var a=this;Ext.destroy(a.matrixListeners);if(b){a.matrixListeners=b.on({groupexpand:a.onGroupExpand,groupcollapse:a.onGroupCollapse,scope:a,destroyable:!0})}},processStore:function(){var c=this,b=c.getStore(),e=c.getMatrix(),a=[],f,h,d,i,g;if(!e||!b){return}g=e.getColumns();b.suspendEvents();b.model.replaceFields(g,!0);c.storeInfo={};if(e.rowGrandTotalsPosition=='first'){a.push.apply(a,c.processGrandTotal()||[])}f=e.leftAxis.getTree();h=f.length;for(d=0;d<h;d++){i=f[d];a.push.apply(a,c.processGroup({group:i,previousExpanded:(d>0?f[d-1].expanded:!1)})||[])}if(e.rowGrandTotalsPosition=='last'){a.push.apply(a,c.processGrandTotal()||[])}b.loadData(a);b.resumeEvents();b.fireEvent('refresh',b)},processGroup:function(c){var a=this,b=a['processGroup'+Ext.String.capitalize(a.getMatrix().viewLayoutType)];if(!Ext.isFunction(b)){b=a.processGroupOutline}return b.call(a,c)},processGrandTotal:function(){var c=this,m=!1,b=c.getMatrix(),i={key:b.grandTotalKey},l=[],o=b.totals.length,k=b.leftAxis.dimensions.items,n=k.length,f,d,g,j,h,a,e;for(f=0;f<o;f++){j=b.totals[f];a=j.record;g=n;if(a&&a.isModel){c.storeInfo[a.internalId]={leftKey:i.key,rowStyle:'',rowClasses:[c.getClsGrandTotal()],rowEvent:c.totalRowEvent,rendererParams:{}};for(d=0;d<n;d++){h=k[d];if(b.viewLayoutType=='compact'||d===0){if(b.viewLayoutType=='compact'){e=b.compactViewKey;g=1}else {e=h.getId()}a.data[e]=j.title;c.storeInfo[a.internalId].rendererParams[e]={fn:'groupOutlineRenderer',group:i,colspan:g,hidden:!1,subtotalRow:!0};m=!0}else {c.storeInfo[a.internalId].rendererParams[h.id]={fn:'groupOutlineRenderer',group:i,colspan:0,hidden:m,subtotalRow:!0};g--}}c.storeInfo[a.internalId].rendererParams['topaxis']={fn:'topAxisRenderer'};l.push(a)}}return l},processGroupOutline:function(c){var d=this,b=c['group'],a=[];if(b.record){d.processRecordOutline({results:a,group:b})}else {d.processGroupOutlineWithChildren({results:a,group:b,previousExpanded:c.previousExpanded})}return a},processGroupOutlineWithChildren:function(b){var d=this,h=d.getMatrix(),a=b['group'],f=b['previousExpanded'],g,e,c,i;g=(!a.expanded||(a.expanded&&h.rowSubTotalsPosition=='first'));e=a.expanded?a.records.expanded:a.records.collapsed;d.processGroupHeaderRecordOutline({results:b.results,group:a,record:e,previousExpanded:f,hasSummaryData:g});if(a.expanded){if(a.children){i=a.children.length;for(c=0;c<i;c++){if(a.children[c]['children']){d.processGroupOutlineWithChildren({results:b.results,group:a.children[c]})}else {d.processRecordOutline({results:b.results,group:a.children[c]})}}}if(h.rowSubTotalsPosition=='last'){e=a.records.footer;d.processGroupHeaderRecordOutline({results:b.results,group:a,record:e,previousExpanded:f,subtotalRow:!0,hasSummaryData:!0})}}},processGroupHeaderRecordOutline:function(b){var a=this,n=a.getMatrix(),d=b['group'],c=b['record'],g=b['previousExpanded'],h=b['subtotalRow'],m=b['hasSummaryData'],j=n.leftAxis.dimensions.items,k=j.length,l=k,i=!1,f,e;a.storeInfo[c.internalId]={leftKey:d.key,rowStyle:'',rowClasses:[a.getClsGroupTotal()],rowEvent:a.groupRowEvent,rendererParams:{}};for(f=0;f<k;f++){e=j[f];if(e.id==d.dimension.id){a.storeInfo[c.internalId].rendererParams[e.id]={fn:'groupOutlineRenderer',group:d,colspan:l,hidden:!1,previousExpanded:g,subtotalRow:h};i=!0}else {a.storeInfo[c.internalId].rendererParams[e.id]={fn:'groupOutlineRenderer',group:d,colspan:0,hidden:i,previousExpanded:g,subtotalRow:h};l--}}a.storeInfo[c.internalId].rendererParams['topaxis']={fn:(m?'topAxisRenderer':'topAxisNoRenderer'),group:d};b.results.push(c)},processRecordOutline:function(f){var b=this,a=f['group'],g=!1,c=a.record,h=b.getMatrix().leftAxis.dimensions.items,i=h.length,d,e;b.storeInfo[c.internalId]={leftKey:a.key,rowStyle:'',rowClasses:[],rowEvent:b.itemRowEvent,rendererParams:{}};for(d=0;d<i;d++){e=h[d];if(e.id==a.dimension.id){g=!0}b.storeInfo[c.internalId].rendererParams[e.id]={fn:'recordOutlineRenderer',group:a,hidden:!g}}b.storeInfo[c.internalId].rendererParams['topaxis']={fn:'topAxisRenderer',group:a};f.results.push(c)},processGroupCompact:function(c){var d=this,b=c['group'],e=c['previousExpanded'],a=[];if(b.record){d.processRecordCompact({results:a,group:b})}else {d.processGroupCompactWithChildren({results:a,group:b,previousExpanded:e})}return a},processGroupCompactWithChildren:function(b){var d=this,g=d.getMatrix(),a=b['group'],e=b['previousExpanded'],f,c,h;f=(!a.expanded||(a.expanded&&g.rowSubTotalsPosition=='first'));d.processGroupHeaderRecordCompact({results:b.results,group:a,record:a.expanded?a.records.expanded:a.records.collapsed,previousExpanded:e,hasSummaryData:f});if(a.expanded){if(a.children){h=a.children.length;for(c=0;c<h;c++){if(a.children[c]['children']){d.processGroupCompactWithChildren({results:b.results,group:a.children[c]})}else {d.processRecordCompact({results:b.results,group:a.children[c]})}}}if(g.rowSubTotalsPosition=='last'){d.processGroupHeaderRecordCompact({results:b.results,group:a,record:a.records.footer,previousExpanded:e,subtotalRow:!0,hasSummaryData:!0})}}},processGroupHeaderRecordCompact:function(a){var b=this,h=b.getMatrix(),d=a['group'],c=a['record'],e=a['previousExpanded'],g=a['subtotalRow'],f=a['hasSummaryData'];b.storeInfo[c.internalId]={leftKey:d.key,rowStyle:'',rowClasses:[b.getClsGroupTotal()],rowEvent:b.groupRowEvent,rendererParams:{}};b.storeInfo[c.internalId].rendererParams[h.compactViewKey]={fn:'groupCompactRenderer',group:d,colspan:0,previousExpanded:e,subtotalRow:g};b.storeInfo[c.internalId].rendererParams['topaxis']={fn:(f?'topAxisRenderer':'topAxisNoRenderer'),group:d};a.results.push(c)},processRecordCompact:function(d){var a=this,c=d['group'],b=c.record;a.storeInfo[b.internalId]={leftKey:c.key,rowStyle:'',rowClasses:[],rowEvent:a.itemRowEvent,rendererParams:{}};a.storeInfo[b.internalId].rendererParams[a.getMatrix().compactViewKey]={fn:'recordCompactRenderer',group:c};a.storeInfo[b.internalId].rendererParams['topaxis']={fn:'topAxisRenderer',group:c};d.results.push(b)},processGroupTabular:function(c){var d=this,b=c['group'],a=[];if(b.record){d.processRecordTabular({results:a,group:b})}else {d.processGroupTabularWithChildren({results:a,group:b,previousExpanded:c.previousExpanded})}return a},processGroupTabularWithChildren:function(b,i){var d=this,j=d.getMatrix(),a=b['group'],f=b['previousExpanded'],g,e,c,h;if(!i){d.processGroupHeaderRecordTabular({results:b.results,group:a,previousExpanded:f,hasSummaryData:!a.expanded})}if(a.expanded){if(a.children){h=a.children.length;for(e=0;e<h;e++){c=a.children[e];if(e===0&&c.children&&c.expanded){d.processGroupTabularWithChildren({results:b.results,group:c},!0)}else if(e>0){if(c.children){d.processGroupTabularWithChildren({results:b.results,group:c})}else {d.processRecordTabular({results:b.results,group:c})}}}}if(j.rowSubTotalsPosition!=='none'){g=a.records.footer;d.processGroupHeaderRecordTabular({results:b.results,group:a,record:g,previousExpanded:f,subtotalRow:!0,hasSummaryData:!0})}}},getTabularGroupRecord:function(b){var a=b.record;if(!a){if(!b.expanded){a=b.records.collapsed}else {a=this.getTabularGroupRecord(b.children[0])}}return a},processGroupHeaderRecordTabular:function(i){var k=this,f=k.getMatrix(),g=i['group'],b=i['record'],n=i['previousExpanded'],o=i['subtotalRow'],t=i['hasSummaryData'],u=f.leftAxis.dimensions,p=u.length,s=p,m=!1,d={},q=[],r=k.itemRowEvent,h,c,a,j,e,l;if(!b){a=g;b=a.record;while(!b){d[a.dimension.id]={fn:'groupTabularRenderer',group:a,colspan:0,hidden:!1,previousExpanded:n,subtotalRow:o};if(a.children){if(!a.expanded){b=a.records.collapsed;d[a.dimension.id].colspan=p-a.level}else {a=a.children[0]}}else {b=a.record}}m=!1;for(h=0;h<p;h++){c=f.leftAxis.dimensions.items[h];if(d[c.id]){b.data[c.id]=d[c.id].group.name;m=!0}else if(m){d[c.id]={fn:'groupTabularRenderer',group:g,colspan:0,hidden:!0,previousExpanded:n,subtotalRow:o}}else {b.data[c.id]=''}}if(g.level>0){l=g;j=l.key.split(f.keysSeparator);j.length--;e=f.leftAxis.items.getByKey(j.join(f.keysSeparator));while(e&&e.children[0]==l){d[e.dimension.id]={fn:'groupTabularRenderer',group:e,colspan:0,hidden:!1,previousExpanded:n,subtotalRow:o};b.data[e.dimension.id]=e.name;l=e;j=l.key.split(f.keysSeparator);j.length--;e=f.leftAxis.items.getByKey(j.join(f.keysSeparator))}}}else {for(h=0;h<p;h++){c=f.leftAxis.dimensions.items[h];d[c.id]={fn:'groupTabularRenderer',group:g,colspan:0,hidden:!1,previousExpanded:n,subtotalRow:o};if(c.id==g.dimension.id){d[c.id].colspan=s;m=!0}else {d[c.id].hidden=m;s--}}a=g}if(t){q.push(k.getClsGroupTotal());r=k.groupRowEvent}k.storeInfo[b.internalId]={leftKey:g.key,rowStyle:'',rowClasses:q,rowEvent:r,rendererParams:d};k.storeInfo[b.internalId].rendererParams['topaxis']={fn:'topAxisRenderer',group:a};i.results.push(b)},processRecordTabular:function(f){var c=this,b=f['group'],g=!1,a=b.record,h=c.getMatrix().leftAxis.dimensions.items,i=h.length,e,d;c.storeInfo[a.internalId]={leftKey:b.key,rowStyle:'',rowClasses:[],rowEvent:c.itemRowEvent,rendererParams:{}};for(e=0;e<i;e++){d=h[e];if(d.id==b.dimension.id){g=!0}else {a.data[d.id]=null}c.storeInfo[a.internalId].rendererParams[d.id]={fn:'recordTabularRenderer',group:b,hidden:!g}}c.storeInfo[a.internalId].rendererParams['topaxis']={fn:'topAxisRenderer',group:b};f.results.push(a)},doExpandCollapse:function(e,d){var b=this,c=b.getGrid(),a;a=b.getMatrix().leftAxis.findTreeElement('key',e);if(!a){return}b.doExpandCollapseInternal(a.node,d);c.fireEvent((a.node.expanded?'pivotgroupexpand':'pivotgroupcollapse'),c,'row',a.node)},doExpandCollapseInternal:function(b,h){var f=this,a=f.getStore(),g=Ext.isClassic,e,c,d;b.expanded=!b.expanded;c=f.processGroup({group:b,previousExpanded:!1});b.expanded=!b.expanded;e=f.processGroup({group:b,previousExpanded:!1});if(e.length&&c.length&&(d=a.indexOf(c[0]))!==-1){a.suspendEvents();if(b.expanded){a.remove(a.getAt(d));a.insert(d,e)}else {a.remove(c);a.insert(d,e)}f.removeStoreInfoData(c);a.resumeEvents();if(g){a.fireEvent('replace',a,d,c,e)}else {a.fireEvent('refresh',a)}}},removeStoreInfoData:function(c){var d=c.length,b,a;for(a=0;a<d;a++){b=c[a];if(this.storeInfo[b.internalId]){delete this.storeInfo[b.internalId]}}},onGroupExpand:function(c,b,a){if(b=='row'){if(a){this.doExpandCollapseInternal(a,a.records.collapsed)}else {this.processStore()}}},onGroupCollapse:function(c,b,a){if(b=='row'){if(a){this.doExpandCollapseInternal(a,a.records.expanded)}else {this.processStore()}}}});Ext.define('Ext.pivot.result.Base',{alias:'pivotresult.base',mixins:['Ext.mixin.Factoryable'],leftKey:'',topKey:'',dirty:!1,values:null,matrix:null,constructor:function(b){var a=this;Ext.apply(a,b||{});a.values={};return a.callParent(arguments)},destroy:function(){var a=this;a.matrix=a.values=null;a.leftAxisItem=a.topAxisItem=null;return a.callParent(arguments)},calculate:Ext.emptyFn,calculateByFn:Ext.emptyFn,addValue:function(a,b){this.values[a]=b},getValue:function(a){return this.values[a]},hasValue:function(a){return (a in this.values)},getLeftAxisItem:function(){return this.matrix.leftAxis.items.getByKey(this.leftKey)},getTopAxisItem:function(){return this.matrix.topAxis.items.getByKey(this.topKey)}});Ext.define('Ext.pivot.result.Collection',{alternateClassName:['Mz.aggregate.matrix.Results'],requires:['Ext.pivot.MixedCollection','Ext.pivot.result.Base'],resultType:'base',items:null,matrix:null,constructor:function(b){var a=this;Ext.apply(a,b||{});a.items=new Ext.pivot.MixedCollection();a.items.getKey=function(a){return a.leftKey+'/'+a.topKey};return a.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.items);a.matrix=a.items=null;a.callParent(arguments)},clear:function(){this.items.clear()},add:function(b,c){var a=this.get(b,c);if(!a){a=this.items.add(Ext.Factory.pivotresult({type:this.resultType,leftKey:b,topKey:c,matrix:this.matrix}))}return a},get:function(a,b){return this.items.getByKey(a+'/'+b)},remove:function(a,b){this.items.removeAtKey(a+'/'+b)},getByLeftKey:function(a){var b=this.items.filterBy(function(d,c){var b=String(c).split('/');return (a==b[0])});return b.getRange()},getByTopKey:function(a){var b=this.items.filterBy(function(d,c){var b=String(c).split('/');return (b.length>1&&a==b[1])});return b.getRange()},calculate:function(){var b=this.items.getCount(),a;for(a=0;a<b;a++){this.items.getAt(a).calculate()}}});Ext.define('Ext.pivot.matrix.Base',{alternateClassName:['Mz.aggregate.matrix.Abstract'],extend:'Ext.util.Observable',alias:'pivotmatrix.base',mixins:['Ext.mixin.Factoryable'],requires:['Ext.util.DelayedTask','Ext.data.ArrayStore','Ext.XTemplate','Ext.pivot.Aggregators','Ext.pivot.MixedCollection','Ext.pivot.axis.Base','Ext.pivot.dimension.Item','Ext.pivot.result.Collection'],resultType:'base',leftAxisType:'base',topAxisType:'base',textRowLabels:'Row labels',textTotalTpl:'Total ({name})',textGrandTotalTpl:'Grand total',keysSeparator:'#_#',grandTotalKey:'grandtotal',compactViewKey:'_compactview_',compactViewColumnWidth:200,viewLayoutType:'outline',rowSubTotalsPosition:'first',rowGrandTotalsPosition:'last',colSubTotalsPosition:'last',colGrandTotalsPosition:'last',showZeroAsBlank:!1,calculateAsExcel:!1,leftAxis:null,topAxis:null,aggregate:null,results:null,pivotStore:null,isDestroyed:!1,cmp:null,useNaturalSorting:!1,collapsibleRows:!0,collapsibleColumns:!0,isPivotMatrix:!0,serializeProperties:['viewLayoutType','rowSubTotalsPosition','rowGrandTotalsPosition','colSubTotalsPosition','colGrandTotalsPosition','showZeroAsBlank','collapsibleRows','collapsibleColumns'],constructor:function(a){var b=this.callParent(arguments);this.initialize(!0,a);return b},destroy:function(){var a=this;a.delayedTask.cancel();a.delayedTask=null;if(Ext.isFunction(a.onDestroy)){a.onDestroy()}Ext.destroy(a.results,a.leftAxis,a.topAxis,a.aggregate,a.pivotStore);a.results=a.leftAxis=a.topAxis=a.aggregate=a.pivotStore=null;if(Ext.isArray(a.columns)){a.columns.length=0}if(Ext.isArray(a.model)){a.model.length=0}if(Ext.isArray(a.totals)){a.totals.length=0}a.columns=a.model=a.totals=a.keysMap=a.cmp=a.modelInfo=null;a.isDestroyed=!0;a.callParent(arguments)},getKey:function(b){var a=this;a.keysMap=a.keysMap||{};if(!Ext.isDefined(a.keysMap[b])){a.keysMap[b]=Ext.id()}return a.keysMap[b]},naturalSort:(function(){var d=/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[\da-fA-F]+$|\d+)/g,a=/^\s+|\s+$/g,e=/\s+/g,f=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,g=/^0/,b=function(b,c){b=b||'';return (!b.match(g)||c==1)&&parseFloat(b)||b.replace(e,' ').replace(a,'')||0};return function(m,n){var o=String(m instanceof Date?m.getTime():(m||'')).replace(a,''),i=String(n instanceof Date?n.getTime():(n||'')).replace(a,''),k=o.replace(d,'\x00$1\x00').replace(/\0$/,'').replace(/^\0/,'').split('\x00'),r=i.replace(d,'\x00$1\x00').replace(/\0$/,'').replace(/^\0/,'').split('\x00'),j=parseInt(o.match(c),16)||(k.length!==1&&Date.parse(o)),l=parseInt(i.match(c),16)||j&&i.match(f)&&Date.parse(i)||null,e,g;if(l){if(j<l){return -1}else if(j>l){return 1}}for(var h=0,p=k.length,q=r.length,s=Math.max(p,q);h<s;h++){e=b(k[h],p);g=b(r[h],q);if(isNaN(e)!==isNaN(g)){return (isNaN(e))?1:-1}else if(typeof e!==typeof g){e+='';g+=''}if(e<g){return -1}if(e>g){return 1}}return 0}}()),initialize:function(d,b){var a=this,e=a.serializeProperties,c;b=b||{};a.initResults();if(d||b.aggregate){a.initAggregates(b.aggregate||[])}if(d||b.leftAxis){a.initLeftAxis(b.leftAxis||[])}if(d||b.topAxis){a.initTopAxis(b.topAxis||[])}for(c=0;c<e.length;c++){if(Ext.isDefined(b[e[c]])){a[e[c]]=b[e[c]]}}a.totals=[];a.modelInfo={};a.keysMap=null;if(!d){if(!a.collapsibleRows){a.leftAxis.expandAll()}if(!a.collapsibleColumns){a.topAxis.expandAll()}}if(d){a.pivotStore=new Ext.data.ArrayStore({autoDestroy:!1,fields:[]});a.delayedTask=new Ext.util.DelayedTask(a.startProcess,a);if(Ext.isFunction(a.onInitialize)){a.onInitialize()}}a.delayedTask.delay(5)},onInitialize:Ext.emptyFn,onDestroy:Ext.emptyFn,reconfigure:function(c){var a=this,b=Ext.clone(c||{});if(a.fireEvent('beforereconfigure',a,b)!==!1){if(Ext.isFunction(a.onReconfigure)){a.onReconfigure(b)}a.fireEvent('reconfigure',a,b);a.initialize(!1,b);a.clearData()}else {a.delayedTask.cancel()}},onReconfigure:Ext.emptyFn,serialize:function(){var a=this,e=a.serializeProperties,f=e.length,b={},c,d;for(c=0;c<f;c++){d=e[c];b[d]=a[d]}b.leftAxis=a.serializeDimensions(a.leftAxis.dimensions);b.topAxis=a.serializeDimensions(a.topAxis.dimensions);b.aggregate=a.serializeDimensions(a.aggregate);return b},serializeDimensions:function(b){var d=b.getCount(),c=[],a;for(a=0;a<d;a++){c.push(b.getAt(a).serialize())}return c},initResults:function(){Ext.destroy(this.results);this.results=new Ext.pivot.result.Collection({resultType:this.resultType,matrix:this})},initAggregates:function(b){var c=this,d,a;Ext.destroy(c.aggregate);c.aggregate=new Ext.pivot.MixedCollection();c.aggregate.getKey=function(a){return a.getId()};if(Ext.isEmpty(b)){return}b=Ext.Array.from(b);for(d=0;d<b.length;d++){a=b[d];if(!a.isInstance){Ext.applyIf(a,{isAggregate:!0,align:'right',showZeroAsBlank:c.showZeroAsBlank});a=new Ext.pivot.dimension.Item(a)}a.matrix=this;c.aggregate.add(a)}},initLeftAxis:function(b){var a=this;b=Ext.Array.from(b||[]);Ext.destroy(a.leftAxis);a.leftAxis=Ext.Factory.pivotaxis({type:a.leftAxisType,matrix:a,dimensions:b,isLeftAxis:!0})},initTopAxis:function(b){var a=this;b=Ext.Array.from(b||[]);Ext.destroy(a.topAxis);a.topAxis=Ext.Factory.pivotaxis({type:a.topAxisType,matrix:a,dimensions:b,isLeftAxis:!1})},clearData:function(){var a=this;a.fireEvent('cleardata',a);a.leftAxis.clear();a.topAxis.clear();a.results.clear();if(Ext.isArray(a.columns)){a.columns.length=0}if(Ext.isArray(a.model)){a.model.length=0}a.totals=[];a.modelInfo={};a.keysMap=null;if(a.pivotStore){a.pivotStore.removeAll(!0)}},startProcess:Ext.emptyFn,endProcess:function(){var a=this;a.leftAxis.getTree();a.topAxis.getTree();a.buildModelAndColumns();a.buildPivotStore();if(Ext.isFunction(a.onBuildStore)){a.onBuildStore(a.pivotStore)}a.fireEvent('storebuilt',a,a.pivotStore);a.fireEvent('done',a)},onBuildModel:Ext.emptyFn,onBuildColumns:Ext.emptyFn,onBuildRecord:Ext.emptyFn,onBuildTotals:Ext.emptyFn,onBuildStore:Ext.emptyFn,buildModelAndColumns:function(){var a=this;a.model=[{name:'id',type:'string'},{name:'isRowGroupHeader',type:'boolean',defaultValue:!1},{name:'isRowGroupTotal',type:'boolean',defaultValue:!1},{name:'isRowGrandTotal',type:'boolean',defaultValue:!1},{name:'leftAxisKey',type:'string',defaultValue:null}];a.internalCounter=0;a.columns=[];if(a.viewLayoutType=='compact'){a.generateCompactLeftAxis()}else {a.leftAxis.dimensions.each(a.parseLeftAxisDimension,a)}if(a.colGrandTotalsPosition=='first'){a.columns.push(a.parseAggregateForColumn(null,{text:a.textGrandTotalTpl,grandTotal:!0}))}Ext.Array.each(a.topAxis.getTree(),a.parseTopAxisItem,a);if(a.colGrandTotalsPosition=='last'){a.columns.push(a.parseAggregateForColumn(null,{text:a.textGrandTotalTpl,grandTotal:!0}))}if(Ext.isFunction(a.onBuildModel)){a.onBuildModel(a.model)}a.fireEvent('modelbuilt',a,a.model);if(Ext.isFunction(a.onBuildColumns)){a.onBuildColumns(a.columns)}a.fireEvent('columnsbuilt',a,a.columns)},getDefaultFieldInfo:function(a){return Ext.apply({isColGroupTotal:!1,isColGrandTotal:!1,leftAxisColumn:!1,topAxisColumn:!1,topAxisKey:null},a)},parseLeftAxisDimension:function(a){var b=this,c=a.getId();b.model.push({name:c,type:'auto'});b.columns.push(Ext.merge({dataIndex:c,text:a.header,dimension:a,leftAxis:!0},a.column));b.modelInfo[c]=b.getDefaultFieldInfo({leftAxisColumn:!0})},generateCompactLeftAxis:function(){var a=this;a.model.push({name:a.compactViewKey,type:'auto'});a.columns.push({dataIndex:a.compactViewKey,text:a.textRowLabels,leftAxis:!0,width:a.compactViewColumnWidth});a.modelInfo[a.compactViewKey]=a.getDefaultFieldInfo({leftAxisColumn:!0})},parseTopAxisItem:function(a){var b=this,d=[],e=[],h,c,i,g,f;if(!a.children){d=b.parseAggregateForColumn(a,null);if(a.level===0){b.columns.push(d)}else {return d}}else {if(b.colSubTotalsPosition=='first'){c=b.addColSummary(a);if(c){e.push(c)}}i=a.children.length;for(g=0;g<i;g++){f=b.parseTopAxisItem(a.children[g]);if(Ext.isArray(f)){Ext.Array.insert(d,d.length,f)}else {d.push(f)}}h={text:a.name,group:a,columns:d,key:a.key,xexpandable:!0,xgrouped:!0};if(a.level===0){b.columns.push(h)}e.push(h);if(b.colSubTotalsPosition=='last'){c=b.addColSummary(a);if(c){e.push(c)}}if(b.colSubTotalsPosition=='none'){c=b.addColSummary(a);if(c){e.push(c)}}return e}},addColSummary:function(a){var c=this,b,d=!1;b=c.parseAggregateForColumn(a,{text:a.expanded?a.getTextTotal():a.name,group:a,subTotal:!0});if(a.level===0){c.columns.push(b)}Ext.apply(b,{key:a.key,xexpandable:!0,xgrouped:!0});return b},parseAggregateForColumn:function(c,b){var a=this,e=[],d={},h=a.aggregate.getRange(),i=h.length,g,f;for(g=0;g<i;g++){f=h[g];a.internalCounter++;a.model.push({name:'c'+a.internalCounter,type:'auto',defaultValue:undefined,useNull:!0,col:c?c.key:a.grandTotalKey,agg:f.getId()});e.push(Ext.merge({dataIndex:'c'+a.internalCounter,text:f.header,topAxis:!0,subTotal:(b?b.subTotal===!0:!1),grandTotal:(b?b.grandTotal===!0:!1),dimension:f},f.column));a.modelInfo['c'+a.internalCounter]=a.getDefaultFieldInfo({isColGroupTotal:(b?b.subTotal===!0:!1),isColGrandTotal:(b?b.grandTotal===!0:!1),topAxisColumn:!0,topAxisKey:c?c.key:a.grandTotalKey})}if(e.length==0&&a.aggregate.getCount()==0){a.internalCounter++;d=Ext.apply({text:c?c.name:'',dataIndex:'c'+a.internalCounter},b||{})}else if(e.length==1){d=Ext.applyIf({text:c?c.name:''},e[0]);Ext.apply(d,b||{});if(b&&b.grandTotal&&a.aggregate.getCount()==1){d.text=a.aggregate.getAt(0).header||b.text}}else {d=Ext.apply({text:c?c.name:'',columns:e},b||{})}return d},buildPivotStore:function(){var a=this;if(Ext.isFunction(a.pivotStore.model.setFields)){a.pivotStore.model.setFields(a.model)}else {a.pivotStore.model.replaceFields(a.model,!0)}a.pivotStore.removeAll(!0);Ext.Array.each(a.leftAxis.getTree(),a.addRecordToPivotStore,a);a.addGrandTotalsToPivotStore()},addGrandTotalsToPivotStore:function(){var a=this,c=[],e,d,b;c.push({title:a.textGrandTotalTpl,values:a.preparePivotStoreRecordData({key:a.grandTotalKey},{isRowGrandTotal:!0})});if(Ext.isFunction(a.onBuildTotals)){a.onBuildTotals(c)}a.fireEvent('buildtotals',a,c);e=c.length;for(d=0;d<e;d++){b=c[d];if(Ext.isObject(b)&&Ext.isObject(b.values)){Ext.applyIf(b.values,{isRowGrandTotal:!0});a.totals.push({title:b.title||'',record:a.pivotStore.add(b.values)[0]})}}},addRecordToPivotStore:function(b){var a=this,c,d;if(!b.children){c=a.pivotStore.add(a.preparePivotStoreRecordData(b))[0];b.record=c;if(Ext.isFunction(a.onBuildRecord)){a.onBuildRecord(c,b)}a.fireEvent('recordbuilt',a,c,b)}else {b.records={};d=(a.viewLayoutType==='compact'?a.compactViewKey:b.dimensionId);b.records.collapsed=a.pivotStore.add(a.preparePivotStoreRecordData(b,{isRowGroupHeader:!0,isRowGroupTotal:!0}))[0];if(a.rowSubTotalsPosition==='first'&&a.viewLayoutType!=='tabular'){b.records.expanded=a.pivotStore.add(a.preparePivotStoreRecordData(b,{isRowGroupHeader:!0}))[0]}else {c={};c[d]=b.name;c.isRowGroupHeader=!0;b.records.expanded=a.pivotStore.add(c)[0];if(a.rowSubTotalsPosition==='last'||a.viewLayoutType==='tabular'){c=a.preparePivotStoreRecordData(b,{isRowGroupTotal:!0});c[d]=b.getTextTotal();b.records.footer=a.pivotStore.add(c)[0]}}Ext.Array.each(b.children,a.addRecordToPivotStore,a)}},preparePivotStoreRecordData:function(a,g){var d=this,c={},h=d.model.length,e,b,f;if(a){if(a.dimensionId){c[a.dimensionId]=a.name}c.leftAxisKey=a.key;for(e=0;e<h;e++){b=d.model[e];if(b.col&&b.agg){f=d.results.items.map[a.key+'/'+b.col];c[b.name]=f?f.values[b.agg]:null}}if(d.viewLayoutType==='compact'){c[d.compactViewKey]=a.name}}return Ext.applyIf(c,g)},getColumns:function(){return this.model},getColumnHeaders:function(){var a=this;if(!a.model){a.buildModelAndColumns()}return a.columns},isGroupRow:function(b){var a=this.leftAxis.findTreeElement('key',b);if(!a){return !1}return (a.node.children&&a.node.children.length==0)?0:a.level},isGroupCol:function(b){var a=this.topAxis.findTreeElement('key',b);if(!a){return !1}return (a.node.children&&a.node.children.length==0)?0:a.level},deprecated:{'6.0':{properties:{mztype:'type',mztypeLeftAxis:'leftAxisType',mztypeTopAxis:'topAxisType'}}}});Ext.define('Ext.pivot.result.Local',{extend:'Ext.pivot.result.Base',alias:'pivotresult.local',alternateClassName:['Mz.aggregate.matrix.Result'],records:null,constructor:function(a){this.records=[];return this.callParent(arguments)},destroy:function(){this.records.length=0;this.records=null;return this.callParent(arguments)},calculate:function(){var a=this,c,b,d=a.matrix.aggregate.getCount();for(c=0;c<d;c++){b=a.matrix.aggregate.getAt(c);a.addValue(b.getId(),Ext.callback(b.aggregatorFn,b.getScope()||'self.controller',[a.records,b.dataIndex,a.matrix,a.leftKey,a.topKey],0,a.matrix.cmp))}},calculateByFn:function(e,d,b){var a=this,c;if(Ext.isString(b)){b=Ext.pivot.Aggregators[b]}c=b(a.records,d,a.matrix,a.leftKey,a.topKey);a.addValue(e,c);return c},addRecord:function(a){this.records.push(a)},removeRecord:function(a){Ext.Array.remove(this.records,a)}});Ext.define('Ext.pivot.matrix.Local',{alternateClassName:['Mz.aggregate.matrix.Local'],extend:'Ext.pivot.matrix.Base',alias:'pivotmatrix.local',requires:['Ext.pivot.matrix.Base','Ext.pivot.axis.Local','Ext.pivot.result.Local'],isLocalMatrix:!0,resultType:'local',leftAxisType:'local',topAxisType:'local',store:null,recordsPerJob:1000,timeBetweenJobs:2,onInitialize:function(){var a=this;a.localDelayedTask=new Ext.util.DelayedTask(a.delayedProcess,a);a.storeCleanDelayedTask=new Ext.util.DelayedTask(a.onOriginalStoreCleanDelayed,a);a.storeChangedDelayedTask=new Ext.util.DelayedTask(a.onOriginalStoreChangedDelayed,a);a.initializeStore({store:a.store});a.callParent(arguments)},initializeStore:function(d){var a=this,b,c;a.processedRecords={};if(d.store){c=d.store}else {if(a.store){if(a.store.isStore&&!a.storeListeners){b=a.store}else {c=a.store}}}if(c){b=Ext.getStore(c||'');if(Ext.isEmpty(b)&&Ext.isString(c)){b=Ext.create(c)}}if(b&&b.isStore){Ext.destroy(a.storeListeners);if(a.store&&a.store.autoDestroy&&b!=a.store){Ext.destroy(a.store)}a.store=b;a.storeListeners=a.store.on({refresh:a.startProcess,beforeload:a.onOriginalStoreBeforeLoad,add:a.onOriginalStoreAdd,update:a.onOriginalStoreUpdate,remove:a.onOriginalStoreRemove,commit:a.onOriginalStoreClean,reject:a.onOriginalStoreClean,clear:a.startProcess,scope:a,destroyable:!0});if(b.isLoaded()){a.startProcess()}}},onReconfigure:function(a){this.initializeStore(a);this.callParent(arguments)},onDestroy:function(){var a=this;a.localDelayedTask.cancel();a.localDelayedTask=null;a.storeCleanDelayedTask.cancel();a.storeCleanDelayedTask=null;a.storeChangedDelayedTask.cancel();a.storeChangedDelayedTask=null;if(Ext.isArray(a.records)){a.records.length=0}a.records=a.changedRecords=null;Ext.destroy(a.storeListeners);if(a.store&&a.store.isStore&&a.store.autoDestroy){Ext.destroy(a.store)}a.store=a.storeListeners=a.processedRecords=null;a.callParent(arguments)},onOriginalStoreBeforeLoad:function(a){this.fireEvent('start',this)},createStoreChangesQueue:function(){var a=this;a.changedRecords=a.changedRecords||{};a.changedRecords.add=a.changedRecords.add||[];a.changedRecords.update=a.changedRecords.update||[];a.changedRecords.remove=a.changedRecords.remove||[]},dropStoreChangesQueue:function(){var a=this;if(a.changedRecords){a.changedRecords.add.length=0;a.changedRecords.update.length=0;a.changedRecords.remove.length=0}},onOriginalStoreAdd:function(c,b){var a=this;a.createStoreChangesQueue();Ext.Array.insert(a.changedRecords.add,a.changedRecords.add.length,b);a.storeChangedDelayedTask.delay(100)},onOriginalStoreUpdate:function(c,b){var a=this;a.createStoreChangesQueue();if(Ext.Array.indexOf(a.changedRecords.add,b)<0){Ext.Array.insert(a.changedRecords.update,a.changedRecords.update.length,[b])}a.storeChangedDelayedTask.delay(100)},onOriginalStoreRemove:function(g,c,f,d){var a=this,e=c.length,b;if(d){return}a.createStoreChangesQueue();for(b=0;b<e;b++){Ext.Array.remove(a.changedRecords.update,c[b]);Ext.Array.remove(a.changedRecords.add,c[b])}Ext.Array.insert(a.changedRecords.remove,a.changedRecords.remove.length,c);a.storeChangedDelayedTask.delay(100)},onOriginalStoreChangedDelayed:function(){var a=this,b=a.changedRecords;if(a.isDestroyed){return}a.storeChanged=!!(b.add.length||b.update.length||b.remove.length);if(a.storeChanged){a.onOriginalStoreAddDelayed();a.onOriginalStoreUpdateDelayed();a.onOriginalStoreRemoveDelayed()}},onOriginalStoreAddDelayed:function(){var c=this,g=[],f=!1,d,b,e,h,a;e=c.changedRecords.add;d=e.length;if(!d){return}for(b=0;b<d;b++){h=e[b];c.processRecord(h,b,d);a=c.processedRecords[h.internalId];f=f||a.left.length||a.top.length;if(a.left.length){Ext.Array.insert(g,g.length,a.left)}}e.length=0;if(f){c.leftAxis.rebuildTree();c.topAxis.rebuildTree()}d=g.length;if(d){for(b=0;b<d;b++){a=g[b];if((a.children&&!a.records)||(!a.children&&!a.record)){c.addRecordToPivotStore(a)}}}c.recalculateResults(c.store,e,f)},onOriginalStoreUpdateDelayed:function(){var a=this,i=[],h=!1,c,b,m,f,g,d,j,e,k,l;f=a.changedRecords.update;c=f.length;if(!c){return}for(b=0;b<c;b++){g=f[b];j=a.processedRecords[g.internalId];a.removeRecordFromResults(g);a.processRecord(g,b,c);e=a.processedRecords[g.internalId];if(j&&e){k=Ext.Array.equals(j.left,e.left);l=Ext.Array.equals(j.top,e.top);h=h||!k||!l;if(!k){Ext.Array.insert(i,i.length,e.left)}}}f.length=0;if(h){a.leftAxis.rebuildTree();a.topAxis.rebuildTree()}c=i.length;for(b=0;b<c;b++){d=i[b];if((d.children&&!d.records)||(!d.children&&!d.record)){a.addRecordToPivotStore(d)}}a.recalculateResults(a.store,f,h)},onOriginalStoreRemoveDelayed:function(){var a=this,e,d,b,c;b=a.changedRecords.remove;e=b.length;if(!e){return}for(d=0;d<e;d++){c=a.removeRecordFromResults(b[d])||c}b.length=0;if(c){a.leftAxis.rebuildTree();a.topAxis.rebuildTree()}a.recalculateResults(a.store,b,c)},onOriginalStoreClean:function(){var a=this;if(a.localDelayedTask.id){a.dropStoreChangesQueue();a.storeChanged=!1}else {a.storeCleanDelayedTask.delay(100)}},onOriginalStoreCleanDelayed:function(){var a=this,c,d,b;if(a.isDestroyed){return}c=a.pivotStore.getRange();d=c.length;for(b=0;b<d;b++){c[b].commit(!0)}a.storeChanged=!1;a.fireEvent('afterupdate',a,!1)},removeRecordFromResults:function(g){var b=this,c=b.processedRecords[g.internalId],e=b.grandTotalKey,i=!1,a,f,d,h,j,k;if(!c){return i}a=b.results.get(e,e);if(a){a.removeRecord(g);if(a.records.length===0){b.results.remove(e,e)}}j=c.top.length;for(d=0;d<j;d++){f=c.top[d];a=b.results.get(e,f.key);if(a){a.removeRecord(g);if(a.records.length===0){b.results.remove(e,f.key);b.topAxis.items.remove(f);i=!0}}}j=c.left.length;for(d=0;d<j;d++){f=c.left[d];a=b.results.get(f.key,e);if(a){a.removeRecord(g);if(a.records.length===0){b.results.remove(f.key,e);b.leftAxis.items.remove(f);i=!0}}k=c.top.length;for(h=0;h<k;h++){a=b.results.get(c.left[d].key,c.top[h].key);if(a){a.removeRecord(g);if(a.records.length===0){b.results.remove(c.left[d].key,c.top[h].key)}}}}return i},recalculateResults:function(d,c,b){var a=this;a.fireEvent('beforeupdate',a,b);a.buildModelAndColumns();a.results.calculate();Ext.Array.each(a.leftAxis.getTree(),a.updateRecordToPivotStore,a);a.updateGrandTotalsToPivotStore();a.fireEvent('afterupdate',a,b)},updateGrandTotalsToPivotStore:function(){var a=this,c=[],b;if(a.totals.length<=0){return}c.push({title:a.textGrandTotalTpl,values:a.preparePivotStoreRecordData({key:a.grandTotalKey})});if(Ext.isFunction(a.onBuildTotals)){a.onBuildTotals(c)}a.fireEvent('buildtotals',a,c);if(a.totals.length===c.length){for(b=0;b<a.totals.length;b++){if(Ext.isObject(c[b])&&Ext.isObject(c[b].values)&&(a.totals[b].record instanceof Ext.data.Model)){delete (c[b].values.id);a.totals[b].record.set(c[b].values)}}}},updateRecordToPivotStore:function(a){var c=this,d,b;if(!a.children){if(a.record){b=c.preparePivotStoreRecordData(a);delete (b['id']);a.record.set(b)}}else {if(a.records){d=(c.viewLayoutType==='compact'?c.compactViewKey:a.dimensionId);b=c.preparePivotStoreRecordData(a);delete (b['id']);delete (b[d]);a.records.collapsed.set(b);if(a.records.expanded){a.records.expanded.set(b)}if(a.records.footer){a.records.footer.set(b)}}Ext.Array.each(a.children,c.updateRecordToPivotStore,c)}},startProcess:function(){var a=this;if(!a.store||(a.store&&!a.store.isStore)||a.isDestroyed||a.store.isLoading()){return}a.dropStoreChangesQueue();a.clearData();a.localDelayedTask.delay(50)},delayedProcess:function(){var a=this;if(a.isDestroyed){return}a.fireEvent('start',a);a.records=a.store.getRange();if(a.records.length==0){a.endProcess();return}a.statusInProgress=!1;a.processRecords(0)},processRecords:function(d){var a=this,b=d,c;if(a.isDestroyed){return}c=a.records.length;a.statusInProgress=!0;while(b<c&&b<d+a.recordsPerJob&&a.statusInProgress){a.processRecord(a.records[b],b,c);b++}if(b>=c){a.statusInProgress=!1;a.results.calculate();a.leftAxis.buildTree();a.topAxis.buildTree();if(a.filterApplied){a.results.calculate()}a.records=null;a.endProcess();return}if(a.statusInProgress&&c>0){Ext.defer(a.processRecords,a.timeBetweenJobs,a,[b])}},processRecord:function(d,l,m){var a=this,f=a.grandTotalKey,g,e,c,h,j,k,i,b;a.processedRecords[d.internalId]=i={left:[],top:[]};g=a.leftAxis.processRecord(d);e=a.topAxis.processRecord(d);if(g&&e){a.results.add(f,f).addRecord(d);j=e.length;for(c=0;c<j;c++){b=e[c];a.topAxis.addItem(b);i.top.push(a.topAxis.items.map[b.key]);a.results.add(f,b.key).addRecord(d)}k=g.length;for(c=0;c<k;c++){b=g[c];a.leftAxis.addItem(b);i.left.push(a.leftAxis.items.map[b.key]);a.results.add(b.key,f).addRecord(d);for(h=0;h<j;h++){a.results.add(b.key,e[h].key).addRecord(d)}}}a.fireEvent('progress',a,l+1,m)},getRecordsByRowGroup:function(e){var c=this.results.getByLeftKey(e),d=c.length,b=[],a;for(a=0;a<d;a++){Ext.Array.insert(b,b.length,c[a].records||[])}return b},getRecordsByColGroup:function(e){var c=this.results.getByTopKey(e),d=c.length,b=[],a;for(a=0;a<d;a++){Ext.Array.insert(b,b.length,c[a].records||[])}return b},getRecordsByGroups:function(c,b){var a=this.results.get(c,b);return (a?a.records||[]:[])}});Ext.define('Ext.pivot.matrix.Remote',{alternateClassName:['Mz.aggregate.matrix.Remote'],extend:'Ext.pivot.matrix.Base',alias:'pivotmatrix.remote',isRemoteMatrix:!0,url:'',timeout:3000,onBeforeRequest:Ext.emptyFn,onRequestException:Ext.emptyFn,onInitialize:function(){var a=this;a.remoteDelayedTask=new Ext.util.DelayedTask(a.delayedProcess,a);a.callParent(arguments)},onDestroy:function(){this.remoteDelayedTask.cancel();this.remoteDelayedTask=null;this.callParent()},startProcess:function(){var a=this;if(Ext.isEmpty(a.url)){return}a.clearData();a.fireEvent('start',a);a.statusInProgress=!1;a.remoteDelayedTask.delay(5)},delayedProcess:function(){var a=this,d=a.serialize(),c,b;b={keysSeparator:a.keysSeparator,grandTotalKey:a.grandTotalKey,leftAxis:d.leftAxis,topAxis:d.topAxis,aggregate:d.aggregate};c=a.fireEvent('beforerequest',a,b);if(c!==!1){if(Ext.isFunction(a.onBeforeRequest)){c=a.onBeforeRequest(b)}}if(c===!1){a.endProcess()}else {Ext.Ajax.request({url:a.url,timeout:a.timeout,jsonData:b,callback:a.processRemoteResults,scope:a})}},processRemoteResults:function(k,i,g){var d=this,h=!i,f=Ext.JSON.decode(g.responseText,!0),c,b,e,a;if(i){h=(!f||!f['success'])}if(h){d.fireEvent('requestexception',d,g);if(Ext.isFunction(d.onRequestException)){d.onRequestException(g)}d.endProcess();return}c=Ext.Array.from(f.leftAxis||[]);e=c.length;for(a=0;a<e;a++){b=c[a];if(Ext.isObject(b)){d.leftAxis.addItem(b)}}c=Ext.Array.from(f.topAxis||[]);e=c.length;for(a=0;a<e;a++){b=c[a];if(Ext.isObject(b)){d.topAxis.addItem(b)}}c=Ext.Array.from(f.results||[]);e=c.length;for(a=0;a<e;a++){b=c[a];if(Ext.isObject(b)){var j=d.results.add(b.leftKey||'',b.topKey||'');Ext.Object.each(b.values||{},j.addValue,j)}}d.endProcess()}});Ext.define('Ext.pivot.plugin.Exporter',{alternateClassName:['Mz.pivot.plugin.ExcelExport'],alias:['plugin.pivotexporter','plugin.mzexcelexport'],extend:'Ext.exporter.Plugin',lockableScope:'top',init:function(a){var b=this;return b.callParent([a])},prepareData:function(i){var a=this,p,b,c,h,m,j,f,g,n,k,d,l,e,o;a.matrix=b=a.cmp.getMatrix();a.onlyExpandedNodes=(i&&i.onlyExpandedNodes);if(!a.onlyExpandedNodes){a.setColumnsExpanded(b.topAxis.getTree(),!0)}h=Ext.clone(b.getColumnHeaders());m=a.getColumnHeaders(h,i);d=a.getDataIndexColumns(h);if(!a.onlyExpandedNodes){a.setColumnsExpanded(b.topAxis.getTree())}c={columns:m,groups:[]};a.extractGroups(c,b.leftAxis.getTree(),d);k=b.totals.length;n=d.length;if(k){c.summaries=[];for(f=0;f<k;f++){j=b.totals[f];l={cells:[{value:j.title}]};for(g=1;g<n;g++){e=j.record.data[d[g].dataIndex];l.cells.push({value:(e==null||e===0)&&b.showZeroAsBlank?'':e})}c.summaries.push(l)}}a.matrix=a.onlyExpandedNodes=null;return new Ext.exporter.data.Table(c)},setColumnsExpanded:function(b,c){for(var a=0;a<b.length;a++){if(Ext.isDefined(c)){b[a].backupExpanded=b[a].expanded;b[a].expanded=c}else {b[a].expanded=b[a].backupExpanded;b[a].backupExpanded=null}if(b[a].children){this.setColumnsExpanded(b[a].children,c)}}},getColumnHeaders:function(e,f){var g=[],h=e.length,c,b,a,d;for(c=0;c<h;c++){a=e[c];d=this.onlyExpandedNodes?(!a.group||a.group.expanded||(!a.group.expanded&&a.subTotal)):!0;if(d){b={text:(a.subTotal&&a.group&&a.group.expanded?a.group.getTextTotal():a.text)};if(a.columns){b.columns=this.getColumnHeaders(a.columns,f)}else {b.width=a.dimension?a.dimension.getWidth():a.width||100;b.style=a.dimension?this.getExportStyle(a.dimension.getExportStyle(),f):null}g.push(b)}}return g},getDataIndexColumns:function(e){var b=[],c,a,d;for(c=0;c<e.length;c++){a=e[c];d=this.onlyExpandedNodes?(!a.group||a.group.expanded||(!a.group.expanded&&a.subTotal)):!0;if(d){if(a.dataIndex){b.push({dataIndex:a.dataIndex,agg:a.dimension?a.dimension.getId():null})}else if(a.columns){Ext.Array.insert(b,b.length,this.getDataIndexColumns(a.columns))}}}return b},extractGroups:function(e,l,g){var i,c,n,m,j,a,h,f,k,b,d;n=l.length;for(i=0;i<n;i++){a=l[i];if(a.record){e.rows=e.rows||[];d=[];h={cells:d};for(c=0;c<g.length;c++){b=a.record.data[g[c].dataIndex];d.push({value:(b==null||b===0)&&this.matrix.showZeroAsBlank?'':b})}e.rows.push(h)}else if(a.children){e.groups=e.groups||[];f={text:a.name};j=this.onlyExpandedNodes?a.expanded:!0;if(j){this.extractGroups(f,a.children,g)}f.summaries=[];d=[{value:(j?a.getTextTotal():a.value)}];h={cells:d};k=(a.expanded?a.records.expanded:a.records.collapsed);m=g.length;for(c=1;c<m;c++){b=k.data[g[c].dataIndex];d.push({value:(b==null||b===0)&&this.matrix.showZeroAsBlank?'':b})}f.summaries.push(h);e.groups.push(f)}}}});Ext.define('Ext.pivot.plugin.configurator.FieldSettings',{$configStrict:!1,config:{cls:'',style:null,fixed:[],allowed:['leftAxis','topAxis','aggregate'],aggregators:['sum','avg','min','max','count','countNumbers','groupSumPercentage','groupCountPercentage','variance','varianceP','stdDev','stdDevP'],renderers:{},formatters:{}},isFieldSettings:!0,constructor:function(a){this.initConfig(a||{});return this.callParent(arguments)},getDefaultEmptyArray:function(b){var a=this['_'+b];if(!a){a=[];this['set'+Ext.String.capitalize(b)](a)}return a},applyArrayValues:function(c,a,b){if(a==null||(a&&Ext.isArray(a))){return a}if(a){if(!b){b=this['get'+Ext.String.capitalize(c)]()}Ext.Array.splice(b,0,b.length,a)}return b},getFixed:function(){return this.getDefaultEmptyArray('fixed')},applyFixed:function(a,b){return this.applyArrayValues('fixed',a,b)},getAllowed:function(){return this.getDefaultEmptyArray('allowed')},applyAllowed:function(a,b){return this.applyArrayValues('allowed',a,b)},getAggregators:function(){return this.getDefaultEmptyArray('aggregators')},applyAggregators:function(a,b){return this.applyArrayValues('aggregators',a,b)},isFixed:function(a){var b;if(!a){return !1}b=a.getFieldType();return Ext.Array.indexOf(this.getFixed(),b)>=0},isAllowed:function(b){var c=this.getFixed(),a;if(!b){return !1}a=b.getFieldType();if(c.length){return Ext.Array.indexOf(c,a)>=0}return (a==='all')||(Ext.Array.indexOf(this.getAllowed(),a)>=0)}});Ext.define('Ext.pivot.plugin.configurator.Field',{extend:'Ext.pivot.dimension.Item',requires:['Ext.pivot.plugin.configurator.FieldSettings'],config:{editor:null,settings:{}},isField:!0,clone:function(){return new Ext.pivot.plugin.configurator.Field(Ext.applyIf({id:Ext.id()},this.getInitialConfig()))},getConfiguration:function(b){var a=this.callParent([b]);if(a.settings){a.settings=a.settings.getConfig()}return a},updateAggregator:function(b,d){var a,c;this.callParent([b,d]);if(b){a=this.getSettings();c=a.getAggregators();if(c.length===0){Ext.Array.remove(a.getAllowed(),'aggregate')}else {Ext.Array.include(c,b)}}},getSettings:function(){var a=this.settings;if(!a){a=new Ext.pivot.plugin.configurator.FieldSettings({});this.setSettings(a)}return a},applySettings:function(a,b){if(a==null||(a&&a.isFieldSettings)){return a}if(a){if(!b){b=this.getSettings()}b.setConfig(a)}if(b){this.setAggregator(this.getAggregator())}return b},getFieldText:function(){var a=this.getHeader();if(this.isAggregate){a+=' ('+this.getAggText()+')'}return a},getAggText:function(c){var a=Ext.pivot.Aggregators,b=c||this.getAggregator();if(Ext.isFunction(b)){return a.customText}return a[b+'Text']||a.customText}});Ext.define('Ext.pivot.update.Base',{extend:'Ext.mixin.Observable',alias:'pivotupdate.base',mixins:['Ext.mixin.Factoryable'],config:{leftKey:null,topKey:null,matrix:null,dataIndex:null,value:null},destroy:function(){Ext.unasap(this.updateTimer);this.setMatrix(null);this.callParent()},getResult:function(){var a=this.getMatrix();return a?a.results.get(this.getLeftKey(),this.getTopKey()):null},update:function(){var a=this;Ext.unasap(a.updateTimer);return new Ext.Promise(function(d,b){var c=a.getResult();if(c){if(a.fireEvent('beforeupdate',a)!==!1){a.updateTimer=Ext.asap(a.onUpdate,a,[c,d,b])}else {b('Operation canceled!')}}else {b('No Result found!')}})},onUpdate:function(c,a,b){this.fireEvent('update',this);a(this)}});Ext.define('Ext.pivot.update.Increment',{extend:'Ext.pivot.update.Base',alias:'pivotupdate.increment',onUpdate:function(f,h,i){if(this.destroyed){return}var e=this.getDataIndex(),a=parseFloat(this.getValue()),c=f.records,g,b,d;if(isNaN(a)){a=null}if(c&&a){g=c.length;for(b=0;b<g;b++){d=c[b];d.set(e,d.get(e)+a)}}this.callParent([f,h,i])}});Ext.define('Ext.pivot.update.Overwrite',{extend:'Ext.pivot.update.Base',alias:'pivotupdate.overwrite',onUpdate:function(d,g,h){if(this.destroyed){return}var f=this.getDataIndex(),c=parseFloat(this.getValue()),b=d.records,e,a;if(isNaN(c)){c=null}if(b){e=b.length;for(a=0;a<e;a++){b[a].set(f,c)}}this.callParent([d,g,h])}});Ext.define('Ext.pivot.update.Percentage',{extend:'Ext.pivot.update.Base',alias:'pivotupdate.percentage',onUpdate:function(f,h,i){if(this.destroyed){return}var e=this.getDataIndex(),a=parseFloat(this.getValue()),c=f.records,g,b,d;if(isNaN(a)){a=null}if(c){g=c.length;for(b=0;b<g;b++){d=c[b];d.set(e,a===null?null:Math.floor(d.get(e)*a/100))}}this.callParent([f,h,i])}});Ext.define('Ext.pivot.update.Uniform',{extend:'Ext.pivot.update.Base',alias:'pivotupdate.uniform',onUpdate:function(e,h,i){if(this.destroyed){return}var g=this.getDataIndex(),d=e.records,a=parseFloat(this.getValue()),b,c,f;if(isNaN(a)){a=null}if(d){b=d.length;if(b>0){f=(a===null?null:(a/b));for(c=0;c<b;c++){d[c].set(g,f)}}}this.callParent([e,h,i])}});Ext.define('Ext.pivot.feature.PivotEvents',{alternateClassName:['Mz.pivot.feature.PivotEvents'],extend:'Ext.grid.feature.Feature',alias:'feature.pivotevents',requires:['Ext.pivot.feature.PivotStore'],eventPrefix:'pivotcell',eventSelector:'.'+Ext.baseCSSPrefix+'grid-cell',cellSelector:'.'+Ext.baseCSSPrefix+'grid-cell',rowSelector:'.'+Ext.baseCSSPrefix+'grid-row',groupHeaderCls:Ext.baseCSSPrefix+'pivot-grid-group-header',groupHeaderCollapsibleCls:Ext.baseCSSPrefix+'pivot-grid-group-header-collapsible',init:function(a){this.initEventsListeners();this.callParent(arguments)},destroy:function(){var a=this;a.destroyEventsListeners();Ext.destroy(a.dataSource);a.view=a.grid=a.gridMaster=a.matrix=a.dataSource=null;a.callParent(arguments)},initEventsListeners:function(){var a=this;a.eventsViewListeners=a.view.on(Ext.apply({scope:a,destroyable:!0},a.getViewListeners()||{}));a.gridListeners=a.grid.on(Ext.apply({scope:a,destroyable:!0},a.getGridListeners()||{}))},getViewListeners:function(){var a=this,b={afterrender:a.onViewAfterRender};b[a.eventPrefix+'click']=a.onCellEvent;b[a.eventPrefix+'dblclick']=a.onCellEvent;b[a.eventPrefix+'contextmenu']=a.onCellEvent;return b},getGridListeners:Ext.emptyFn,destroyEventsListeners:function(){Ext.destroyMembers(this,'eventsViewListeners','gridListeners');this.eventsViewListeners=this.gridListeners=null},onViewAfterRender:function(){var a=this,b;a.gridMaster=a.view.up('pivotgrid');a.matrix=a.gridMaster.getMatrix();b=a.lockingPartner;if(b&&b.dataSource){a.dataSource=b.dataSource}else {a.dataSource=new Ext.pivot.feature.PivotStore({store:a.grid.store,matrix:a.matrix,grid:a.gridMaster,clsGrandTotal:a.gridMaster.clsGrandTotal,clsGroupTotal:a.gridMaster.clsGroupTotal})}},getRowId:function(a){return this.view.id+'-record-'+a.internalId},getRecord:function(a){return this.view.getRecord(a)},onCellEvent:function(r,e,n){var b=this,h=Ext.fly(e).findParent(b.rowSelector),p=b.getRecord(h),l={grid:b.gridMaster,view:b.view,cellEl:e},j,q,i,d,f,o,m,g,a,k,c;if(!h||!p){return !1}g=b.gridMaster.getMatrix();j=Ext.getDom(e).getAttribute('data-columnid');d=b.getColumnHeaderById(j);c=b.dataSource.storeInfo[p.internalId];a=c.rendererParams[d.dataIndex];if(!a){a=c.rendererParams['topaxis']}a=a?a.group:null;o=a?a.key:c.leftKey;h=Ext.fly(h);i=c.rowEvent;Ext.apply(l,{columnId:j,column:d,leftKey:o,leftItem:a});if(Ext.fly(e).hasCls(b.groupHeaderCls)){}else if(d){i+='cell';f=b.getTopAxisGroupByDataIndex(d.dataIndex);if(f){m=f.col;k=g.topAxis.findTreeElement('key',m);Ext.apply(l,{topKey:m,topItem:k?k.node:null,dimensionId:f.agg})}}q=b.gridMaster.fireEvent(i+n.type,l,n);if(q!==!1&&n.type=='click'&&Ext.fly(e).hasCls(b.groupHeaderCollapsibleCls)){if(a.expanded){a.collapse();b.view.focusNode(g.viewLayoutType==='tabular'?b.dataSource.getTabularGroupRecord(a):a.records.collapsed)}else {a.expand();b.view.focusNode(g.viewLayoutType==='tabular'?b.dataSource.getTabularGroupRecord(a):a.records.expanded)}}return !1},getColumnHeaderById:function(c){var b=this.view.getGridColumns(),a;for(a=0;a<b.length;a++){if(b[a].id===c){return b[a]}}},getTopAxisGroupByDataIndex:function(c){var b=this.gridMaster.matrix.getColumns(),a;for(a=0;a<b.length;a++){if(b[a].name===c){return b[a]}}}});Ext.define('Ext.pivot.feature.PivotView',{extend:'Ext.pivot.feature.PivotEvents',alias:'feature.pivotview',groupCls:Ext.baseCSSPrefix+'pivot-grid-group',groupTitleCls:Ext.baseCSSPrefix+'pivot-grid-group-title',groupHeaderCollapsedCls:Ext.baseCSSPrefix+'pivot-grid-group-header-collapsed',outlineCellHiddenCls:Ext.baseCSSPrefix+'pivot-grid-outline-cell-hidden',outlineCellGroupExpandedCls:Ext.baseCSSPrefix+'pivot-grid-outline-cell-previous-expanded',compactGroupHeaderCls:Ext.baseCSSPrefix+'pivot-grid-group-header-compact',outlineGroupHeaderCls:Ext.baseCSSPrefix+'pivot-grid-group-header-outline',tabularGroupHeaderCls:Ext.baseCSSPrefix+'pivot-grid-group-header-tabular',compactLayoutPadding:25,outerTpl:['{%','var me = this.pivotViewFeature;','if (!(me.disabled)) {','me.setup();','}','this.nextTpl.applyOut(values, out, parent);','%}',{priority:200}],rowTpl:['{%','var me = this.pivotViewFeature;','me.setupRowData(values.record, values.rowIndex, values);','values.view.renderColumnSizer(values, out);','this.nextTpl.applyOut(values, out, parent);','me.resetRenderers();','%}',{priority:200,syncRowHeights:function(b,a){var d,c;b=Ext.fly(b,'syncDest');if(b){d=b.offsetHeight}a=Ext.fly(a,'sycSrc');if(a){c=a.offsetHeight}if(b&&a){if(d>c){Ext.fly(a).setHeight(d)}else if(c>d){Ext.fly(b).setHeight(c)}}}}],cellTpl:['{%','values.hideCell = values.tdAttr == "hidden";\n','%}','<tpl if="!hideCell">','<td class="{tdCls}" role="{cellRole}" {tdAttr} {cellAttr:attributes}',' style="width:{column.cellWidth}px;<tpl if="tdStyle">{tdStyle}</tpl>"',' tabindex="-1" data-columnid="{[values.column.getItemId()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}" ','style="text-align:{align};<tpl if="style">{style}</tpl>" ','{cellInnerAttr:attributes}>{value}</div>','</td>','</tpl>',{priority:0}],rtlCellTpl:['{%','values.hideCell = values.tdAttr == "hidden";\n','%}','<tpl if="!hideCell">','<td class="{tdCls}" role="{cellRole}" {tdAttr} {cellAttr:attributes}',' style="width:{column.cellWidth}px;<tpl if="tdStyle">{tdStyle}</tpl>"',' tabindex="-1" data-columnid="{[values.column.getItemId()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}" ','style="text-align:{[this.getAlign(values.align)]};<tpl if="style">{style}</tpl>" ','{cellInnerAttr:attributes}>{value}</div>','</td>','</tpl>',{priority:200,rtlAlign:{right:'left',left:'right',center:'center'},getAlign:function(a){return this.rtlAlign[a]}}],init:function(c){var b=this,a=b.view;b.callParent(arguments);a.addTpl(Ext.XTemplate.getTpl(b,'outerTpl')).pivotViewFeature=b;a.addRowTpl(Ext.XTemplate.getTpl(b,'rowTpl')).pivotViewFeature=b;a.preserveScrollOnRefresh=!0;if(a.bufferedRenderer){a.bufferedRenderer.variableRowHeight=!0}else {c.variableRowHeight=a.variableRowHeight=!0}},destroy:function(){this.columns=null;this.callParent(arguments)},setup:function(){this.columns=this.view.getGridColumns()},isRTL:function(){var b=this,a=b.gridMaster||b.grid;if(Ext.isFunction(a.isLocalRtl)){return a.isLocalRtl()}return !1},getGridListeners:function(){var a=this;return Ext.apply(a.callParent(arguments)||{},{beforerender:a.onBeforeGridRendered})},onBeforeGridRendered:function(b){var a=this;if(a.isRTL()){a.view.addCellTpl(Ext.XTemplate.getTpl(a,'rtlCellTpl'))}else {a.view.addCellTpl(Ext.XTemplate.getTpl(a,'cellTpl'))}},vetoEvent:function(c,d,b,a){if(a.type!=='mouseover'&&a.type!=='mouseout'&&a.type!=='mouseenter'&&a.type!=='mouseleave'&&a.getTarget(this.eventSelector)){return !1}},setupRowData:function(d,e,b){var a=this.dataSource.storeInfo[d.internalId],c=a?a.rendererParams:{};b.rowClasses.length=0;Ext.Array.insert(b.rowClasses,0,a?a.rowClasses:[]);this.setRenderers(c)},setRenderers:function(b){var d=this.columns.length,c,a;for(c=0;c<d;c++){a=this.columns[c];if(a.leftAxis&&b[a.dataIndex]){a.savedRenderer=a.renderer;a.renderer=this[b[a.dataIndex].fn](Ext.apply({renderer:a.savedRenderer},b[a.dataIndex]))}if(a.topAxis&&b['topaxis']){a.savedRenderer=a.renderer;a.renderer=this[b['topaxis'].fn](Ext.apply({renderer:a.savedRenderer},b[a.dataIndex]))}}},resetRenderers:function(){var c=this.columns.length,b,a;for(b=0;b<c;b++){a=this.columns[b];if(Ext.isDefined(a.savedRenderer)){a.renderer=a.savedRenderer;delete a.savedRenderer}}},groupOutlineRenderer:function(b){var a=this,d=b['renderer'],c=b['group'],e=b['colspan'],h=b['hidden'],f=b['previousExpanded'],g=b['subtotalRow'];return function(j,i,m,l,k,n,o){if(Ext.isFunction(d)){j=d.apply(this,arguments)}if(e>0){i.tdAttr='colspan = "'+e+'"';i.tdCls=a.groupHeaderCls+' '+a.outlineGroupHeaderCls;if(!g){if(c&&c.children&&c.axis.matrix.collapsibleRows){i.tdCls+=' '+a.groupHeaderCollapsibleCls;if(!c.expanded){i.tdCls+=' '+a.groupHeaderCollapsedCls}}if(f){i.tdCls+=' '+a.outlineCellGroupExpandedCls}}return '<div class="'+a.groupTitleCls+' '+a.groupCls+'">'+j+'</div>'}if(h){i.tdAttr='hidden'}i.tdCls=a.outlineCellHiddenCls;return ''}},recordOutlineRenderer:function(a){var b=this,c=a['renderer'],e=a['group'],d=a['hidden'];return function(f,e,i,h,g,j,k){if(Ext.isFunction(c)){f=c.apply(this,arguments)}if(d){e.tdCls=b.outlineCellHiddenCls;return ''}e.tdCls=b.groupHeaderCls+' '+b.groupTitleCls;return f}},groupCompactRenderer:function(c){var a=this,d=c['renderer'],b=c['group'],g=c['colspan'],e=c['previousExpanded'],f=c['subtotalRow'];return function(h,g,k,j,i,l,m){if(Ext.isFunction(d)){h=d.apply(this,arguments)}if(b.level>0){g.style=(a.isRTL()?'margin-right: ':'margin-left: ')+(a.compactLayoutPadding*b.level)+'px;'}g.tdCls=a.groupHeaderCls+' '+a.compactGroupHeaderCls;if(!f){if(b&&b.children&&b.axis.matrix.collapsibleRows){g.tdCls+=' '+a.groupHeaderCollapsibleCls;if(!b.expanded){g.tdCls+=' '+a.groupHeaderCollapsedCls}}if(e){g.tdCls+=' '+a.outlineCellGroupExpandedCls}}return '<div class="'+a.groupTitleCls+' '+a.groupCls+'">'+h+'</div>'}},recordCompactRenderer:function(c){var a=this,b=c['renderer'],d=c['group'];return function(f,e,i,h,g,j,k){if(Ext.isFunction(b)){f=b.apply(this,arguments)}if(d.level>0){e.style=(a.isRTL()?'margin-right: ':'margin-left: ')+(a.compactLayoutPadding*d.level)+'px;'}e.tdCls=a.groupHeaderCls+' '+a.groupTitleCls+' '+a.compactGroupHeaderCls;return f}},groupTabularRenderer:function(a){var b=this,d=a['renderer'],c=a['group'],e=a['colspan'],g=a['hidden'],h=a['previousExpanded'],f=a['subtotalRow'];return function(i,h,l,k,j,m,n){if(Ext.isFunction(d)){i=d.apply(this,arguments)}if(e>0){h.tdAttr='colspan = "'+e+'"'}h.tdCls=b.groupHeaderCls+' '+b.tabularGroupHeaderCls;if(!f){if(c&&c.children&&c.axis.matrix.collapsibleRows){h.tdCls+=' '+b.groupHeaderCollapsibleCls;if(!c.expanded){h.tdCls+=' '+b.groupHeaderCollapsedCls}}}if(g){h.tdAttr='hidden'}return '<div class="'+b.groupTitleCls+' '+b.groupCls+'">'+i+'</div>'}},recordTabularRenderer:function(a){var c=this,b=a['renderer'],e=a['group'],d=a['hidden'];return function(e,f,i,h,g,j,k){if(d){return ''}if(Ext.isFunction(b)){e=b.apply(this,arguments)}f.tdCls=c.groupHeaderCls+' '+c.groupTitleCls;return e}},topAxisNoRenderer:function(a){return function(g,c,e,d,b,f,h){return ''}},topAxisRenderer:function(b){var c=this,a=b['renderer'];return function(d,g,i,h,f,j,k){var e=(d===0&&c.gridMaster.showZeroAsBlank);if(Ext.isFunction(a)){d=a.apply(this,arguments)}return e?'':d}}});Ext.define('Ext.pivot.Grid',{extend:'Ext.grid.Panel',alternateClassName:['Mz.pivot.Grid','Mz.pivot.Table'],xtype:['pivotgrid','mzpivotgrid'],requires:['Ext.pivot.matrix.Local','Ext.pivot.matrix.Remote','Ext.pivot.feature.PivotView','Ext.data.ArrayStore'],subGridXType:'gridpanel',isPivotGrid:!0,isPivotComponent:!0,enableLoadMask:!0,enableLocking:!1,enableColumnSort:!0,columnLines:!0,clsGroupTotal:Ext.baseCSSPrefix+'pivot-grid-group-total',clsGrandTotal:Ext.baseCSSPrefix+'pivot-grid-grand-total',startRowGroupsCollapsed:!0,startColGroupsCollapsed:!0,stateEvents:['pivotgroupexpand','pivotgroupcollapse','pivotdone'],groupHeaderCollapsedCls:Ext.baseCSSPrefix+'pivot-grid-group-header-collapsed',groupHeaderCollapsibleCls:Ext.baseCSSPrefix+'pivot-grid-group-header-collapsible',groupCls:Ext.baseCSSPrefix+'pivot-grid-group',relayedMatrixEvents:['beforereconfigure','reconfigure','start','progress','done','modelbuilt','columnsbuilt','recordbuilt','buildtotals','storebuilt','groupexpand','groupcollapse','beforerequest','requestexception'],deprecatedConfigs:['matrixConfig','leftAxis','topAxis','aggregate','showZeroAsBlank','textTotalTpl','textGrandTotalTpl','viewLayoutType','rowSubTotalsPosition','rowGrandTotalsPosition','colSubTotalsPosition','colGrandTotalsPosition'],config:{matrix:{type:'local'}},initComponent:function(){var a=this;a.columns=[];a.preInitialize();a.callParent(arguments);a.postInitialize()},preInitialize:function(){var a=this;a.features=[{id:'group',ftype:'pivotview',summaryRowCls:a.clsGroupTotal,grandSummaryRowCls:a.clsGrandTotal}];a.addCls(Ext.baseCSSPrefix+'pivot-grid');if(a.store){a.originalStore=a.store}a.store=new Ext.data.ArrayStore({fields:[]});a.enableColumnMove=!1},postInitialize:function(){var a=this,f={headerclick:a.onHeaderClick,scope:a,destroyable:!0},h=a.getView(),e=[],j=a.deprecatedConfigs,i=j.length,g=a.getMatrix(),c,b,d;if(a.enableLocking){a.lockedHeaderCtListeners=h.lockedView.getHeaderCt().on(f);a.headerCtListeners=h.normalView.getHeaderCt().on(f)}else {a.headerCtListeners=h.getHeaderCt().on(f)}for(c=0;c<i;c++){d=j[c];if(!!a[d]){e.push(d)}}if(e.length>0){b={};i=e.length;for(c=0;c<i;c++){d=e[c];if(d==='matrixConfig'){Ext.apply(b,a.matrixConfig)}else {b[d]=a[d]}}if(a.originalStore){b.store=a.originalStore}if(g){if(b.type&&g.type===b.type){g.reconfigure(b);return}}else {if(!b.type){b.type='local'}b.cmp=a}a.setMatrix(b)}},destroy:function(){var a=this;a.setMatrix(null);Ext.destroy(a.headerCtListeners,a.lockedHeaderCtListeners);Ext.destroy(a.originalStore);a.headerCtListeners=a.lockedHeaderCtListeners=null;a.originalStore=a.pivotColumns=null;a.callParent(arguments);Ext.destroy(a.store);a.store=null},applyMatrix:function(a,b){Ext.destroy(b);if(a==null){return a}if(a&&a.isPivotMatrix){a.cmp=this;return a}Ext.applyIf(a,{type:'local'});a.cmp=this;if(a.type=='local'&&this.originalStore){Ext.applyIf(a,{store:this.originalStore})}return Ext.Factory.pivotmatrix(a)},updateMatrix:function(c,d){var a=this,b;a.matrixRelayedListeners=a.matrixListeners=Ext.destroy(d,a.matrixListeners,a.matrixRelayedListeners);if(c){a.matrixListeners=a.matrix.on({cleardata:a.onMatrixClearData,start:a.onMatrixProcessStart,progress:a.onMatrixProcessProgress,done:a.onMatrixDataReady,afterupdate:a.onMatrixAfterUpdate,groupexpand:a.onMatrixGroupExpandCollapse,groupcollapse:a.onMatrixGroupExpandCollapse,scope:a,destroyable:!0});a.matrixRelayedListeners=a.relayEvents(a.matrix,a.relayedMatrixEvents,'pivot');b=a.getFeatureDataSource();if(b&&!a.isConfiguring){b.setMatrix(c)}}},refreshView:function(){var a=this;if(a.destroyed||a.destroying){return}a.store.fireEvent('pivotstoreremodel',a)},updateHeaderContainerColumns:function(f){var b=this,c=this.getView(),l=c.normalView?c.normalView.getHeaderCt():c.getHeaderCt(),g=c.normalGrid?c.normalGrid:b,i=0,j=[],a,k,d,h,e;if(f){e=b.getColumnForGroup(l.items,f);if(e.found){g.reconfiguring=!0;d=e.item.ownerCt;k=e.index;while(i<d.items.length){h=d.items.getAt(i);if(h.group==f){j.push(h)}i++}a=Ext.clone(b.pivotColumns);b.preparePivotColumns(a);a=b.getVisiblePivotColumns(b.prepareVisiblePivotColumns(a),f);a=d.insert(k,a);Ext.destroy(j);g.reconfiguring=!1;if(a&&a.length){a[0].focus()}g.onHeadersChanged()}}else {a=Ext.clone(b.pivotColumns);b.preparePivotColumns(a);a=b.prepareVisiblePivotColumns(a);b.reconfigure(undefined,a)}},getColumnForGroup:function(e,d){var f=e.length,a={found:!1,index:-1,item:null},c,b;for(c=0;c<f;c++){b=e.getAt(c);if(b.group==d){a.found=!0;a.index=c;a.item=b}else if(b.items){a=this.getColumnForGroup(b.items,d)}if(a.found){break}}return a},onMatrixClearData:function(){var a=this;a.store.removeAll(!0);if(!a.expandedItemsState){a.lastColumnsState=null}a.sortedColumn=null},onMatrixProcessStart:function(){if(this.enableLoadMask){this.setLoading(!0)}},onMatrixProcessProgress:function(f,e,d){var a=this,c=((e||0.1)*100)/(d||0.1),b;if(a.loadMask){if(a.loadMask.msgTextEl){b=a.loadMask.msgTextEl}else if(a.loadMask.msgEl){b=a.loadMask.msgEl}if(b){b.update(Ext.util.Format.number(c,'0')+'%')}}},onMatrixDataReady:function(a){this.refreshMatrixData(a,!1)},onMatrixAfterUpdate:function(b,a){if(a){this.refreshMatrixData(b,!0)}else {this.refreshView()}},onMatrixGroupExpandCollapse:function(c,b,a){if(b=='col'){this.updateHeaderContainerColumns(a)}},refreshMatrixData:function(b,j){var a=this,d=b.getColumnHeaders(),g=!1,h=b.leftAxis.items.items,i=b.topAxis.items.items,c,f,e;if(a.enableLoadMask){a.setLoading(!1)}if(!j){if(a.expandedItemsState){f=h.length;for(c=0;c<f;c++){e=h[c];if(Ext.Array.indexOf(a.expandedItemsState['rows'],e.value)>=0){e.expanded=!0;g=!0}}f=i.length;for(c=0;c<f;c++){e=i[c];if(Ext.Array.indexOf(a.expandedItemsState['cols'],e.value)>=0){e.expanded=!0;g=!0}}if(g){delete a.expandedItemsState}}else {if(b.collapsibleRows){a.doExpandCollapseTree(b.leftAxis.getTree(),!a.startRowGroupsCollapsed)}if(b.collapsibleColumns){a.doExpandCollapseTree(b.topAxis.getTree(),!a.startColGroupsCollapsed)}}}a.pivotColumns=Ext.clone(d);d=Ext.clone(a.pivotColumns);a.preparePivotColumns(d);a.restorePivotColumnsState(d);d=a.prepareVisiblePivotColumns(d);a.reconfigure(undefined,d);if(!Ext.isEmpty(a.sortedColumn)){b.leftAxis.sortTreeByField(a.sortedColumn.dataIndex,a.sortedColumn.direction)}a.store.fireEvent('pivotstoreremodel',a);if(!Ext.isEmpty(a.sortedColumn)){a.updateColumnSortState(a.sortedColumn.dataIndex,a.sortedColumn.direction)}},getVisiblePivotColumns:function(d,e){var b=[],f=d.length,c,a;for(c=0;c<f;c++){a=d[c];if(a.group==e){b.push(a)}if(a.columns){b=Ext.Array.merge(b,this.getVisiblePivotColumns(a.columns,e))}}return b},prepareVisiblePivotColumns:function(c){var e=c.length,d=[],b,a,f;for(b=0;b<e;b++){a=c[b];if(!a.hidden){d.push(a)}if(a.columns){a.columns=this.prepareVisiblePivotColumns(a.columns)}}return d},preparePivotColumns:function(d){var b=this,e={menuDisabled:!0,sortable:!1,lockable:!1},f=d.length,c,a;for(c=0;c<f;c++){a=d[c];a.cls=a.cls||'';Ext.apply(a,e);if(a.leftAxis){a.locked=b.enableLocking}if(a.subTotal){a.cls=a.tdCls=b.clsGroupTotal}if(a.grandTotal){a.cls=a.tdCls=b.clsGrandTotal}if(a.group&&a.xgrouped){if(a.group.expanded){if(!a.subTotal&&b.matrix.collapsibleColumns){a.cls+=(Ext.isEmpty(a.cls)?'':' ')+b.groupHeaderCollapsibleCls}}else {if(a.subTotal&&b.matrix.collapsibleColumns){a.cls+=(Ext.isEmpty(a.cls)?'':' ')+b.groupHeaderCollapsibleCls+' '+b.groupHeaderCollapsedCls}}if(a.subTotal){a.text=a.group.expanded?a.group.getTextTotal():Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',a.group.name)}else if(a.group){a.text=Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',a.group.name)}a.xexpandable=a.subTotal?!a.group.expanded:a.group.expanded;if((!a.group.expanded&&!a.subTotal)||(a.group.expanded&&a.subTotal&&this.getMatrix().colSubTotalsPosition=='none')){a.hidden=!0}}if(Ext.isEmpty(a.columns)){if(a.dimension){a.renderer=a.dimension?a.dimension.getRenderer():!1;a.formatter=a.dimension?a.dimension.getFormatter():!1;a.scope=a.dimension?a.dimension.scope:null;a.align=a.dimension.align;if(a.dimension.flex>0){a.flex=a.flex||a.dimension.flex}else {a.width=a.width||a.dimension.width}}}else {a.focusable=!0;a.enableFocusableContainer=!0;b.preparePivotColumns(a.columns)}}},reconfigurePivot:function(a){var b=this.getMatrix();a=a||{};if(b){if(a.type&&b.type!==a.type){this.setMatrix(a)}else {b.reconfigure(a)}}else {this.setMatrix(a)}},doExpandCollapseTree:function(b,c){var a;for(a=0;a<b.length;a++){b[a].expanded=c;if(b[a].children){this.doExpandCollapseTree(b[a].children,c)}}},doExpandCollapse:function(f,e,b,d){var c=this.getMatrix(),a;if(!c){return}a=(f=='row'?c.leftAxis:c.topAxis)['findTreeElement']('key',e);if(!a){return}a=a.node;b=Ext.isDefined(b)?b:!a.expanded;if(b){a.expand(d)}else {a.collapse(d)}},setHeaderGroupVisibility:function(a){var e,d,c,b;if(a.xgrouped){if(a.subTotal){a.setText(a.group.expanded?a.group.getTextTotal():Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',a.group.name));if(!a.group.expanded){a.addCls(this.groupHeaderCollapsibleCls);a.addCls(this.groupHeaderCollapsedCls)}else {a.removeCls(this.groupHeaderCollapsibleCls);a.removeCls(this.groupHeaderCollapsedCls)}}else {a.setText(Ext.String.format('<span class="'+this.groupCls+'">{0}</span>',a.group.name));a.addCls(this.groupHeaderCollapsibleCls)}a.xexpandable=a.subTotal?!a.group.expanded:a.group.expanded;if((!a.group.expanded&&!a.subTotal)||(a.group.expanded&&a.subTotal&&this.getMatrix().colSubTotalsPosition=='none')){a.hide();return}}a.show();a.items.each(this.setHeaderGroupVisibility,this)},expandRow:function(b,a){this.doExpandCollapse('row',b,!0,a)},collapseRow:function(b,a){this.doExpandCollapse('row',b,!1,a)},expandCol:function(b,a){this.doExpandCollapse('col',b,!0,a)},collapseCol:function(b,a){this.doExpandCollapse('col',b,!1,a)},expandAll:function(){this.expandAllColumns();this.expandAllRows()},expandAllRows:function(){this.getMatrix().leftAxis.expandAll()},expandAllColumns:function(){this.getMatrix().topAxis.expandAll()},collapseAll:function(){this.collapseAllRows();this.collapseAllColumns()},collapseAllRows:function(){this.getMatrix().leftAxis.collapseAll()},collapseAllColumns:function(){this.getMatrix().topAxis.collapseAll()},setStore:function(b){var a=this.getMatrix();if(a&&a.type==='local'){a.initializeStore({store:b})}},getStore:function(){var a=this,b=a.getMatrix();return ((b instanceof Ext.pivot.matrix.Local)?b.store:a.originalStore)||a.store},getPivotStore:function(){return this.store},getTopAxisItem:function(d){var f=this,e=f.getMatrix(),b=e.getColumns(),c,a;if(!d){return null}for(a=0;a<b.length;a++){if(b[a].name===d.dataIndex){c=b[a].col;break}}return Ext.isEmpty(c)?null:e.topAxis.items.getByKey(c)},getLeftAxisItem:function(c){var b=this.getFeatureDataSource(),a;if(!c||!b){return null}a=b.storeInfo[c.internalId];return a?this.getMatrix().leftAxis.items.getByKey(a.leftKey):null},getFeatureDataSource:function(){var a=this.rendered?this.getView():null,b;if(!a){return}a=a.normalView||a;b=a.getFeature('group');return b?b.dataSource:null},onHeaderClick:function(e,a,d){var b=this,c=(a.sortState?(a.sortState=='ASC'?'DESC':'ASC'):'ASC');if(d){d.stopEvent()}if(!a.xexpandable){if(!b.enableColumnSort){return}if((a.leftAxis||a.topAxis)&&!Ext.isEmpty(a.dataIndex)){if(b.getMatrix().leftAxis.sortTreeByField(a.dataIndex,c)){b.refreshView();b.updateColumnSortState(a,c)}}return !1}if(b.matrix.collapsibleColumns){b.doExpandCollapse('col',a.key)}return !1},updateColumnSortState:function(a,b){if(Ext.isString(a)){a=this.down('[dataIndex="'+a+'"]')}if(!a){return}a.setSortState(new Ext.util.Sorter({direction:b,property:'dummy'}));a.sortState=b;this.sortedColumn={dataIndex:a.dataIndex,direction:b}},getStateProperties:function(){return ['enableColumnSort','sortedColumn','startRowGroupsCollapsed','startColGroupsCollapsed']},applyState:function(a){var b=this,f=b.getStateProperties(),e=b.getMatrix(),d,c;for(d=0;d<f.length;d++){c=f[d];if(a[c]){b[c]=a[c]}}if(a['expandedItems']){b.expandedItemsState=a['expandedItems']}b.lastColumnsState=a['pivotcolumns']||{};if(e){e.reconfigure(a.matrix)}else {b.setMatrix(a.matrix)}},getState:function(){var c={},f=this.getStateProperties(),b=this.getMatrix(),a,e,d;e=f.length;for(a=0;a<e;a++){c[f[a]]=this[f[a]]}c.expandedItems={cols:[],rows:[]};if(b){c.matrix=b.serialize();e=b.leftAxis.items.getCount();for(a=0;a<e;a++){d=b.leftAxis.items.getAt(a);if(d.expanded){c.expandedItems.rows.push(d.value)}}e=b.leftAxis.dimensions.getCount();for(a=0;a<e;a++){d=b.leftAxis.dimensions.getAt(a);c.matrix.leftAxis[a]['id']=d.getId()}e=b.topAxis.items.getCount();for(a=0;a<e;a++){d=b.topAxis.items.getAt(a);if(d.expanded){c.expandedItems.cols.push(d.value)}}}c.pivotcolumns=this.getPivotColumnsState();return c},getPivotColumnsState:function(){var c=this,a,b;if(!c.lastColumnsState){b=c.getDataIndexColumns(c.getMatrix().getColumnHeaders());c.lastColumnsState={};for(a=0;a<b.length;a++){if(b[a].dataIndex){c.lastColumnsState[b[a].dataIndex]={width:b[a].width,flex:b[a].flex||0}}}}b=c.getView().getGridColumns();for(a=0;a<b.length;a++){if(b[a].dataIndex){c.lastColumnsState[b[a].dataIndex]={width:b[a].rendered?b[a].getWidth():b[a].width,flex:b[a].flex||0}}}return c.lastColumnsState},getDataIndexColumns:function(b){var c=[],a;for(a=0;a<b.length;a++){if(b[a].dataIndex){c.push(b[a].dataIndex)}else if(Ext.isArray(b[a].columns)){c=Ext.Array.merge(c,this.getDataIndexColumns(b[a].columns))}}return c},restorePivotColumnsState:function(a){this.parsePivotColumnsState(this.getPivotColumnsState(),a)},parsePivotColumnsState:function(d,b){var c,a;if(!b){return}for(a=0;a<b.length;a++){c=d[b[a].dataIndex];if(c){if(c.flex){b[a].flex=c.flex}else if(c.width){b[a].width=c.width}}this.parsePivotColumnsState(d,b[a].columns)}},deprecated:{'6.2':{properties:{matrixConfig:null,viewLayoutType:'outline',rowSubTotalsPosition:'first',rowGrandTotalsPosition:'last',colSubTotalsPosition:'last',colGrandTotalsPosition:'last',textTotalTpl:'Total ({name})',textGrandTotalTpl:'Grand total',showZeroAsBlank:!1,leftAxis:null,topAxis:null,aggregate:null}}}});Ext.define('Ext.pivot.plugin.CellEditing',{extend:'Ext.grid.plugin.CellEditing',alias:'plugin.pivotcellediting',requires:['Ext.pivot.update.Increment','Ext.pivot.update.Overwrite','Ext.pivot.update.Percentage','Ext.pivot.update.Uniform'],defaultUpdater:'uniform',defaultValue:null,updater:null,init:function(b){var a=this;a.callParent([b]);a.pivot=b.isPivotGrid?b:b.up('pivotgrid');a.mon(a,{beforeedit:a.onBeforeEdit,priority:1000,scope:a});if(!a.pivot.isCellEditingAttached){a.mon(a.pivot,{pivotcolumnsbuilt:a.addColumnEditors,scope:a});a.pivot.isCellEditingAttached=!0}a.updater=Ext.Factory.pivotupdate({type:a.defaultUpdater});a.pivot.relayEvents(a.updater,['beforeupdate','update'],'pivot')},destroy:function(){var a=this;a.pivot.isCellEditingAttached=!1;a.pivot=a.updater=Ext.destroy(a.updater);a.callParent()},addColumnEditors:function(d,c){var e=c.length,a,b;for(b=0;b<e;b++){a=c[b];if(a.dimension&&a.dimension.editor){a.editor=Ext.clone(a.dimension.editor)}if(a.columns){this.addColumnEditors(d,a.columns)}}},isCellEditable:function(b,a){return this.callParent([b,a])&&Boolean(this.getPivotResult(this.getEditingContext(b,a)))},onBeforeEdit:function(b,a){if(!Ext.isEmpty(this.defaultValue)){a.value=this.defaultValue}return this.isCellEditable(a.record,a.column)},getPivotResult:function(c){var a=this.pivot.getMatrix(),b=this.pivot.getLeftAxisItem(c.record),d=this.pivot.getTopAxisItem(c.column);return a.results.get(b?b.key:a.grandTotalKey,d?d.key:a.grandTotalKey)},updateRecords:function(a,f){var c=this.pivot,b=c.getMatrix(),d=c.getLeftAxisItem(a.record),e=c.getTopAxisItem(a.column);this.updater.setConfig({leftKey:d?d.key:b.grandTotalKey,topKey:e?e.key:b.grandTotalKey,matrix:b,dataIndex:a.column.dimension.dataIndex,value:f});this.updater.update()},onEditComplete:function(f,d,g){var a=this,b=f.context,e,c,h;e=b.view;c=b.record;b.value=d;if(!a.validateEdit(b)){a.editing=!1;return}a.updateRecords(b,d);b.rowIdx=e.indexOf(c);a.fireEvent('edit',a,b);if(a.context===b){a.setActiveEditor(null);a.setActiveColumn(null);a.setActiveRecord(null);a.editing=!1}}});Ext.define('Ext.pivot.plugin.configurator.window.Window',{extend:'Ext.window.Window',requires:['Ext.form.Panel','Ext.form.FieldContainer','Ext.form.field.Text','Ext.form.field.Hidden','Ext.form.field.ComboBox','Ext.layout.container.HBox'],modal:!0,closeAction:'destroy',initComponent:function(){var a=this;Ext.apply(a,{layout:'fit',items:[a.getSettingsForm()],buttons:[{text:Ext.Msg.buttonText.ok,handler:a.applySettings,scope:a},{text:Ext.Msg.buttonText.cancel,handler:a.cancelSettings,scope:a}]});return a.callParent(arguments)},beforeApplySettings:Ext.emptyFn,getSettingsForm:function(){return {xtype:'form',bodyPadding:5,items:[]}},loadSettings:function(b){var a=this.down('form');if(a){a.getForm().setValues(b||{})}},applySettings:function(){var b=this.down('form'),a;if(b&&b.getForm().isValid()){a=b.getForm().getValues();if(this.beforeApplySettings(a)!==!1){if(this.fireEvent('applysettings',this,a)!==!1){this.cancelSettings()}}}},cancelSettings:function(){this.close()}});Ext.define('Ext.pivot.plugin.configurator.window.FilterLabel',{extend:'Ext.pivot.plugin.configurator.window.Window',titleText:'Label filter ({0})',fieldText:'Show items for which the label',caseSensitiveText:'Case sensitive',initComponent:function(){var a=this;a.callParent(arguments);a.setTitle(Ext.String.format(a.titleText,a.title))},getSettingsForm:function(){var a=this,b=a.filterFields||[];b.push({xtype:'combo',editable:!1,queryMode:'local',valueField:'value',store:a.store,name:'operator',listeners:{change:function(d,c){var a=this,b=a.isOperatorBetween(c);a.down('#fValue').setVisible(!b);a.down('#fValue').allowBlank=b;a.down('#fFrom').setVisible(b);a.down('#fFrom').allowBlank=!b;a.down('#fTo').setVisible(b);a.down('#fTo').allowBlank=!b},scope:a}},{itemId:'fValue',xtype:'textfield',margin:'0 0 0 5',name:'value'},{itemId:'fFrom',xtype:'textfield',margin:'0 0 0 5',name:'from'},{itemId:'fTo',xtype:'textfield',margin:'0 0 0 5',name:'to'});return Ext.apply(a.callParent(arguments),{items:[{xtype:'hidden',name:'type'},{xtype:'fieldcontainer',labelSeparator:'',fieldLabel:a.fieldText,labelAlign:'top',layout:{type:'hbox',align:'stretch'},defaults:{allowBlank:!1,flex:1},items:b},{xtype:'checkbox',boxLabel:a.caseSensitiveText,name:'caseSensitive'}]})},beforeApplySettings:function(a){if(this.isOperatorBetween(a.operator)){a.value=[a.from,a.to]}delete (a.from);delete (a.to);a.caseSensitive=(a.caseSensitive==='on');a.topSort=(a.topSort==='on')},isOperatorBetween:function(a){return Ext.Array.indexOf(['between','not between'],a)>=0}});Ext.define('Ext.pivot.plugin.configurator.window.FilterValue',{extend:'Ext.pivot.plugin.configurator.window.FilterLabel',titleText:'Value filter ({0})',fieldText:'Show items for which',initComponent:function(){var a=this;a.filterFields=[{xtype:'combo',editable:!1,queryMode:'local',valueField:'value',store:a.storeAgg,name:'dimensionId'}];a.callParent(arguments)}});Ext.define('Ext.pivot.plugin.configurator.window.FilterTop',{extend:'Ext.pivot.plugin.configurator.window.Window',titleText:'Top 10 filter ({0})',fieldText:'Show',sortResultsText:'Sort results',initComponent:function(){var a=this;a.callParent(arguments);a.setTitle(Ext.String.format(a.titleText,a.title))},getSettingsForm:function(){var a=this,b=[];b.push({xtype:'combo',editable:!1,queryMode:'local',valueField:'value',store:a.storeTopOrder,name:'topOrder'},{xtype:'textfield',margin:'0 0 0 5',name:'value'},{xtype:'combo',margin:'0 0 0 5',editable:!1,queryMode:'local',valueField:'value',store:a.storeTopType,name:'topType'},{xtype:'combo',margin:'0 0 0 5',editable:!1,queryMode:'local',valueField:'value',store:a.storeAgg,name:'dimensionId'});return Ext.apply(a.callParent(arguments),{defaults:{allowBlank:!1},items:[{xtype:'hidden',name:'type'},{xtype:'hidden',name:'operator'},{xtype:'fieldcontainer',labelSeparator:'',fieldLabel:a.fieldText,labelAlign:'top',layout:{type:'hbox',align:'stretch'},defaults:{flex:1,allowBlank:!1},items:b},{xtype:'checkbox',boxLabel:a.sortResultsText,name:'topSort'}]})}});Ext.define('Ext.pivot.plugin.configurator.window.FieldSettings',{extend:'Ext.pivot.plugin.configurator.window.Window',requires:['Ext.form.field.Display'],title:'Field settings',formatText:'Format as',summarizeByText:'Summarize by',customNameText:'Custom name',sourceNameText:'Source name',alignText:'Align',alignLeftText:'Left',alignCenterText:'Center',alignRightText:'Right',field:null,getSettingsForm:function(){var b=this,e=[],h=[],f=b.field.getSettings(),i=f.getFormatters(),j=f.getRenderers(),g=f.getAggregators(),d,a,c;d=g.length;for(a=0;a<d;a++){h.push([b.field.getAggText(g[a]),g[a]])}c=Ext.Object.getAllKeys(i||{});d=c.length;for(a=0;a<d;a++){e.push([c[a],i[c[a]],1])}c=Ext.Object.getAllKeys(j||{});d=c.length;for(a=0;a<d;a++){e.push([c[a],j[c[a]],2])}return Ext.apply(b.callParent(arguments),{items:[{xtype:'displayfield',fieldLabel:b.sourceNameText,name:'dataIndex'},{xtype:'textfield',fieldLabel:b.customNameText,name:'header',allowBlank:!1},{xtype:'combo',fieldLabel:b.alignText,editable:!1,queryMode:'local',valueField:'value',name:'align',store:new Ext.data.ArrayStore({fields:['text','value'],data:[[b.alignLeftText,'left'],[b.alignCenterText,'center'],[b.alignRightText,'right']]})},{xtype:'combo',fieldLabel:b.formatText,editable:!1,queryMode:'local',valueField:'value',name:'formatter',store:new Ext.data.ArrayStore({fields:['text','value','type'],data:e})},{xtype:'combo',fieldLabel:b.summarizeByText,editable:!1,queryMode:'local',valueField:'value',name:'aggregator',store:new Ext.data.ArrayStore({fields:['text','value'],data:h})}]})},beforeApplySettings:function(a){var c=this.down('[name=formatter]'),d,b;if(c){d=c.getStore();b=d.findRecord('value',a.formatter,0,!1,!0,!0);if(b){if(b.get('type')==1){a.formatter=b.get('value');a.renderer=null}else {a.renderer=b.get('value');a.formatter=null}}}},loadSettings:function(a){var b=a.formatter;if(Ext.isFunction(b)){b=null}if(!b&&!Ext.isFunction(a.renderer)){b=a.renderer}a.formatter=b;this.callParent([a])}});Ext.define('Ext.pivot.plugin.configurator.Column',{extend:'Ext.Component',requires:['Ext.menu.Menu','Ext.menu.CheckItem','Ext.menu.Item','Ext.menu.Separator','Ext.pivot.plugin.configurator.Field','Ext.pivot.plugin.configurator.window.FilterLabel','Ext.pivot.plugin.configurator.window.FilterValue','Ext.pivot.plugin.configurator.window.FilterTop','Ext.pivot.plugin.configurator.window.FieldSettings'],alias:'widget.pivotconfigfield',childEls:['textCol','filterCol','sortCol'],tabIndex:0,focusable:!0,isConfiguratorField:!0,renderTpl:'<div id="{id}-configCol" role="button" class="'+Ext.baseCSSPrefix+'pivot-grid-config-column-inner" >'+'<span id="{id}-customCol" role="presentation" class="'+Ext.baseCSSPrefix+'pivot-grid-config-column-btn-customize '+Ext.baseCSSPrefix+'border-box '+Ext.baseCSSPrefix+'pivot-grid-config-column-btn '+Ext.baseCSSPrefix+'pivot-grid-config-column-btn-image"></span>'+'<span id="{id}-sortCol" role="presentation" data-ref="sortCol" class="'+Ext.baseCSSPrefix+'border-box '+Ext.baseCSSPrefix+'pivot-grid-config-column-btn"></span>'+'<span id="{id}-filterCol" role="presentation" data-ref="filterCol" class="'+Ext.baseCSSPrefix+'border-box '+Ext.baseCSSPrefix+'pivot-grid-config-column-btn"></span>'+'<span id="{id}-textCol" role="presentation" data-ref="textCol" data-qtip="{header}" class="'+Ext.baseCSSPrefix+'pivot-grid-config-column-text '+Ext.baseCSSPrefix+'column-header-text '+Ext.baseCSSPrefix+'border-box">'+'{header}'+'</span>'+'</div>',header:'&#160;',minWidth:80,sortAscText:'Sort A to Z',sortDescText:'Sort Z to A',sortClearText:'Disable sorting',clearFilterText:'Clear filter from "{0}"',labelFiltersText:'Label filters',valueFiltersText:'Value filters',equalsText:'Equals...',doesNotEqualText:'Does not equal...',beginsWithText:'Begins with...',doesNotBeginWithText:'Does not begin with...',endsWithText:'Ends with...',doesNotEndWithText:'Does not end with...',containsText:'Contains...',doesNotContainText:'Does not contain...',greaterThanText:'Greater than...',greaterThanOrEqualToText:'Greater than or equal to...',lessThanText:'Less than...',lessThanOrEqualToText:'Less than or equal to...',betweenText:'Between...',notBetweenText:'Not between...',top10Text:'Top 10...',equalsLText:'equals',doesNotEqualLText:'does not equal',beginsWithLText:'begins with',doesNotBeginWithLText:'does not begin with',endsWithLText:'ends with',doesNotEndWithLText:'does not end with',containsLText:'contains',doesNotContainLText:'does not contain',greaterThanLText:'is greater than',greaterThanOrEqualToLText:'is greater than or equal to',lessThanLText:'is less than',lessThanOrEqualToLText:'is less than or equal to',betweenLText:'is between',notBetweenLText:'is not between',top10LText:'Top 10...',topOrderTopText:'Top',topOrderBottomText:'Bottom',topTypeItemsText:'Items',topTypePercentText:'Percent',topTypeSumText:'Sum',baseCls:Ext.baseCSSPrefix+'pivot-grid-config-column',btnIconCls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn-image',setFilterIconCls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn-filter-set',clearFilterIconCls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn-filter-clear',ascSortIconCls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn-sort-asc',descSortIconCls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn-sort-desc',clearSortIconCls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn-sort-clear',overCls:Ext.baseCSSPrefix+'pivot-grid-config-column-over',cls:Ext.baseCSSPrefix+'unselectable',config:{fieldType:'all',field:null},destroy:function(){this.setField(null);this.callParent()},initRenderData:function(){var a=this.getField();return Ext.apply(this.callParent(arguments),{header:this.getFieldType()=='aggregate'?a.getFieldText():a.getHeader(),dimension:a})},afterRender:function(){var a=this,b=a.getField(),c=b.getSettings();a.callParent();if(Ext.Array.indexOf(['leftAxis','topAxis'],a.getFieldType())>=0){if(!Ext.isDefined(b.sortable)||b.sortable){a.addSortCls(b.direction)}if(b.filter){a.addFilterCls()}}a.textCol.setStyle(c.getStyle());a.addCls(c.getCls())},getMenuConfig:function(){var a=this.getFieldType();if(a=='leftAxis'||a=='topAxis'){return this.getColMenuConfig()}},addSortCls:function(b){var a=this;if(!a.sortCol){return}if(b==='ASC'||!b){a.sortCol.addCls(a.ascSortIconCls);a.sortCol.removeCls(a.descSortIconCls)}else {a.sortCol.addCls(a.descSortIconCls);a.sortCol.removeCls(a.ascSortIconCls)}a.sortCol.addCls(a.btnIconCls)},removeSortCls:function(b){var a=this;if(!a.sortCol){return}if(b==='ASC'){a.sortCol.removeCls(a.ascSortIconCls)}else {a.sortCol.removeCls(a.descSortIconCls)}a.sortCol.removeCls(a.btnIconCls)},addFilterCls:function(){var a=this;if(a.filterCol&&!a.filterCol.hasCls(a.setFilterIconCls)){a.filterCol.addCls(a.setFilterIconCls);a.filterCol.addCls(a.btnIconCls)}},removeFilterCls:function(){var a=this;if(a.filterCol){a.filterCol.removeCls(a.setFilterIconCls);a.filterCol.removeCls(a.btnIconCls)}},getColMenuConfig:function(){var a=this,g=[],d,e,f,b,c=a.getField().filter;g.push({text:a.sortAscText,direction:'ASC',iconCls:a.ascSortIconCls,handler:a.sortMe},{text:a.sortDescText,direction:'DESC',iconCls:a.descSortIconCls,handler:a.sortMe},{text:a.sortClearText,direction:'',disabled:a.getField().sortable===!1,iconCls:a.clearSortIconCls,handler:a.sortMe},{xtype:'menuseparator'});f=[{text:a.equalsText,operator:'='},{text:a.doesNotEqualText,operator:'!='},{xtype:'menuseparator'},{text:a.greaterThanText,operator:'>'},{text:a.greaterThanOrEqualToText,operator:'>='},{text:a.lessThanText,operator:'<'},{text:a.lessThanOrEqualToText,operator:'<='},{xtype:'menuseparator'},{text:a.betweenText,operator:'between'},{text:a.notBetweenText,operator:'not between'}];d=Ext.clone(f);Ext.Array.insert(d,3,[{text:a.beginsWithText,operator:'begins'},{text:a.doesNotBeginWithText,operator:'not begins'},{text:a.endsWithText,operator:'ends'},{text:a.doesNotEndWithText,operator:'not ends'},{xtype:'menuseparator'},{text:a.containsText,operator:'contains'},{text:a.doesNotContainText,operator:'not contains'},{xtype:'menuseparator'}]);for(b=0;b<d.length;b++){d[b]['checked']=(c&&c.type=='label'&&c.operator==d[b].operator)}e=Ext.clone(f);e.push({xtype:'menuseparator'},{text:a.top10Text,operator:'top10'});for(b=0;b<e.length;b++){e[b]['checked']=(c&&c.type=='value'&&c.operator==e[b].operator)}g.push({text:Ext.String.format(a.clearFilterText,a.header),iconCls:a.clearFilterIconCls,disabled:!c,handler:a.onRemoveFilter},{text:a.labelFiltersText,menu:{defaults:{handler:a.onShowFilter,scope:a,xtype:'menucheckitem',group:'filterlabel',type:'label'},items:d}},{text:a.valueFiltersText,menu:{defaults:{handler:a.onShowFilter,scope:a,xtype:'menucheckitem',group:'filtervalue',type:'value'},items:e}});return {defaults:{scope:a},items:g}},sortMe:function(c){var b=this,a=b.getField();if(Ext.isEmpty(c.direction)){a.setSortable(!1);b.removeSortCls(a.getDirection())}else {a.setSortable(!0);b.addSortCls(c.direction);a.setDirection(c.direction)}b.applyChanges()},onShowFilter:function(c){var a=this,m=a.up('pivotconfigpanel'),h=[],e={},b=a.getField().getFilter(),i={type:c.type,operator:c.operator,value:(b?b.value:''),from:(b?(Ext.isArray(b.value)?b.value[0]:''):''),to:(b?(Ext.isArray(b.value)?b.value[1]:''):''),caseSensitive:(b?b.caseSensitive:!1),topSort:(b?b.topSort:!1)},l=m.getAggregateContainer().items,n=l.getCount(),k,d,f,g,j;for(g=0;g<n;g++){j=l.getAt(g).getField();h.push([j.getHeader(),j.getId()])}if(c.type=='label'||(c.type=='value'&&c.operator!='top10')){f=[[a.equalsLText,'='],[a.doesNotEqualLText,'!='],[a.greaterThanLText,'>'],[a.greaterThanOrEqualToLText,'>='],[a.lessThanLText,'<'],[a.lessThanOrEqualToLText,'<='],[a.betweenLText,'between'],[a.notBetweenLText,'not between']];if(c.type=='label'){Ext.Array.insert(f,3,[[a.beginsWithLText,'begins'],[a.doesNotBeginWithLText,'not begins'],[a.endsWithLText,'ends'],[a.doesNotEndWithLText,'not ends'],[a.containsLText,'contains'],[a.doesNotContainLText,'not contains']]);d='Ext.pivot.plugin.configurator.window.FilterLabel'}else {d='Ext.pivot.plugin.configurator.window.FilterValue';Ext.apply(i,{dimensionId:(b?b.dimensionId:'')});e.storeAgg=new Ext.data.ArrayStore({fields:['text','value'],data:h})}e.store=new Ext.data.ArrayStore({fields:['text','value'],data:f})}else {d='Ext.pivot.plugin.configurator.window.FilterTop';f=[];Ext.apply(e,{storeTopOrder:new Ext.data.ArrayStore({fields:['text','value'],data:[[a.topOrderTopText,'top'],[a.topOrderBottomText,'bottom']]}),storeTopType:new Ext.data.ArrayStore({fields:['text','value'],data:[[a.topTypeItemsText,'items'],[a.topTypePercentText,'percent'],[a.topTypeSumText,'sum']]}),storeAgg:new Ext.data.ArrayStore({fields:['text','value'],data:h})});Ext.apply(i,{operator:'top10',dimensionId:(b?b.dimensionId:''),topType:(b?b.topType:'items'),topOrder:(b?b.topOrder:'top')})}k=Ext.create(d,Ext.apply(e||{},{title:a.header,listeners:{applysettings:Ext.bind(a.onApplyFilterSettings,a)}}));k.loadSettings(i);k.show()},onApplyFilterSettings:function(c,b){var a=this;c.close();a.addFilterCls();a.getField().setFilter(b);a.applyChanges()},onRemoveFilter:function(){var a=this;a.removeFilterCls();a.getField().setFilter(null);a.applyChanges()},applyChanges:function(){if(this.ownerCt){this.ownerCt.applyChanges(this)}}});Ext.define('Ext.pivot.plugin.configurator.Container',{extend:'Ext.panel.Panel',requires:['Ext.pivot.plugin.configurator.Column'],mixins:['Ext.mixin.FocusableContainer'],alias:'widget.pivotconfigcontainer',childEls:['innerCt'],handleSorting:!1,handleFiltering:!1,position:'top',border:!1,enableFocusableContainer:!0,isConfiguratorContainer:!0,cls:Ext.baseCSSPrefix+'pivot-grid-config-container-body',dockedTopRightCls:Ext.baseCSSPrefix+'pivot-grid-config-container-body-tr',dockedBottomLeftCls:Ext.baseCSSPrefix+'pivot-grid-config-container-body-bl',hintTextCls:Ext.baseCSSPrefix+'pivot-grid-config-container-hint',config:{fieldType:'all',dragDropText:'&nbsp;'},initComponent:function(){var a=this;if(a.position=='top'||a.position=='bottom'){Ext.apply(a,{style:'overflow:hidden',layout:'column',height:'auto'})}else {Ext.apply(a,{layout:{type:'vbox',align:'stretch'}})}if(a.position=='top'||a.position=='right'){a.cls+=' '+a.dockedTopRightCls}else {a.cls+=' '+a.dockedBottomLeftCls}a.callParent(arguments)},destroy:function(){this.infoEl=Ext.destroy(this.infoEl);this.callParent()},afterRender:function(){var a=this;a.callParent();a.infoEl=a.innerCt.createChild({cls:a.hintTextCls,html:a.getDragDropText()});a.setInfoElVisibility()},applyChanges:function(a,b){if(this.getFieldType()!='all'||b===!0){this.fireEvent('configchange',a||this)}},addField:function(c,e,f){var b=this,d={xtype:'pivotconfigfield',field:c,header:c.getHeader(),touchAction:{panX:!1,panY:!1}},a;c.isAggregate=(b.getFieldType()==='aggregate');if(e!==-1){a=b.insert(e,d)}else {a=b.add(d)}if(f===!0){b.applyChanges(a)}return a},onAdd:function(a){this.setInfoElVisibility();a.setFieldType(this.getFieldType());this.callParent(arguments)},onRemove:function(){this.setInfoElVisibility()},moveField:function(a,b,d){var c=this;if(Ext.isString(a)){a=c.items.getByKey(a)}if(Ext.isString(b)){b=c.items.getByKey(b)}if(a!=b){c['move'+Ext.String.capitalize(d)](a,b);c.applyChanges(a)}},removeField:function(a){this.remove(a);this.applyChanges()},setInfoElVisibility:function(){var a=this.infoEl;if(!a){return}if(this.items.getCount()==0){a.show()}else {a.hide()}}});Ext.define('Ext.pivot.plugin.configurator.DragZone',{extend:'Ext.dd.DragZone',configColumnSelector:'.'+Ext.baseCSSPrefix+'pivot-grid-config-column',configColumnInnerSelector:'.'+Ext.baseCSSPrefix+'pivot-grid-config-column-inner',maxProxyWidth:120,dragging:!1,constructor:function(a){this.panel=a;this.ddGroup=this.getDDGroup();this.callParent([a.el])},getDDGroup:function(){return 'configurator-'+this.panel.id},getDragData:function(e){var b,a,d,c;if(e.getTarget(this.configColumnInnerSelector)){b=e.getTarget(this.configColumnSelector);if(b){a=Ext.getCmp(b.id);a.focus();c=a.getField();if(!this.panel.dragging&&c&&!c.getSettings().isFixed(a.ownerCt)){d=document.createElement('div');d.innerHTML=a.header;return {ddel:d,header:a}}}}return !1},onBeforeDrag:function(){return !(this.panel.dragging||this.disabled)},onInitDrag:function(){this.panel.dragging=!0;this.callParent(arguments)},onDragDrop:function(){this.panel.dragging=!1;this.callParent(arguments)},afterRepair:function(){this.callParent();this.panel.dragging=!1},getRepairXY:function(){return this.dragData.header.el.getXY()},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1}});Ext.define('Ext.pivot.plugin.configurator.DropZone',{extend:'Ext.dd.DropZone',proxyOffsets:[-4,-9],configPanelCls:Ext.baseCSSPrefix+'pivot-grid-config-container-body',configColumnCls:Ext.baseCSSPrefix+'pivot-grid-config-column',constructor:function(a){this.panel=a;this.ddGroup=this.getDDGroup();this.callParent([a.id])},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},getDDGroup:function(){return 'configurator-'+this.panel.id},getTargetFromEvent:function(a){return a.getTarget('.'+this.configColumnCls)||a.getTarget('.'+this.configPanelCls)},getTopIndicator:function(){if(!this.topIndicator){this.self.prototype.topIndicator=Ext.DomHelper.append(Ext.getBody(),{cls:'col-move-top '+Ext.baseCSSPrefix+'col-move-top',html:"&#160;"},!0);this.self.prototype.indicatorXOffset=Math.floor((this.topIndicator.dom.offsetWidth+1)/2)}return this.topIndicator},getBottomIndicator:function(){if(!this.bottomIndicator){this.self.prototype.bottomIndicator=Ext.DomHelper.append(Ext.getBody(),{cls:'col-move-bottom '+Ext.baseCSSPrefix+'col-move-bottom',html:"&#160;"},!0)}return this.bottomIndicator},getLocation:function(e,b,f){var g=f.getXY()[0],c=Ext.getCmp(b.id),a,d;if(c instanceof Ext.pivot.plugin.configurator.Container){if(c.items.getCount()>0){a=Ext.fly(c.items.last().el).getRegion()}else {a=new Ext.util.Region(0,1000000,0,0)}}else {a=Ext.fly(b).getRegion()}if((a.right-g)<=(a.right-a.left)/2){d="after"}else {d="before"}return e.dropLocation={pos:d,header:Ext.getCmp(b.id),node:b}},positionIndicator:function(t,v,w){var a=this,i=t.header,q=a.getLocation(t,v,w),b=q.header,g=q.pos,r,s,d,c,k,h,f,e,j,p,o,n,u,m,l;if(b===a.lastTargetHeader&&g===a.lastDropPos){return}r=i.nextSibling('pivotconfigfield:not([hidden])');s=i.previousSibling('pivotconfigfield:not([hidden])');a.lastTargetHeader=b;a.lastDropPos=g;if((i!==b)&&((g==="before"&&r!==b)||(g==="after"&&s!==b))&&!b.isDescendantOf(i)){n=Ext.dd.DragDropManager.getRelated(a);u=n.length;m=0;for(;m<u;m++){l=n[m];if(l!==a&&l.invalidateDrop){l.invalidateDrop()}}a.valid=!0;d=a.getTopIndicator();c=a.getBottomIndicator();if(g==='before'){k='bc-tl';h='tc-bl'}else {k='bc-tr';h='tc-br'}if(b.isConfiguratorContainer&&b.items.getCount()>0){f=d.getAlignToXY(b.items.last().el,k);e=c.getAlignToXY(b.items.last().el,h)}else {f=d.getAlignToXY(b.el,k);e=c.getAlignToXY(b.el,h)}j=a.panel.el;p=j.getX()-a.indicatorXOffset;o=j.getX()+j.getWidth();f[0]=Ext.Number.constrain(f[0],p,o);e[0]=Ext.Number.constrain(e[0],p,o);d.setXY(f);c.setXY(e);d.show();c.show()}else {a.invalidateDrop()}},invalidateDrop:function(){this.valid=!1;this.hideIndicators()},onNodeOver:function(f,h,g,d){var a=this,b=!0,e=d.header,c=a.getLocation(d,f,g);if(d.header.el.dom===f){b=!1}if(c&&c.header&&e){b=b&&e.getField().getSettings().isAllowed(c.header)&&a.panel.isAllowed(c.header,e)}if(b){a.positionIndicator(d,f,g)}else {a.valid=!1}return a.valid?a.dropAllowed:a.dropNotAllowed},hideIndicators:function(){var a=this;a.getTopIndicator().hide();a.getBottomIndicator().hide();a.lastTargetHeader=a.lastDropPos=null},onNodeOut:function(){this.hideIndicators()},onNodeDrop:function(f,e,g,b){var c=this,d=b.header,a=b.dropLocation;if(c.valid&&a){c.panel.dragDropField(a.header,d,a.pos)}}});Ext.define('Ext.pivot.plugin.configurator.window.Settings',{extend:'Ext.pivot.plugin.configurator.window.Window',requires:['Ext.form.field.Display'],title:'Settings',layoutText:'Layout',outlineLayoutText:'Outline',compactLayoutText:'Compact',tabularLayoutText:'Tabular',firstPositionText:'First',hidePositionText:'Hide',lastPositionText:'Last',rowSubTotalPositionText:'Row subtotal position',columnSubTotalPositionText:'Column subtotal position',rowTotalPositionText:'Row total position',columnTotalPositionText:'Column total position',showZeroAsBlankText:'Show zero as blank',yesText:'Yes',noText:'No',getSettingsForm:function(){var a=this,b={type:'array',fields:['text','value'],data:[[a.firstPositionText,'first'],[a.hidePositionText,'none'],[a.lastPositionText,'last']]};return Ext.apply(a.callParent(arguments),{items:[{xtype:'combo',fieldLabel:a.layoutText,editable:!1,queryMode:'local',valueField:'value',name:'viewLayoutType',store:{type:'array',fields:['text','value'],data:[[a.outlineLayoutText,'outline'],[a.compactLayoutText,'compact'],[a.tabularLayoutText,'tabular']]}},{xtype:'combo',fieldLabel:a.rowSubTotalPositionText,editable:!1,queryMode:'local',valueField:'value',name:'rowSubTotalsPosition',store:b},{xtype:'combo',fieldLabel:a.columnSubTotalPositionText,editable:!1,queryMode:'local',valueField:'value',name:'colSubTotalsPosition',store:b},{xtype:'combo',fieldLabel:a.rowTotalPositionText,editable:!1,queryMode:'local',valueField:'value',name:'rowGrandTotalsPosition',store:b},{xtype:'combo',fieldLabel:a.columnTotalPositionText,editable:!1,queryMode:'local',valueField:'value',name:'colGrandTotalsPosition',store:b},{xtype:'combo',fieldLabel:a.showZeroAsBlankText,editable:!1,queryMode:'local',valueField:'value',name:'showZeroAsBlank',store:{type:'array',fields:['text','value'],data:[[a.yesText,!0],[a.noText,!1]]}}]})}});Ext.define('Ext.pivot.plugin.configurator.Panel',{extend:'Ext.panel.Panel',requires:['Ext.pivot.plugin.configurator.Container','Ext.pivot.plugin.configurator.DragZone','Ext.pivot.plugin.configurator.DropZone','Ext.layout.container.HBox','Ext.layout.container.VBox','Ext.pivot.plugin.configurator.window.Settings'],mixins:['Ext.mixin.FocusableContainer'],alias:'widget.pivotconfigpanel',weight:50,defaultMinHeight:70,defaultMinWidth:250,dock:'right',header:!1,title:'Configurator',collapsible:!0,collapseMode:'placeholder',panelAllFieldsText:'Drop Unused Fields Here',panelAllFieldsTitle:'All fields',panelTopFieldsText:'Drop Column Fields Here',panelTopFieldsTitle:'Column labels',panelLeftFieldsText:'Drop Row Fields Here',panelLeftFieldsTitle:'Row labels',panelAggFieldsText:'Drop Agg Fields Here',panelAggFieldsTitle:'Values',addToText:'Add to {0}',moveToText:'Move to {0}',removeFieldText:'Remove field',moveUpText:'Move up',moveDownText:'Move down',moveBeginText:'Move to beginning',moveEndText:'Move to end',fieldSettingsText:'Field settings',headerContainerCls:Ext.baseCSSPrefix+'pivot-grid-config-container-header',keyEventRe:/^key/,config:{fields:[],refreshDelay:300,pivot:null},initComponent:function(){var a=this,b={configchange:a.applyChanges,scope:a};Ext.apply(a,Ext.Array.indexOf(['top','bottom'],a.dock)>=0?a.getHorizontalConfig():a.getVerticalConfig());a.callParent(arguments);a.getAllFieldsContainer().on(b);a.getLeftAxisContainer().on(b);a.getTopAxisContainer().on(b);a.getAggregateContainer().on(b);a.pivotListeners=a.getPivot().getMatrix().on({done:a.onPivotDone,scope:a,destroyable:!0});a.task=new Ext.util.DelayedTask(a.reconfigurePivot,a)},destroy:function(){var a=this,c=['relayers','pivotListeners','menu','dragZone','dropZone'],d=c.length,b;for(b=0;b<d;b++){Ext.destroy(a[c[b]]);a[c[b]]=null}a.task.cancel();a.task=a.lastFocusedField=null;a.callParent()},enable:function(){var a=this;if(a.rendered){a.dragZone.enable();a.dropZone.enable();a.initPivotFields()}a.show()},disable:function(){var a=this;if(a.rendered){a.dragZone.disable();a.dropZone.disable()}a.hide()},afterRender:function(){var a=this,b=a.getEl();a.callParent(arguments);a.mon(b,{scope:a,delegate:'.'+Ext.baseCSSPrefix+'pivot-grid-config-column',click:a.handleEvent,keypress:a.handleEvent});a.dragZone=new Ext.pivot.plugin.configurator.DragZone(a);a.dropZone=new Ext.pivot.plugin.configurator.DropZone(a);b.unselectable()},handleEvent:function(c){var a=this,h=a.keyEventRe.test(c.type),g=a.getPivot(),f,b,d,e;if((h&&c.getKey()===c.SPACE)||(c.button===0)){f=Ext.fly(c.target);if(f&&(b=f.component)){c.stopEvent();b.focus();Ext.destroy(a.menu);d=a.getMenuConfig(b);if(d){a.menu=new Ext.menu.Menu(d);e={menu:a.menu,field:b.getField(),container:b.getFieldType()};if(g.fireEvent('beforeshowconfigfieldmenu',a,e)!==!1){a.menu.showBy(b);a.menu.focus();g.fireEvent('showconfigfieldmenu',a,e)}else {Ext.destroy(a.menu)}}}}},getPanelConfigHeader:function(a){return Ext.apply({xtype:'header',baseCls:Ext.baseCSSPrefix+'panel-header',cls:this.headerContainerCls,border:1,width:100},a||{})},getHorizontalConfig:function(){var a=this,b=[{type:'gear',handler:a.showSettings,scope:a}];if(a.collapsible){b.push({type:a.dock=='top'?'up':'down',handler:a.collapseMe,scope:a})}return {minHeight:a.defaultMinHeight,headerPosition:a.dock=='top'?'bottom':'top',collapseDirection:a.dock,defaults:{xtype:'container',layout:{type:'hbox',align:'stretchmax'},minHeight:a.defaultMinHeight/3},items:[{items:[a.getPanelConfigHeader({title:a.panelAllFieldsTitle,tools:b}),{itemId:'fieldsCt',xtype:'pivotconfigcontainer',fieldType:'all',dragDropText:a.panelAllFieldsText,position:a.dock,flex:1}]},{items:[a.getPanelConfigHeader({title:a.panelAggFieldsTitle}),{itemId:'fieldsAggCt',xtype:'pivotconfigcontainer',fieldType:'aggregate',dragDropText:a.panelAggFieldsText,position:a.dock,flex:1}]},{defaults:{xtype:'pivotconfigcontainer',minHeight:a.defaultMinHeight/3,position:a.dock},items:[a.getPanelConfigHeader({title:a.panelLeftFieldsTitle}),{itemId:'fieldsLeftCt',fieldType:'leftAxis',dragDropText:a.panelLeftFieldsText,flex:1},a.getPanelConfigHeader({title:a.panelTopFieldsTitle}),{itemId:'fieldsTopCt',fieldType:'topAxis',dragDropText:a.panelTopFieldsText,flex:1}]}]}},getVerticalConfig:function(){var a=this,b=[{type:'gear',handler:a.showSettings,scope:a}];if(a.collapsible){b.push({type:a.dock,handler:a.collapseMe,scope:a})}return {layout:{type:'hbox',align:'stretch'},width:a.defaultMinWidth,minWidth:a.defaultMinWidth,headerPosition:a.dock=='right'?'left':'right',collapseDirection:a.dock,defaults:{flex:1},items:[{itemId:'fieldsCt',xtype:'pivotconfigcontainer',position:a.dock,title:a.panelAllFieldsTitle,fieldType:'all',dragDropText:a.panelAllFieldsText,autoScroll:!0,header:{cls:a.headerContainerCls},tools:b},{xtype:'container',defaults:{xtype:'pivotconfigcontainer',flex:1,autoScroll:!0,position:a.dock,header:{cls:a.headerContainerCls}},layout:{type:'vbox',align:'stretch'},items:[{itemId:'fieldsAggCt',title:a.panelAggFieldsTitle,fieldType:'aggregate',dragDropText:a.panelAggFieldsText},{itemId:'fieldsLeftCt',title:a.panelLeftFieldsTitle,fieldType:'leftAxis',dragDropText:a.panelLeftFieldsText},{itemId:'fieldsTopCt',title:a.panelTopFieldsTitle,fieldType:'topAxis',dragDropText:a.panelTopFieldsText}]}]}},getAllFieldsContainer:function(){return this.down('#fieldsCt')},getAllFieldsHeader:function(){var a=this.dock,b=this.getAllFieldsContainer();return (a==='top'||a==='bottom')?b.prev():b.getHeader()},setAllFieldsContainerVisible:function(a){this.getAllFieldsContainer().setVisible(a);this.getAllFieldsHeader().setVisible(a)},getLeftAxisContainer:function(){return this.down('#fieldsLeftCt')},getLeftAxisHeader:function(){var a=this.dock,b=this.getLeftAxisContainer();return (a==='top'||a==='bottom')?b.prev():b.getHeader()},setLeftAxisContainerVisible:function(a){this.getLeftAxisContainer().setVisible(a);this.getLeftAxisHeader().setVisible(a)},getTopAxisContainer:function(){return this.down('#fieldsTopCt')},getTopAxisHeader:function(){var a=this.dock,b=this.getTopAxisContainer();return (a==='top'||a==='bottom')?b.prev():b.getHeader()},setTopAxisContainerVisible:function(a){this.getTopAxisContainer().setVisible(a);this.getTopAxisHeader().setVisible(a)},getAggregateContainer:function(){return this.down('#fieldsAggCt')},getAggregateHeader:function(){var a=this.dock,b=this.getAggregateContainer();return (a==='top'||a==='bottom')?b.prev():b.getHeader()},setAggregateContainerVisible:function(a){this.getAggregateContainer().setVisible(a);this.getAggregateHeader().setVisible(a)},applyChanges:function(b){var a=this;if(a.disabled){return}if(b){a.lastFocusedField=b}a.task.delay(a.getRefreshDelay())},collapseMe:function(){this.collapse(this.dock)},showSettings:function(){var c=this.getPivot(),b=new Ext.pivot.plugin.configurator.window.Settings({listeners:{applysettings:Ext.bind(this.applyPivotSettings,this)}}),a=c.getMatrix().serialize();delete (a.leftAxis);delete (a.topAxis);delete (a.aggregate);if(c.fireEvent('beforeshowpivotsettings',this,{container:b,settings:a})!==!1){b.loadSettings(a);b.show();c.fireEvent('showpivotsettings',this,{container:b,settings:a})}else {Ext.destroy(b)}},applyPivotSettings:function(c,a){var b=this.getPivot();if(b.fireEvent('beforeapplypivotsettings',this,{container:c,settings:a})!==!1){b.fireEvent('applypivotsettings',this,{container:c,settings:a});b.getMatrix().reconfigure(a)}else {return !1}},getFieldsFromContainer:function(d,e){var c=[],f=d.items.getCount(),a,b;for(a=0;a<f;a++){b=d.items.getAt(a);c.push(e===!0?b.getField().getConfiguration():b.getField())}return c},initPivotFields:function(){var a=this,b=a.getPivot().getMatrix(),e=a.getAllFieldsContainer(),c=a.getLeftAxisContainer(),f=a.getTopAxisContainer(),d=a.getAggregateContainer(),i,g,h,j;j=a.getFields().clone();Ext.suspendLayouts();e.removeAll();f.removeAll();c.removeAll();d.removeAll();i=a.getConfigFields(b.topAxis.dimensions.getRange());g=a.getConfigFields(b.leftAxis.dimensions.getRange());h=a.getConfigFields(b.aggregate.getRange());a.addFieldsToConfigurator(j.getRange(),e);a.addFieldsToConfigurator(i,f);a.addFieldsToConfigurator(g,c);a.addFieldsToConfigurator(h,d);Ext.resumeLayouts(!0)},addFieldsToConfigurator:function(b,c){var d=b.length,a;for(a=0;a<d;a++){c.addField(b[a],-1)}},getConfigFields:function(d){var g=d.length,f=this.getFields(),e=[],b,a,c;for(b=0;b<g;b++){c=d[b];a=f.byDataIndex.get(c.dataIndex);if(a){a=a.clone();a.setConfig(c.getInitialConfig());e.push(a)}}return e},getMenuConfig:function(b){var a=this,i=b.getFieldType(),j=[],k=b.getMenuConfig()||{},d=b.up('pivotconfigcontainer'),e=d.items.getCount(),l=d.items.indexOf(b),m=b.getField(),c=m.getSettings(),f=a.getLeftAxisContainer(),h=a.getTopAxisContainer(),g=a.getAggregateContainer(),n=a.getLeftAxisHeader().getTitle().getText(),p=a.getTopAxisHeader().getTitle().getText(),o=a.getAggregateHeader().getTitle().getText();k.items=k.items||[];if(i=='all'){j.push({text:Ext.String.format(a.addToText,n),disabled:!c.isAllowed(f),handler:Ext.bind(a.dragDropField,a,[f,b,'after']),hidden:f.isHidden()},{text:Ext.String.format(a.addToText,p),disabled:!c.isAllowed(h),handler:Ext.bind(a.dragDropField,a,[h,b,'after']),hidden:h.isHidden()},{text:Ext.String.format(a.addToText,o),disabled:!c.isAllowed(g),handler:Ext.bind(a.dragDropField,a,[g,b,'after']),hidden:g.isHidden()})}else {j.push({text:a.moveUpText,disabled:(e==1||l==0),handler:Ext.bind(a.dragDropField,a,[b.previousSibling(),b,'before'])},{text:a.moveDownText,disabled:(e==1||l==e-1),handler:Ext.bind(a.dragDropField,a,[b.nextSibling(),b,'after'])},{text:a.moveBeginText,disabled:(e==1||l==0),handler:Ext.bind(a.dragDropField,a,[d.items.first(),b,'before'])},{text:a.moveEndText,disabled:(e==1||l==e-1),handler:Ext.bind(a.dragDropField,a,[d.items.last(),b,'after'])},{xtype:'menuseparator'},{text:Ext.String.format(a.moveToText,a.panelLeftFieldsTitle),disabled:(i=='leftAxis'||!c.isAllowed(f)||c.isFixed(d)),handler:Ext.bind(a.dragDropField,a,[f,b,'after'])},{text:Ext.String.format(a.moveToText,a.panelTopFieldsTitle),disabled:(i=='topAxis'||!c.isAllowed(h)||c.isFixed(d)),handler:Ext.bind(a.dragDropField,a,[h,b,'after'])},{text:Ext.String.format(a.moveToText,a.panelAggFieldsTitle),disabled:(i=='aggregate'||!c.isAllowed(g)||c.isFixed(d)),handler:Ext.bind(a.dragDropField,a,[g,b,'after'])},{xtype:'menuseparator'},{text:a.removeFieldText,disabled:c.isFixed(d),handler:Ext.bind(a.dragDropField,a,[a.getAllFieldsContainer(),b,'after'])})}if(i=='aggregate'){j.push({xtype:'menuseparator'},{text:a.fieldSettingsText,handler:Ext.bind(a.openFieldSettings,a,[b])})}if(k.items.length){j.push({xtype:'menuseparator'})}Ext.Array.insert(k.items,0,j);return Ext.apply({ownerCmp:a,floating:!0},k)},openFieldSettings:function(c){var d=this.getPivot(),a=new Ext.pivot.plugin.configurator.window.FieldSettings({field:c.getField(),listeners:{applysettings:Ext.bind(this.applyFieldSettings,this,[c],0)}}),b=c.getField().getConfig();if(d.fireEvent('beforeshowconfigfieldsettings',this,{container:a,settings:b})!==!1){a.loadSettings(b);a.show();d.fireEvent('showconfigfieldsettings',this,{container:a,settings:b})}else {Ext.destroy(a)}},applyFieldSettings:function(a,e,c){var d=this.getPivot(),b=a.getField();if(d.fireEvent('beforeapplyconfigfieldsettings',this,{container:e,settings:c})!==!1){b.setConfig(c||{});if(a.rendered){a.textCol.setHtml(b.getFieldText());a.textCol.dom.setAttribute('data-qtip',b.getFieldText())}d.fireEvent('applyconfigfieldsettings',this,{container:e,settings:c});this.applyChanges(a)}else {return !1}},dragDropField:function(f,g,m){var d=this,p=d.getPivot(),h=g.getField(),e=g.ownerCt,a=f.isConfiguratorContainer?f:f.ownerCt,j=f.isConfiguratorField?f:f.items.last(),l=e.getFieldType(),k=a.getFieldType(),o=d.getTopAxisContainer(),n=d.getLeftAxisContainer(),b,c,i;if(p.fireEvent('beforemoveconfigfield',this,{fromContainer:e,toContainer:a,field:h})!==!1){if(e!==a){if(j){b=a.items.findIndex('id',j.id);b=(m==='before')?b:b+1}else {b=-1}if(k==='all'){j.focus();e.removeField(g)}else if(k==='aggregate'){i=a.addField(h.clone(),b,!0);if(l!=='all'){e.remove(g)}}else {c=d.findFieldInContainer(h,a);if(c){return}if(k==='leftAxis'){c=d.findFieldInContainer(h,o)}else {c=d.findFieldInContainer(h,n)}if(c){a.add(c);return d.applyChanges(c)}else {if(l==='aggregate'){e.remove(g)}i=a.addField(h.clone(),b,!0)}}}else {a.moveField(g.id,j.id,m)}if(i){i.focus();i.el.resumeFocusEvents()}}},isAllowed:function(a,e){var d=!0,h=e.getField(),f=e.ownerCt,b=a.isConfiguratorContainer?a:a.ownerCt,g=f.getFieldType(),c=b.getFieldType();if(g==='aggregate'&&(c==='leftAxis'||c==='topAxis')){d=!this.findFieldInContainer(h,b)}return d},findFieldInContainer:function(e,c){var d=c.items.getCount(),a,b;for(a=0;a<d;a++){b=c.items.getAt(a);if(b.getField().getDataIndex()==e.getDataIndex()){return b}}},onPivotDone:function(){var b=this,a=b.lastFocusedField;if(b.internalReconfiguration){b.internalReconfiguration=!1;if(a&&a.isConfiguratorContainer){a=a.items.first()}if(!a){a=b.getAllFieldsContainer().items.first()}if(a){a.focus()}else {b.getPivot().focus()}}else {b.initPivotFields()}},reconfigurePivot:function(){var a=this,b=a.getPivot(),c={topAxis:a.getFieldsFromContainer(a.getTopAxisContainer(),!0),leftAxis:a.getFieldsFromContainer(a.getLeftAxisContainer(),!0),aggregate:a.getFieldsFromContainer(a.getAggregateContainer(),!0)};a.internalReconfiguration=!0;if(b.fireEvent('beforeconfigchange',a,c)!==!1){b.getMatrix().reconfigure(c);b.fireEvent('configchange',a,c)}},placeholderCollapse:function(h,g){var a=this,c=a.ownerCt,e=h||a.collapseDirection,f=Ext.panel.Panel.floatCls,b=a.getPlaceholder(e),d;a.isCollapsingOrExpanding=1;a.setHiddenState(!0);a.collapsed=e;if(b.rendered){if(b.el.dom.parentNode!==a.el.dom.parentNode){a.el.dom.parentNode.insertBefore(b.el.dom,a.el.dom)}b.hidden=!1;b.setHiddenState(!1);b.el.show();c.updateLayout()}else {if(a.dock){b.dock=a.dock;c.addDocked(b)}else {c.insert(c.items.indexOf(a),b)}}if(a.rendered){if(Ext.ComponentManager.getActiveComponent()===a.collapseTool){a.focusPlaceholderExpandTool=!0}a.el.setVisibilityMode(a.placeholderCollapseHideMode);if(g){a.el.addCls(f);b.el.hide();d=a.convertCollapseDir(e);a.el.slideOut(d,{preserveScroll:!0,duration:Ext.Number.from(g,Ext.fx.Anim.prototype.duration),listeners:{scope:a,afteranimate:function(){var a=this;a.el.removeCls(f);a.placeholder.el.show().setStyle('display','none').slideIn(d,{easing:'linear',duration:100,listeners:{afteranimate:a.doPlaceholderCollapse,scope:a}})}}})}else {a.el.hide();a.doPlaceholderCollapse()}}else {a.isCollapsingOrExpanding=0;if(!a.preventCollapseFire){a.fireEvent('collapse',a)}}return a},placeholderExpand:function(d){var a=this,h=a.collapsed,b=a.placeholder.expandTool,g=Ext.panel.Panel.floatCls,e=a.ownerLayout?a.ownerLayout.centerRegion:null,f,c;if(Ext.Component.layoutSuspendCount){d=!1}if(a.floatedFromCollapse){c=a.getPosition(!0);a.slideOutFloatedPanelBegin();a.slideOutFloatedPanelEnd();a.floated=!1}if(Ext.ComponentManager.getActiveComponent()===b){a.focusHeaderCollapseTool=!0;b._ariaRole=b.ariaEl.dom.getAttribute('role');b._ariaLabel=b.ariaEl.dom.getAttribute('aria-label');b.ariaEl.dom.setAttribute('role','presentation');b.ariaEl.dom.removeAttribute('aria-label')}if(d){Ext.suspendLayouts();a.placeholder.hide();a.el.show();a.collapsed=!1;a.setHiddenState(!1);if(e&&!c){e.hidden=!0}Ext.resumeLayouts(!0);if(e){e.hidden=!1}a.el.addCls(g);a.isCollapsingOrExpanding=2;if(c){f=a.getXY();a.setLocalXY(c[0],c[1]);a.setXY([f[0],f[1]],{duration:Ext.Number.from(d,Ext.fx.Anim.prototype.duration),listeners:{scope:a,afteranimate:function(){var a=this;a.el.removeCls(g);a.isCollapsingOrExpanding=0;a.fireEvent('expand',a)}}})}else {a.el.hide();a.placeholder.el.show();a.placeholder.hidden=!1;a.setHiddenState(!1);a.el.slideIn(a.convertCollapseDir(h),{preserveScroll:!0,duration:Ext.Number.from(d,Ext.fx.Anim.prototype.duration),listeners:{afteranimate:a.doPlaceholderExpand,scope:a}})}}else {a.floated=a.collapsed=!1;a.doPlaceholderExpand(!0)}return a}});Ext.define('Ext.pivot.plugin.Configurator',{alternateClassName:['Mz.pivot.plugin.Configurator'],extend:'Ext.plugin.Abstract',requires:['Ext.util.DelayedTask','Ext.menu.Menu','Ext.menu.CheckItem','Ext.util.Collection','Ext.pivot.plugin.configurator.Panel'],alias:['plugin.pivotconfigurator','plugin.mzconfigurator'],lockableScope:'top',config:{fields:[],refreshDelay:300,dock:'right',collapsible:!0,configPanel:null},init:function(b){var a=this;b.showConfigurator=Ext.bind(a.showConfigurator,a);b.hideConfigurator=Ext.bind(a.hideConfigurator,a);b.on({afterrender:a.onAfterPivotRendered,single:!0,scope:a});a.callParent([b])},destroy:function(){var a=this,b=a.getCmp();b.showConfigurator=b.hideConfigurator=null;a.setConfigPanel(Ext.destroy(a.getConfigPanel()));a.setFields(null);a.callParent()},enable:function(){this.disabled=!1;this.showConfigurator()},disable:function(){this.disabled=!0;this.hideConfigurator()},showConfigurator:function(){this.renderConfigPanel()},hideConfigurator:function(){var a=this.getConfigPanel();if(a){a.disable();this.getCmp().fireEvent('hideconfigpanel',a)}},onAfterPivotRendered:function(){var g=this,d=g.getFields(),h=g.getCmp().getMatrix(),k=[],i={},n=!1,m,c,f,j,e,b,a,l;if(d.length===0&&h instanceof Ext.pivot.matrix.Local){n=!0;m=h.store;c=m?m.model.getFields():[];e=c.length;for(b=0;b<e;b++){j=c[b].getName();if(!d.byDataIndex.get(j)){d.add({header:Ext.String.capitalize(j),dataIndex:j})}}}c=Ext.Array.merge(h.leftAxis.dimensions.getRange(),h.topAxis.dimensions.getRange(),h.aggregate.getRange());e=c.length;for(b=0;b<e;b++){a=c[b].getConfig();delete (a.matrix);delete (a.values);delete (a.id);f=d.byDataIndex.get(a.dataIndex);if(!f){d.add(a)}else if(n){if(!i[a.dataIndex]){i[a.dataIndex]=0}delete (a.header);i[a.dataIndex]++;k.push(a)}}e=k.length;for(b=0;b<e;b++){a=k[b];if(i[a.dataIndex]===1){f=d.byDataIndex.get(a.dataIndex);if(f){l=f.getConfig();Ext.merge(l,a);f.setConfig(l)}}}g.isReady=!0;if(g.disabled===!0){g.disable()}else {g.enable()}},updateDock:function(a){this.renderConfigPanel(a)},updateCollapsible:function(a){this.renderConfigPanel(a)},getFields:function(){var a=this.fields;if(!a){a=new Ext.util.Collection({extraKeys:{byDataIndex:'dataIndex'},decoder:function(a){return (a&&a.isField)?a:new Ext.pivot.plugin.configurator.Field(a||{})}});this.setFields(a)}return a},applyFields:function(a,b){if(a==null||(a&&a.isCollection)){return a}if(a){if(!b){b=this.getFields()}b.splice(0,b.length,a)}return b},renderConfigPanel:function(d){var a=this,c=a.getCmp(),b=a.getConfigPanel(),e=!Ext.isEmpty(b);if(!c||!a.isReady||a.disabled){return}Ext.destroy(b);b=c.addDocked({xtype:'pivotconfigpanel',dock:d||a.getDock(),refreshDelay:a.getRefreshDelay(),pivot:a.getCmp(),fields:a.getFields(),listeners:{afterrender:'onRenderConfigPanel',single:!0,scope:a}})[0];a.setConfigPanel(b);if(e){b.enable()}},onRenderConfigPanel:function(a){this.getCmp().fireEvent('showconfigpanel',a)}});Ext.define('Ext.pivot.plugin.DrillDown',{alternateClassName:['Mz.pivot.plugin.DrillDown'],alias:['plugin.pivotdrilldown','plugin.mzdrilldown'],extend:'Ext.plugin.Abstract',requires:['Ext.pivot.Grid','Ext.window.Window','Ext.data.proxy.Memory','Ext.data.Store','Ext.toolbar.Paging'],lockableScope:'top',config:{columns:null,width:400,height:300,remoteStore:null,grid:null,view:null},textWindow:'Drill down window',init:function(a){this.setGrid(a);return this.callParent([a])},destroy:function(){this.setConfig({grid:null,view:null});this.callParent()},updateGrid:function(a){Ext.destroy(this.gridListeners);if(a){this.gridListeners=a.on({pivotitemcelldblclick:'showPanel',pivotgroupcelldblclick:'showPanel',pivottotalcelldblclick:'showPanel',scope:this,destroyable:!0})}},updateView:function(b,a){Ext.destroy(a)},showPanel:function(k,o,n){var b=this,l=b.getGrid(),i=l.getMatrix(),g=Ext.Array.from(b.getColumns()||[]),c,d,a,h,e,f,m,j;if(b.disabled){return}c=i.results.get(k.leftKey,k.topKey);if(!c){return}switch(i.type){case 'local':d=i.store.model.getFields();a=new Ext.data.Store({pageSize:25,remoteSort:!0,fields:Ext.clone(d),proxy:{type:'memory',reader:{type:'array'},enablePaging:!0}});if(g.length===0){m=d.length;for(f=0;f<m;f++){j=d[f];g.push({text:Ext.String.capitalize(j.name),dataIndex:j.name})}};a.getProxy().data=c.records;a.load();break;case 'remote':a=Ext.getStore(b.getRemoteStore());if(a){a.setRemoteFilter(!0)};h=Ext.Array.merge(b.getFiltersFromParams(c.getLeftAxisItem()?c.getLeftAxisItem().data:{}),b.getFiltersFromParams(c.getTopAxisItem()?c.getTopAxisItem().data:{}));a.clearFilter(!0);if(h.length>0){a.addFilter(h)}else {a.load()};break;default:return;}e=b.createPanel(a,g);e.show();b.setView(e);l.fireEvent('showdrilldownpanel',e)},createPanel:function(b,c){var a=this;return new Ext.window.Window({title:a.textWindow,width:a.getWidth(),height:a.getHeight(),layout:'fit',modal:!0,closeAction:'hide',items:[{xtype:'grid',border:!1,viewConfig:{loadMask:!1},columns:c,store:b,dockedItems:[{xtype:'pagingtoolbar',store:b,dock:'bottom',displayInfo:!0}]}],listeners:{close:'onClosePanel',scope:a}})},onClosePanel:function(){var a=this.getView();this.getGrid().fireEvent('hidedrilldownpanel',a);this.setView(null)},getFiltersFromParams:function(c){var d=[],a,e,b;if(Ext.isObject(c)){b=Ext.Object.getKeys(c);e=b.length;for(a=0;a<e;a++){d.push({property:b[a],exactMatch:!0,value:c[b[a]]})}}return d}});Ext.define('Ext.pivot.plugin.RangeEditor',{alternateClassName:['Mz.pivot.plugin.RangeEditor'],alias:['plugin.pivotrangeeditor','plugin.mzrangeeditor'],extend:'Ext.plugin.Abstract',requires:['Ext.pivot.Grid','Ext.pivot.update.Increment','Ext.pivot.update.Overwrite','Ext.pivot.update.Percentage','Ext.pivot.update.Uniform','Ext.window.Window','Ext.form.field.Hidden','Ext.form.field.Text','Ext.form.field.Number','Ext.form.field.ComboBox','Ext.form.field.Display','Ext.form.Panel','Ext.button.Button','Ext.layout.container.Fit','Ext.data.ArrayStore'],width:null,height:null,textWindowTitle:'Range editor',textFieldValue:'Value',textFieldEdit:'Field',textFieldType:'Type',textButtonOk:'Ok',textButtonCancel:'Cancel',onBeforeRecordsUpdate:Ext.emptyFn,onAfterRecordsUpdate:Ext.emptyFn,scope:null,updaters:[['percentage','Percentage'],['increment','Increment'],['overwrite','Overwrite'],['uniform','Uniform']],defaultUpdater:'uniform',lockableScope:'top',config:{grid:null,view:null},init:function(a){this.setGrid(a);return this.callParent([a])},destroy:function(){this.setConfig({grid:null,view:null});this.cleanUp();this.callParent()},updateGrid:function(a){Ext.destroy(this.gridListeners);if(a){this.gridListeners=a.on({pivotitemcelldblclick:'showPanel',pivotgroupcelldblclick:'showPanel',pivottotalcelldblclick:'showPanel',scope:this,destroyable:!0})}},updateView:function(b,a){Ext.destroy(a)},showPanel:function(c,j,i){var a=this,g=a.getGrid(),h=g.getMatrix(),f,d,b,e;if(a.disabled){return}d=h.results.get(c.leftKey,c.topKey);if(!d){return}e=a.createPanel();a.currentCol=b=c.column;a.currentRecords=d.records||[];f=b.dimension.getId();a.currentValue=d.getValue(f);e.down('form').getForm().setValues({leftKey:c.leftKey,topKey:c.topKey,dataIndex:b.dimension.dataIndex,field:b.dimension.header||b.text||b.dimension.dataIndex,value:d.getValue(f),type:a.defaultUpdater});e.show();a.setView(e);g.fireEvent('showrangeeditorpanel',e)},createPanel:function(){var a=this;return new Ext.window.Window({title:a.textWindowTitle,width:a.width,height:a.height,layout:'fit',modal:!0,closeAction:'hide',items:[{xtype:'form',padding:5,border:!1,defaults:{anchor:'100%'},items:[{fieldLabel:a.textFieldEdit,xtype:'displayfield',name:'field'},{fieldLabel:a.textFieldType,xtype:'combo',name:'type',queryMode:'local',valueField:'id',displayField:'text',editable:!1,store:a.updaters},{fieldLabel:a.textFieldValue,xtype:'numberfield',name:'value'},{xtype:'hidden',name:'leftKey'},{xtype:'hidden',name:'topKey'},{xtype:'hidden',name:'dataIndex'}]}],buttons:[{text:a.textButtonOk,handler:a.updateRecords,scope:a},{text:a.textButtonCancel,handler:a.closePanel,scope:a}],listeners:{close:'onClosePanel',scope:a}})},closePanel:function(){this.getView().close()},onClosePanel:function(){var a=this.getView();this.getGrid().fireEvent('hiderangeeditorpanel',a);this.setView(null)},updateRecords:function(){var a=this,e=a.getView(),c=e.down('form').getValues(),d=Ext.bind(a.cleanUp,a),b;c.matrix=a.getGrid().getMatrix();b=Ext.Factory.pivotupdate(c);b.on({beforeupdate:a.onBeforeUpdate,update:a.onUpdate,scope:a});b.update().then(d,d)},cleanUp:function(){this.currentCol=this.currentRecords=this.currentValue=null},onBeforeUpdate:function(c){var a=this,b=a.getGrid();if(Ext.callback(a.onBeforeRecordsUpdate,a.scope||'self.controller',[b,a.currentCol,a.currentRecords,c.getValue(),a.currentValue],0,b)===!1){return !1}if(b.fireEvent('pivotbeforeupdate',c)===!1){return !1}a.getView().getEl().mask()},onUpdate:function(b){var a=this,c=a.getGrid(),d=a.getView();Ext.callback(a.onAfterRecordsUpdate,a.scope||'self.controller',[c,a.currentCol,a.currentRecords,b.getValue(),a.currentValue],0,c);c.fireEvent('pivotupdate',b);Ext.destroy(b);d.getEl().unmask();d.close()}});