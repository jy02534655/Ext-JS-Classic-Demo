Ext.define('Ext.exporter.excel.PivotXlsx',{extend:'Ext.exporter.Base',alias:['exporter.pivotxlsx'],requires:['Ext.exporter.file.ooxml.Excel'],config:{titleStyle:{alignment:{horizontal:'Center',vertical:'Center'},font:{fontName:'Arial',family:'Swiss',size:18,color:'#1F497D'}},matrix:null,pivotTableStyle:{name:'PivotStyleMedium7'}},fileName:'export.xlsx',charset:'ascii',mimeType:'application/zip',binary:!0,aggregateMap:{avg:'average',sum:'sum',count:'count',countNumbers:'countNums',min:'min',max:'max',variance:'var',varianceP:'varp',stdDev:'stdDev',stdDevP:'stdDevp'},titleRowHeight:22.5,columnLabelsText:'Column Labels',rowLabelsText:'Row Labels',valuesText:'Values',totalText:'Total',grandTotalText:'Grand total',getContent:function(){var c=this,e=c.getMatrix(),a,f,g,b,d;a=new Ext.exporter.file.ooxml.Excel({properties:{title:c.getTitle(),author:c.getAuthor()}});b=e&&e.store;if(!e||!b||!b.isStore||b.isDestroyed){a.addWorksheet({rows:[{cells:'Unable to export the pivot table since no raw data is available'}]});return a.render()}f=a.addWorksheet();g=a.addWorksheet();d=c.generateDataSheet({store:b,worksheet:g});c.generatePivotSheet({worksheet:f,data:d});d=a.render();a.destroy();return d},generateDataSheet:function(c){var d=c.store,b=c.worksheet,a;a=this.buildStoreRows(d);a.worksheet=b;b.beginRowRendering();b.renderRows([a.fields]);b.renderRows(a.rows);b.endRowRendering();return a},generatePivotSheet:function(d){var a=this,c=a._matrix,e=d.worksheet,b=d.data;e.beginRowRendering();a.generatePivotSheetTitle(e);a.setupUniqueAggregateNames(b.fields);a.setupUniqueValues(c.aggregate,b.uniqueValues);a.setupUniqueValues(c.leftAxis.dimensions,b.uniqueValues);a.setupUniqueValues(c.topAxis.dimensions,b.uniqueValues);a.generatePivotSheetData(d);e.endRowRendering()},generatePivotSheetTitle:function(a){a.renderRow({height:this.titleRowHeight,cells:[{mergeAcross:5,value:this.getTitle(),styleId:a.getWorkbook().addCellStyle(this.getTitleStyle())}]})},generatePivotSheetData:function(a){var b=this,c=a.worksheet;b.generatePivotConfig(a);b.generatePivotLocation(a);b.generatePivotDataFields(a);b.generatePivotFields(a);b.generatePivotRowFields(a);b.generatePivotColumnFields(a);c.addPivotTable(a.pivotConfig)},generatePivotConfig:function(d){var c=this._matrix,e=d.data,b=e.worksheet,f=c.leftAxis.dimensions.items.length,a;a=d.pivotConfig={grandTotalCaption:c.textGrandTotalTpl,location:{ref:'',firstHeaderRow:1,firstDataRow:1,firstDataCol:1},cacheDefinition:{cacheSource:{worksheetSource:{ref:b.getTopLeftRef()+':'+b.getBottomRightRef(),sheet:b.getName()}},cacheFields:[],cacheRecords:{items:e.cache}},pivotTableStyleInfo:this.getPivotTableStyle(),pivotFields:[],rowFields:[],colFields:[],dataFields:[],rowItems:[],colItems:[]};a.rowHeaderCaption=this.rowLabelsText;a.colHeaderCaption=this.columnLabelsText;a.viewLayoutType=c.viewLayoutType},generatePivotLocation:function(a){var b=this,g=b._matrix,o=a.worksheet,f=a.pivotConfig.location,h=a.data.uniqueValues,e=g.aggregate.items.length,c=g.leftAxis.dimensions.items.length,d=g.topAxis.dimensions.items.length,j,p,q,l,i,n,k,m;a.header=[];a.body=[];a.totals=[];a.dataIndexes=[];a.columns=[];if(c===0&&d===0){if(e===0){b.generatePivotDataEmpty(a)}else {b.generatePivotDataAgg(a)}}else {f.firstDataRow+=d+(e>1?1:0);f.firstDataCol=1;f.firstHeaderRow=1;b.generatePivotHeader(a);if(e===0){if(d&&c){b.generatePivotDataLeftTopAgg(a)}else if(c){b.generatePivotDataLeft(a)}else {b.generatePivotDataTop(a)}}else {if(d&&c){b.generatePivotDataLeftTopAgg(a)}else if(c){b.generatePivotDataLeftAgg(a)}else {b.generatePivotDataTopAgg(a)}}b.generatePivotBody(a);b.generatePivotRowTotals(a)}b.generatePivotData(a)},generatePivotDataEmpty:function(b){var a;b.header.push({cells:[null,null,null]});for(a=0;a<17;a++){b.header.push({cells:[null,null,null]})}},generatePivotDataAgg:function(h){var a=this._matrix,i=h.pivotConfig.location,g=a.aggregate.items.length,j,k,b,f,e,c,d;f={cells:[{value:null}]};e={cells:[{value:this.totalText}]};h.header.push(f,e);for(b=0;b<g;b++){d=a.aggregate.items[b];f.cells.push({value:d.excelName});c=a.results.items.map[a.grandTotalKey+'/'+a.grandTotalKey];e.cells.push({value:c?c.values[d.id]:null})}if(g>1){i.firstHeaderRow=0}},generatePivotDataLeftTopAgg:function(e){var b=this._matrix,m=e.pivotConfig,o=m.location,h=m.viewLayoutType,g=b.aggregate.items.length,f=b.leftAxis.dimensions.items.length,n=b.topAxis.dimensions.items.length,l=e.dataIndexes,d=e.header,k=d[0],j=d.length,a,c,i;for(a=0;a<j;a++){if(h==='compact'){Ext.Array.insert(d[a].cells,0,[{value:a===j-1?this.rowLabelsText:(a===0&&g===1?b.aggregate.items[0].excelName:null)}])}else {for(c=0;c<f;c++){if(a===0&&c===0&&g===1){i={value:b.aggregate.items[0].excelName}}else {i={value:a===j-1?b.leftAxis.dimensions.items[c].dataIndex:null}}Ext.Array.insert(d[a].cells,c,[i])}}}if(h==='compact'){k.cells.push({value:this.columnLabelsText});Ext.Array.insert(l,0,[{aggregate:!1,dataIndex:b.compactViewKey}])}else {for(a=0;a<f;a++){Ext.Array.insert(l,a,[{aggregate:!1,dataIndex:b.leftAxis.dimensions.items[a].id}])}for(a=0;a<n;a++){k.cells.push({value:b.topAxis.dimensions.items[a].dataIndex})}if(g>1){k.cells.push({value:this.valuesText})}}this.generatePivotColTotals(e,d[1]);o.firstDataCol=(h==='compact'?1:f)},generatePivotDataLeftTop:function(e){var b=this._matrix,j=e.pivotConfig,m=j.location,g=j.viewLayoutType,f=b.leftAxis.dimensions.items.length,l=b.topAxis.dimensions.items.length,i=e.dataIndexes,c=e.header,k=c[0],h=c.length,a,d;for(a=0;a<h;a++){if(g==='compact'){Ext.Array.insert(c[a].cells,0,[{value:a===h-1?this.rowLabelsText:null}])}else {for(d=0;d<f;d++){Ext.Array.insert(c[a].cells,d,[{value:a===h-1?b.leftAxis.dimensions.items[d].dataIndex:null}])}}}if(g==='compact'){k.cells.push({value:this.columnLabelsText});Ext.Array.insert(i,0,[{aggregate:!1,dataIndex:b.compactViewKey}])}else {for(a=0;a<f;a++){Ext.Array.insert(i,a,[{aggregate:!1,dataIndex:b.leftAxis.dimensions.items[a].id}])}for(a=0;a<l;a++){k.cells.push({value:b.topAxis.dimensions.items[a].dataIndex})}}this.generatePivotColTotals(e,c[1]);m.firstDataCol=(g==='compact'?1:f)},generatePivotDataLeftAgg:function(b){var a=this._matrix,h=b.pivotConfig,d=h.location,j=h.viewLayoutType,k=a.aggregate.items.length,i=a.leftAxis.dimensions.items.length,g=b.dataIndexes,f=b.header[0],c,e;if(j==='compact'){f.cells.push({value:this.rowLabelsText});g.push({aggregate:!1,dataIndex:a.compactViewKey})}else {for(c=0;c<i;c++){e=a.leftAxis.dimensions.items[c];f.cells.push({value:e.dataIndex});g.push({aggregate:!1,dataIndex:e.id})}}this.generatePivotColTotals(b,f);d.firstHeaderRow=k>1?0:1;d.firstDataRow=1;d.firstDataCol=(j==='compact'?1:i)},generatePivotDataLeft:function(d){var c=this._matrix,f=d.pivotConfig,j=f.location,h=f.viewLayoutType,g=c.leftAxis.dimensions.items.length,i=d.header[0],b=d.dataIndexes,a,e;if(h==='compact'){i.cells.push({value:this.rowLabelsText});b.push({aggregate:!1,dataIndex:c.compactViewKey})}else {for(a=0;a<g;a++){e=c.leftAxis.dimensions.items[a];i.cells.push({value:e.dataIndex});b.push({aggregate:!1,dataIndex:e.id})}}b.push({aggregate:!1});j.firstDataCol=(h==='compact'?1:g)},generatePivotDataTopAgg:function(c){var b=this._matrix,i=c.pivotConfig,g=i.viewLayoutType,f=b.aggregate.items.length,j=b.topAxis.dimensions.items.length,h=c.dataIndexes,d=c.header,e=d[0],k=d.length,a;for(a=0;a<k;a++){Ext.Array.insert(d[a].cells,0,[{value:f===1&&a===0?b.aggregate.items[0].excelName:null}])}Ext.Array.insert(h,0,[{aggregate:!1,dataIndex:g==='compact'?b.compactViewKey:''}]);if(g==='compact'){e.cells.push({value:this.columnLabelsText})}else {for(a=0;a<j;a++){e.cells.push({value:b.topAxis.dimensions.items[a].dataIndex})}if(f>1){e.cells.push({value:this.valuesText})}}this.generatePivotColTotals(c,d[1])},generatePivotDataTop:function(b){var d=this._matrix,e=b.pivotConfig,g=e.location,h=e.viewLayoutType,f=d.topAxis.dimensions.items.length,j=b.dataIndexes,c=b.header,i=c[0],k=c.length,a;Ext.Array.insert(j,0,[{aggregate:!1,dataIndex:h==='compact'?d.compactViewKey:''}]);for(a=0;a<k;a++){Ext.Array.insert(c[a].cells,0,[{value:null}])}if(h==='compact'){i.cells.push({value:this.columnLabelsText})}else {for(a=0;a<f;a++){i.cells.push({value:d.topAxis.dimensions.items[a].dataIndex})}}this.generatePivotColTotals(b,c[1]);g.firstDataCol=1;g.firstDataRow=f+1},generatePivotHeader:function(a){var j=this,c=a.columns,g,d,e,b,i,f,h;j.generateTopAxisColumns(a,-1);g=a.header;g.push({cells:[]});b=c.length;for(d=0;d<b;d++){h={cells:[]};f=c[d];i=f.length;for(e=0;e<i;e++){h.cells.push({value:f[e].value})}g.push(h)}if(b){a.pivotConfig.colItems=Ext.Array.pluck(c[b-1],'colItem');a.dataIndexes=c[b-1]}},generatePivotBody:function(e,a){var d=this._matrix,b,c;if(!a){a=d.leftAxis.getTree()}c=a.length;for(b=0;b<c;b++){this.generatePivotBodyItem(e,a[b])}},generatePivotBodyItem:function(a,b){var l=this._matrix,q=a.worksheet,m=a.data.uniqueValues,i=a.dataIndexes,o=i.length,k=a.pivotConfig.viewLayoutType,p=a.body,n=a.pivotConfig.rowItems,f,d,c,g,j,h,e;j={r:b.level,x:[Ext.Array.indexOf(m[b.dimension.dataIndex],b.value)]};h={cells:[]};for(f=0;f<o;f++){d=i[f];c={value:null};if(d.aggregate){g=l.results.items.map[b.key+'/'+d.key];c.value=g?g.values[d.dataIndex]:null}else if(d.dataIndex===b.dimensionId){c.value=b.value}else if(k==='compact'&&d.dataIndex===l.compactViewKey){a.styles=a.styles||{};e='level'+b.level;a.styles[e]=a.styles[e]||q.getWorkbook().addCellStyle({alignment:{horizontal:'left',indent:b.level*2}});c.styleId=a.styles[e];c.value=b.value}h.cells.push(c)}n.push(j);p.push(h);if(b.children){if(k==='tabular'){this.generatePivotBodyTabularItem(a,b,b)}else {this.generatePivotBody(a,b.children)}}},generatePivotBodyTabularItem:function(f,e){var o=this._matrix,m=f.data.uniqueValues,p=e.children,r=p.length,k=f.dataIndexes,n=k.length,l=f.body,i=l[l.length-1].cells,j=f.pivotConfig.rowItems,q=j[j.length-1],h,c,a,d,g,b;for(h=0;h<r;h++){b=p[h];if(h===0){q.x.push(Ext.Array.indexOf(m[b.dimension.dataIndex],b.value));for(c=0;c<n;c++){a=k[c];d=i[c];if(a.aggregate){g=o.results.items.map[b.key+'/'+a.key];d.value=g?g.values[a.dataIndex]:null}else if(a.dataIndex===b.dimensionId){d.value=b.value}}if(b.children){this.generatePivotBodyTabularItem(f,b)}}else {this.generatePivotBodyItem(f,b)}}j.push({r:e.level,t:'default',x:[Ext.Array.indexOf(m[e.dimension.dataIndex],e.value)]});i=[];for(c=0;c<n;c++){a=k[c];d={value:null};if(a.aggregate){g=o.results.items.map[e.key+'/'+a.key];d.value=g?g.values[a.dataIndex]:null}else if(a.dataIndex===e.dimensionId){d.value=e.data[a.dataIndex]+' '+this.totalText}i.push(d)}l.push({cells:i})},generatePivotRowTotals:function(e){var b=this._matrix,j=b.aggregate.items.length,i=b.leftAxis.dimensions.items.length,g=e.dataIndexes,l=g.length,m=e.totals,h=[],k=e.pivotConfig.rowItems,p,a,o,n,d,c,f;for(a=0;a<l;a++){d=g[a];c={value:null};if(a===0){c.value=i?this.grandTotalText:(j?this.totalText:null)}else if(d.aggregate){f=b.results.items.map[b.grandTotalKey+'/'+d.key];c.value=f?f.values[d.dataIndex]:null}h.push(c)}m.push({cells:h});k.push({t:'grand',x:0})},generatePivotColTotals:function(i,h){var b=this._matrix,g=i.pivotConfig.colItems,e=i.dataIndexes,f=b.aggregate.items,d=b.aggregate.items.length,j=b.topAxis.dimensions.items.length,a,c;if(j===0){for(a=0;a<d;a++){c=f[a];h.cells.push({value:c.excelName});e.push({aggregate:!0,key:b.grandTotalKey,dataIndex:c.id});g.push({t:'grand',i:a,x:0})}}else {if(d<=1){h.cells.push({value:this.grandTotalText});e.push({aggregate:!0,key:b.grandTotalKey,dataIndex:d?f[0].id:''});g.push({t:'grand',x:0})}else {for(a=0;a<d;a++){c=f[a];h.cells.push({value:this.totalText+' '+c.excelName});e.push({aggregate:!0,key:b.grandTotalKey,dataIndex:c.id});g.push({t:'grand',i:a,x:0})}}}},generatePivotData:function(a){var c=a.worksheet,d=a.pivotConfig.location,e,b,f;e=a.header.length;for(b=0;b<e;b++){f=c.renderRow(a.header[b]);if(b===0){d.ref=f.first+':'}}c.renderRows(a.body);c.renderRows(a.totals);d.ref+=c.getBottomRightRef()},generatePivotDataFields:function(d){var c=this._matrix,g=d.data.fields,f=this.aggregateMap,e=c.aggregate.items.length,b,a;for(b=0;b<e;b++){a=c.aggregate.items[b];d.pivotConfig.dataFields.push({name:a.excelName,fld:Ext.Array.indexOf(g,a.dataIndex),subtotal:f[a.aggregator]||'sum',baseField:0,baseItem:0})}},generatePivotFields:function(h){var f=this,e=f._matrix,l=h.data,j=l.fields,i=l.uniqueValues,n=e.aggregate.items.length,g,d,m,k,c,b,a;m=j.length;for(g=0;g<m;g++){c=j[g];b={showAll:!1};for(d=0;d<n;d++){a=e.aggregate.items[d];if(a.dataIndex===c){b.dataField=!0;break}}if(a=f.getDimension(e.aggregate,c)){}else if(a=f.getDimension(e.leftAxis.dimensions,c)){b.axis='axisRow';if(a.getSortable()){b.sortType=(a.direction==='ASC'?'ascending':'descending')}else {b.sortType='manual'}}else if(a=f.getDimension(e.topAxis.dimensions,c)){b.axis='axisCol';if(a.getSortable()){b.sortType=(a.direction==='ASC'?'ascending':'descending')}else {b.sortType='manual'}}if(a){b.items=[];k=i[c].length;for(d=0;d<k;d++){b.items.push({x:d})}b.items.push({t:'default'})}h.pivotConfig.cacheDefinition.cacheFields.push({name:c,sharedItems:{items:a&&!a.isAggregate?i[c]:[]}});h.pivotConfig.pivotFields.push(b)}},generatePivotRowFields:function(c){var b=this._matrix,e=c.data.fields,d=b.leftAxis.dimensions.items.length,a;for(a=0;a<d;a++){c.pivotConfig.rowFields.push({x:Ext.Array.indexOf(e,b.leftAxis.dimensions.items[a].dataIndex)})}},generatePivotColumnFields:function(c){var b=this._matrix,f=c.data.fields,d=b.aggregate.items.length,e=b.topAxis.dimensions.items.length,a;for(a=0;a<e;a++){c.pivotConfig.colFields.push({x:Ext.Array.indexOf(f,b.topAxis.dimensions.items[a].dataIndex)})}if(d>1){c.pivotConfig.colFields.push({x:-2})}},buildStoreRows:function(h){var a={rows:[],cache:[],fields:[],uniqueValues:{}},f,b,e,i,k,c,j,l,d,g;f=h.model.getFields();i=f.length;for(b=0;b<i;b++){c=f[b].getName();a.fields.push(c);a.uniqueValues[c]=[]}k=h.data.length;for(b=0;b<k;b++){j=[];g=[];l=h.data.items[b];for(e=0;e<i;e++){c=a.fields[e];d=l.get(c);j.push({value:d});g.push(d);if(Ext.Array.indexOf(a.uniqueValues[c],d)===-1){a.uniqueValues[c].push(d)}}a.rows.push(j);a.cache.push(g)}return a},setupUniqueAggregateNames:function(h){var g=this._matrix.aggregate,k=g.getCount(),j=h.length,i=[],e,d,b,c,f,a;for(d=0;d<k;d++){c=g.getAt(d);f=c.dataIndex||c.header;a=f;e=2;for(b=0;b<j;b++){if(String(a).toLowerCase()===String(h[b]).toLowerCase()||Ext.Array.indexOf(i,a)>=0){a=f+e;e++;b=-1}}i.push(a);c.excelName=a}},setupUniqueValues:function(e,d){var c=e.items,f=c.length,a,b;for(a=0;a<f;a++){b=c[a];d[b.dataIndex]=Ext.Array.pluck(b.values.items,'value')}},getDimension:function(a,c){var b=a.findIndex('dataIndex',c,0,!1,!0);return b>=0?a.getAt(b):null},generateTopAxisColumns:function(q,g,o){var s=this._matrix,u=q.data.uniqueValues,b=q.columns,n=s.aggregate.items,m=[],p,a,j,t,h,k,d,i,e,c,f,l,r;if(!o){o=s.topAxis.getTree()}t=o.length;h=n.length;for(p=0;p<t;p++){d=o[p];r=Ext.Array.indexOf(u[d.dimension.dataIndex],d.value);c=d.level;b[c]=b[c]||[];e={value:d.value==null?'(blank)':d.value,index:r};b[c].push(e);if(d.children){l=this.generateTopAxisColumns(q,g,d.children);k=l.length;for(a=1;a<k;a++){b[c].push({value:'',empty:!0})}for(a=0;a<h;a++){i=n[a];f={value:e.value+' '+(i.excelName)};b[c].push(f);l.push(f);k=b.length;for(j=c+1;j<k;j++){if(j===k-1){b[j].push({aggregate:!0,value:'',key:d.key,dataIndex:i.id,colItem:{t:'default',i:a,x:r}})}else {b[j].push({value:'',empty:!0})}}}Ext.Array.insert(m,m.length,l);g+=l.length}else {if(h<=1){m.push(e);g++;e.aggregate=!0;e.colItem=this.getColItem(g,0,b)}if(h===1){e.key=d.key;e.dataIndex=n[0].id}else if(h>1){c++;b[c]=b[c]||[];for(a=0;a<h;a++){i=n[a];g++;f={aggregate:!0,value:i.excelName,index:a,key:d.key,dataIndex:i.id};b[c].push(f);f.colItem=this.getColItem(g,a,b);m.push(f);if(a>0){b[c-1].push({value:'',empty:!0})}}}}}return m},getColItem:function(h,g,d){var c={i:g},e=0,f=[],i=d.length,b,a;for(b=0;b<i;b++){a=d[b][h];if(a){if(!a.empty){f.push(a.index)}else {}}else {e++}}c.r=e;c.x=f;return c}});Ext.define('Ext.pivot.Aggregators',{alternateClassName:['Mz.aggregate.Aggregators'],singleton:!0,customText:'Custom',sumText:'Sum',avgText:'Avg',minText:'Min',maxText:'Max',countText:'Count',countNumbersText:'Count numbers',groupSumPercentageText:'Group sum percentage',groupCountPercentageText:'Group count percentage',varianceText:'Var',variancePText:'Varp',stdDevText:'StdDev',stdDevPText:'StdDevp',sum:function(d,e,g,i,h){var f=d.length,a=g.calculateAsExcel?null:0,c,b;for(c=0;c<f;c++){b=d[c].get(e);if(b!==null){if(a===null){a=0}if(typeof b==='number'){a+=b}}}return a},avg:function(f,h,i,k,j){var g=f.length,e=i.calculateAsExcel,a=e?null:0,b=0,c,d;for(c=0;c<g;c++){d=f[c].get(h);if(typeof d==='number'){if(a===null){a=0}a+=d;b++}}if(!e){b=g}return (b>0&&a!==null)?(a/b):null},min:function(e,f,h,j,i){var g=e.length,b=null,d,a,c;for(d=0;d<g;d++){a=e[d].get(f);c=!0;if(h.calculateAsExcel){if(a!==null){if(typeof a!=='number'){a=0;c=!1}if(b===null){b=a}}else {c=!1}}if(c&&a<b){b=a}}return b},max:function(e,f,h,j,i){var g=e.length,b=null,d,a,c;for(d=0;d<g;d++){a=e[d].get(f);c=!0;if(h.calculateAsExcel){if(a!==null){if(typeof a!=='number'){a=0;c=!1}if(b===null){b=a}}else {c=!1}}if(c&&a>b){b=a}}return b},count:function(c,f,g,i,h){var d=c.length,a=null,b,e;if(g.calculateAsExcel){for(b=0;b<d;b++){e=c[b].get(f);if(e!==null){if(a===null){a=0}a++}}}else {a=d}return a},countNumbers:function(d,e,g,i,h){var f=d.length,a=null,b,c;for(b=0;b<f;b++){c=d[b].get(e);if(c!==null){if(a===null){a=0}if(typeof c==='number'){a++}}}return g.calculateAsExcel?a:a||0},groupSumPercentage:function(k,i,d,h,g){var j=Ext.pivot.Aggregators.sum,l=k.length,a=h.split(d.keysSeparator),f=null,c=null,e,b;if(!l){return null}a.pop();a=a.join(d.keysSeparator);if(Ext.isEmpty(a)){a=d.grandTotalKey}e=d.results.get(h,g);if(e){if(e.hasValue('groupSum')){f=e.getValue('groupSum')}else {f=e.calculateByFn('groupSum',i,j)}}b=d.results.get(a,g);if(b){if(b.hasValue('groupSum')){c=b.getValue('groupSum')}else {c=b.calculateByFn('groupSum',i,j)}}return (c!==null&&f!==null&&c!==0)?f/c*100:null},groupCountPercentage:function(k,j,d,h,g){var i=Ext.pivot.Aggregators.count,l=k.length,a=h.split(d.keysSeparator),f=null,c=null,e,b;if(!l){return null}a.pop();a=a.join(d.keysSeparator);if(Ext.isEmpty(a)){a=d.grandTotalKey}e=d.results.get(h,g);if(e){if(e.hasValue('groupCount')){f=e.getValue('groupCount')}else {f=e.calculateByFn('groupCount',j,i)}}b=d.results.get(a,g);if(b){if(b.hasValue('groupCount')){c=b.getValue('groupCount')}else {c=b.calculateByFn('groupCount',j,i)}}return (c!==null&&f!==null&&c!==0)?f/c*100:null},variance:function(e,i,k,m,l){var g=k.calculateAsExcel,c=Ext.pivot.Aggregators,h=g?c.countNumbers.apply(c,arguments):e.length,f=c.avg.apply(c,arguments),j=e.length,a=0,d,b;if(f>0){for(d=0;d<j;d++){b=e[d].get(i);if(g){if(typeof b==='number'){a+=Math.pow(b-f,2)}}else {a+=Math.pow(Ext.Number.from(b,0)-f,2)}}}return (a>0&&h>1)?(a/(h-1)):null},varianceP:function(e,i,k,m,l){var g=k.calculateAsExcel,c=Ext.pivot.Aggregators,h=g?c.countNumbers.apply(c,arguments):e.length,f=c.avg.apply(c,arguments),j=e.length,a=0,d,b;if(f>0){for(d=0;d<j;d++){b=e[d].get(i);if(g){if(typeof b==='number'){a+=Math.pow(b-f,2)}}else {a+=Math.pow(Ext.Number.from(b,0)-f,2)}}}return (a>0&&h>0)?(a/h):null},stdDev:function(f,e,g,d,c){var a=Ext.pivot.Aggregators,b=a.variance.apply(a,arguments);return b>0?Math.sqrt(b):null},stdDevP:function(f,e,g,d,c){var a=Ext.pivot.Aggregators,b=a.varianceP.apply(a,arguments);return b>0?Math.sqrt(b):null}});Ext.define('Ext.pivot.MixedCollection',{extend:'Ext.util.MixedCollection',alternateClassName:['Mz.aggregate.MixedCollection'],removeAt:function(a){Ext.destroy(this.callParent(arguments))},clear:function(){this.destroyItems();this.callParent(arguments)},removeAll:function(){this.destroyItems();this.callParent(arguments)},destroy:function(){this.clear()},destroyItems:function(){var b=this.items,d,a,c;if(b){d=b.length;for(a=0;a<d;a++){c=b[a];if(c.destroy){c.destroy()}}}}});Ext.define('Ext.pivot.filter.Base',{alternateClassName:['Mz.aggregate.filter.Abstract'],alias:'pivotfilter.base',mixins:['Ext.mixin.Factoryable'],isFilter:!0,operator:null,value:null,caseSensitive:!0,parent:null,constructor:function(a){var c=this,b=Ext.util.Format;c.thousandRe=new RegExp('['+b.thousandSeparator+']','g');c.decimalRe=new RegExp('['+b.decimalSeparator+']');Ext.apply(this,a);return this.callParent([a])},destroy:function(){var a=this;a.parent=a.thousandRe=a.decimalRe=null;a.callParent()},serialize:function(){var a=this;return Ext.apply({type:a.type,operator:a.operator,value:a.value,caseSensitive:a.caseSensitive},a.getSerialArgs()||{})},getSerialArgs:Ext.emptyFn,isMatch:function(f){var a=this,b=a.value,c,d,e,g,h;b=(Ext.isArray(b)?b[0]:b)||'';c=a.compare(f,b);if(a.operator=='='){return (c===0)}if(a.operator=='!='){return (c!==0)}if(a.operator=='>'){return (c>0)}if(a.operator=='>='){return (c>=0)}if(a.operator=='<'){return (c<0)}if(a.operator=='<='){return (c<=0)}b=a.value;g=(Ext.isArray(b)?b[0]:b)||'';h=(Ext.isArray(b)?b[1]:b)||'';d=a.compare(f,g);e=a.compare(f,h);if(a.operator=='between'){return (d>=0&&e<=0)}if(a.operator=='not between'){return !(d>=0&&e<=0)}return !0},parseNumber:function(a){var b;if(typeof a==='number'){return a}if(Ext.isEmpty(a)){a=''}b=String(a).replace(this.thousandRe,'');b=b.replace(this.decimalRe,'.');if(Ext.isNumeric(b)){return parseFloat(b)}return null},compare:function(a,b){var c=Ext.pivot.matrix.Base.prototype.naturalSort,d=this.parseNumber(a),e=this.parseNumber(b);if(Ext.isNumber(d)&&Ext.isNumber(e)){return c(d,e)}if(Ext.isDate(a)){if(Ext.isDate(b)){return c(a,b)}else {return c(a,Ext.Date.parse(b,Ext.Date.defaultFormat))}}return (this.caseSensitive?c(a||'',b||''):c(String(a||'').toLowerCase(),String(b||'').toLowerCase()))},deprecated:{'6.0':{properties:{mztype:null,from:null,to:null}}}});Ext.define('Ext.pivot.filter.Label',{alternateClassName:['Mz.aggregate.filter.Label'],extend:'Ext.pivot.filter.Base',alias:'pivotfilter.label',isMatch:function(b){var a=this,c;if(a.operator=='begins'){return Ext.String.startsWith(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='not begins'){return !Ext.String.startsWith(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='ends'){return Ext.String.endsWith(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='not ends'){return !Ext.String.endsWith(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='contains'){return a.stringContains(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='not contains'){return !a.stringContains(String(b||''),String(a.value||''),!a.caseSensitive)}if(a.operator=='in'){return a.foundInArray(a.value)}if(a.operator=='not in'){return !a.foundInArray(a.value)}return a.callParent(arguments)},foundInArray:function(d){var c=Ext.Array.from(this.value),e=c.length,a=!1,b;if(this.caseSensitive){return Ext.Array.indexOf(c,d)>=0}else {for(b=0;b<e;b++){a=a||(String(d).toLowerCase()==String(c[b]).toLowerCase());if(a){break}}return a}},stringContains:function(b,a,d){var c=(a.length<=b.length);if(c){if(d){b=b.toLowerCase();a=a.toLowerCase()}c=(b.lastIndexOf(a)>=0)}return c},deprecated:{'6.0':{methods:{startsWith:Ext.emptyFn,endsWith:Ext.emptyFn}}}});Ext.define('Ext.pivot.filter.Value',{alternateClassName:['Mz.aggregate.filter.Value'],extend:'Ext.pivot.filter.Base',alias:'pivotfilter.value',dimensionId:'',topType:'items',topOrder:'top',topSort:!0,isTopFilter:!1,constructor:function(a){var b=this.callParent([a]);this.isTopFilter=(this.operator==='top10');return b},destroy:function(){this.dimension=null;this.callParent()},getDimension:function(){return this.parent.matrix.aggregate.getByKey(this.dimensionId)},getSerialArgs:function(){var a=this;return {dimensionId:a.dimensionId,topType:a.topType,topOrder:a.topOrder,topSort:a.topSort}},applyFilter:function(e,d){var a=this,b=a.topSort?d:Ext.Array.clone(d),c=[];if(d.length==0){return c}a.sortItemsByGrandTotal(e,b);switch(a.topType){case 'items':c=a.extractTop10Items(b);break;case 'sum':c=a.extractTop10Sum(b);break;case 'percent':c=a.extractTop10Percent(e,b);break;}if(!a.topSort){b.length=0}return c},extractTop10Items:function(b){var d=this,c=[],a;for(a=0;a<b.length;a++){if(c.indexOf(b[a]['tempVar'])<0){c.push(b[a]['tempVar']);if(c.length>d.value||(d.value<a+1&&a>0)){break}}}return Ext.Array.slice(b,a)},extractTop10Sum:function(b){var d=this,c=0,a;for(a=0;a<b.length;a++){c+=b[a]['tempVar'];if(c>=d.value){break}}return Ext.Array.slice(b,a+1)},extractTop10Percent:function(a,c){var k=this,j=0,f=c[0].key.split(a.matrix.keysSeparator),b,h,i,d,e,g;f.length--;d=(f.length>0?f.join(a.matrix.keysSeparator):a.matrix.grandTotalKey);h=(a.isLeftAxis?d:a.matrix.grandTotalKey);i=(a.isLeftAxis?a.matrix.grandTotalKey:d);e=a.matrix.results.get(h,i);g=(e?e.getValue(k.dimensionId):0);for(b=0;b<c.length;b++){j+=c[b]['tempVar'];if((j*100/g)>=k.value){break}}return Ext.Array.slice(c,b+1)},sortItemsByGrandTotal:function(a,c){var e=this,f,g,d,b;for(b=0;b<c.length;b++){f=(a.isLeftAxis?c[b].key:a.matrix.grandTotalKey);g=(a.isLeftAxis?a.matrix.grandTotalKey:c[b].key);d=a.matrix.results.get(f,g);c[b]['tempVar']=(d?d.getValue(e.dimensionId):0)}Ext.Array.sort(c,function(d,f){var b=a.matrix.naturalSort(d['tempVar'],f['tempVar']);if(b<0&&e.topOrder==='top'){return 1}if(b>0&&e.topOrder==='top'){return -1}return b})}});Ext.define('Ext.pivot.dimension.Item',{alternateClassName:['Mz.aggregate.dimension.Item'],requires:['Ext.pivot.MixedCollection','Ext.pivot.filter.Label','Ext.pivot.filter.Value','Ext.app.bind.Template'],$configPrefixed:!1,$configStrict:!1,config:{id:null,header:'',dataIndex:'',sortIndex:'',width:100,flex:0,align:'left',sortable:!0,direction:'ASC',sorterFn:null,caseSensitiveSort:!0,filter:null,labelRenderer:null,renderer:null,formatter:null,column:null,exportStyle:null,scope:null,grouperFn:null,blankText:'(blank)',showZeroAsBlank:!1,aggregator:'sum',values:[]},isAggregate:!1,matrix:null,constructor:function(b){var a=this;this.initConfig(b);if(!a.getId()){a.setId(Ext.id())}if(!a.grouperFn){a.groupFn=Ext.bind(a.defaultGrouperFn,a)}if(a.sortable){if(!a.sorterFn){a.sortFn=Ext.bind(a.defaultSorterFn,a)}}else {a.sortFn=Ext.bind(a.manualSorterFn,a)}if(Ext.isEmpty(a.getSortIndex())){a.setSortIndex(a.getDataIndex())}if(a.isAggregate&&!a.getFormatter()&&!a.getRenderer()){a.setRenderer(a.getDefaultFormatRenderer('0,000.00'))}return this.callParent([b])},destroy:function(){this.setConfig({values:null,grouperFn:null,sorterFn:null,filter:null,renderer:null,labelRenderer:null,aggregator:null});this.callParent()},serialize:function(){return this.getConfiguration(!0)},getConfiguration:function(b){var c=this,a=c.getConfig();delete (a.values);if(a.filter){a.filter=a.filter.serialize()}if(b&&typeof a.aggregator==='function'){a.aggregator='sum'}if(b&&typeof a.renderer==='function'){a.renderer=null}if(b&&typeof a.labelRenderer==='function'){a.labelRenderer=null}return a},applyId:function(a){return a?a:Ext.id()},updateExportStyle:function(a){if(a&&!a.id){a.id=this.getId()}},applyFilter:function(a,b){if(a==null){return a}if(a&&a.isFilter){a.parent=this;return a}if(Ext.isObject(a)){Ext.applyIf(a,{type:'label',parent:this});a=Ext.Factory.pivotfilter(a)}else {a=!1}return a},updateAggregator:function(a){var b=Ext.pivot.Aggregators;if(Ext.isString(a)&&Ext.isFunction(b[a])){this.aggregatorFn=Ext.bind(b[a],b)}else {this.aggregatorFn=a||'sum'}},updateGrouperFn:function(a){this.groupFn=(Ext.isFunction(a)?Ext.bind(a,this):a)},updateSorterFn:function(a){this.sortFn=(Ext.isFunction(a)?Ext.bind(a,this):a)},addValue:function(a,c){var b=this.values;if(!b.getByKey(a)){b.add({sortValue:a,value:a,display:c})}},applyValues:function(a,c){var b;Ext.destroy(c);if(a&&!a.isInstance){b=new Ext.pivot.MixedCollection();b.getKey=function(b){return b.value};b.addAll(a);return b}return a},sortValues:function(){if(this.sortable){this.values.sortBy(this.sortFn)}},defaultSorterFn:function(e,f){var d=this,a=e.sortValue,b=f.sortValue,c;if(a instanceof Date){a=a.getTime()}if(b instanceof Date){b=b.getTime()}if(!d.caseSensitiveSort){a=typeof a==='string'?a.toUpperCase():a;b=typeof b==='string'?b.toUpperCase():b}if(d.matrix.useNaturalSorting){c=d.matrix.naturalSort(a,b)}else {c=(a===b?0:(a<b?-1:1))}if(c<0&&d.direction==='DESC'){return 1}if(c>0&&d.direction==='DESC'){return -1}return c},manualSorterFn:function(d,e){var a=this.values,b=a?a.indexOfKey(d.value):0,c=a?a.indexOfKey(e.value):0;return (b===c?0:(b<c?-1:1))},getDefaultFormatRenderer:function(a){var b=this;return function(c){var d;if(Ext.isEmpty(a)){return c}if(Ext.isFunction(a)){return a.apply(b,arguments)}if(!Ext.isNumber(c)){return c}if(b.isAggregate&&c===0&&b.showZeroAsBlank){return ''}d=(c>=0);c=Math.abs(c);c=Ext.util.Format.number(c,a);return d?c:'-'+c}},defaultGrouperFn:function(a){return a.get(this.dataIndex)},getFormatterFn:function(){var c=this,a=c.getFormatter(),b;if(a){b=a.indexOf('this.')===0;if(b){a=a.substring(5)}a=Ext.app.bind.Template.prototype.parseFormat(a);if(b){a.scope=null}return function(b){return a.format(b,a.scope||c.getScope()||c.matrix.cmp.resolveListenerScope('self.controller')||this)}}},aggregatorFn:Ext.emptyFn,groupFn:Ext.emptyFn,sortFn:Ext.emptyFn});Ext.define('Ext.pivot.axis.Item',{alternateClassName:['Mz.aggregate.axis.Item'],level:0,key:'',value:'',sortValue:'',name:'',dimensionId:'',dimension:null,children:null,record:null,records:null,axis:null,data:null,expanded:!1,constructor:function(c){var a=this,b;Ext.apply(a,c||{});if(Ext.isEmpty(a.sortValue)){a.sortValue=a.value}b=a.axis;a.expanded=(b&&((b.isLeftAxis&&!b.matrix.collapsibleRows)||(!b.isLeftAxis&&!b.matrix.collapsibleColumns)));a.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.children);a.axis=a.data=a.dimension=a.record=a.children=a.records=null;a.callParent(arguments)},getTextTotal:function(){var a=this,b=Ext.XTemplate.getTpl(a.axis.matrix,'textTotalTpl');return b.apply({groupField:a.dimension.dataIndex,columnName:a.dimension.dataIndex,name:a.name,rows:a.children||[]})},expand:function(b){var a=this;a.expanded=!0;if(b===!0){a.expandCollapseChildrenTree(!0)}a.axis.matrix.fireEvent('groupexpand',a.axis.matrix,(a.axis.isLeftAxis?'row':'col'),a)},collapse:function(b){var a=this;a.expanded=!1;if(b===!0){a.expandCollapseChildrenTree(!1)}a.axis.matrix.fireEvent('groupcollapse',a.axis.matrix,(a.axis.isLeftAxis?'row':'col'),a)},expandCollapseChildrenTree:function(c){var a=this,b;a.expanded=c;if(Ext.isArray(a.children)){for(b=0;b<a.children.length;b++){a.children[b].expandCollapseChildrenTree(c)}}}});Ext.define('Ext.pivot.axis.Base',{alternateClassName:['Mz.aggregate.axis.Abstract'],alias:'pivotaxis.base',mixins:['Ext.mixin.Factoryable'],requires:['Ext.pivot.MixedCollection','Ext.pivot.dimension.Item','Ext.pivot.axis.Item'],dimensions:null,matrix:null,items:null,tree:null,levels:0,isLeftAxis:!1,constructor:function(b){var a=this,d,c;if(!b||!b.matrix){return}a.isLeftAxis=b.isLeftAxis||a.isLeftAxis;a.matrix=b.matrix;a.tree=[];a.dimensions=new Ext.pivot.MixedCollection();a.dimensions.getKey=function(a){return a.getId()};a.items=new Ext.pivot.MixedCollection();a.items.getKey=function(a){return a.key};Ext.Array.each(Ext.Array.from(b.dimensions||[]),a.addDimension,a)},destroy:function(){var a=this;Ext.destroyMembers(a,'dimensions','items','tree');a.matrix=a.dimensions=a.items=a.tree=null},addDimension:function(a){var b=a;if(!a){return}if(!a.isInstance){b=new Ext.pivot.dimension.Item(a)}b.matrix=this.matrix;this.dimensions.add(b)},addItem:function(a){var b=this;if(!Ext.isObject(a)||Ext.isEmpty(a.key)||Ext.isEmpty(a.value)||Ext.isEmpty(a.dimensionId)){return !1}a.key=String(a.key);a.dimension=b.dimensions.getByKey(a.dimensionId);a.name=a.name||Ext.callback(a.dimension.labelRenderer,a.dimension.scope||'self.controller',[a.value],0,b.matrix.cmp)||a.value;a.dimension.addValue(a.value,a.name);a.axis=b;if(!b.items.map[a.key]&&a.dimension){b.items.add(new Ext.pivot.axis.Item(a));return !0}return !1},clear:function(){this.items.clear();this.tree=null},getTree:function(){if(!this.tree){this.buildTree()}return this.tree},expandAll:function(){var a=this,c=a.getTree(),d=c.length,b;for(b=0;b<d;b++){c[b].expandCollapseChildrenTree(!0)}if(d>0){a.matrix.fireEvent('groupexpand',a.matrix,(a.isLeftAxis?'row':'col'),null)}},collapseAll:function(){var a=this,c=a.getTree(),d=c.length,b;for(b=0;b<d;b++){c[b].expandCollapseChildrenTree(!1)}if(d>0){a.matrix.fireEvent('groupcollapse',a.matrix,(a.isLeftAxis?'row':'col'),null)}},findTreeElement:function(d,c){var f=this.items,g=f.getCount(),e=!1,b,a;for(b=0;b<g;b++){a=f.items[b];if(Ext.isDate(c)?Ext.Date.isEqual(a[d],c):a[d]===c){e=!0;break}}return e?{level:a.level,node:a}:null},buildTree:function(){var b=this,e=b.dimensions.items,g=e.length,c,a,f,h,d;for(c=0;c<g;c++){e[c].sortValues()}b.tree=[];e=b.items.items;g=e.length;for(c=0;c<g;c++){a=e[c];f=String(a.key).split(b.matrix.keysSeparator);f=Ext.Array.slice(f,0,f.length-1);h=f.join(b.matrix.keysSeparator);d=b.items.map[h];if(d){a.level=d.level+1;a.data=Ext.clone(d.data||{});d.children=d.children||[];d.children.push(a)}else {a.level=0;a.data={};b.tree.push(a)}a.data[a.dimension.getId()]=a.name;b.levels=Math.max(b.levels,a.level)}b.sortTree()},rebuildTree:function(){var b=this.items.items,c=b.length,a;this.tree=null;for(a=0;a<c;a++){b[a].children=null}this.buildTree()},sortTree:function(){var a=arguments[0]||this.tree,e=a.length,c,b,d;if(a.length>0){c=a[0].dimension}if(c){Ext.Array.sort(a,c.sortFn)}for(b=0;b<e;b++){d=a[b];if(d.children){this.sortTree(d.children)}}},sortTreeByField:function(f,b){var a=this,d=!1,c,g,e;if(f==a.matrix.compactViewKey){d=a.sortTreeByDimension(a.tree,a.dimensions.items,b);g=a.dimensions.items.length;for(e=0;e<g;e++){a.dimensions.items[e].direction=b}}else {b=b||'ASC';c=a.dimensions.getByKey(f);if(c){d=a.sortTreeByDimension(a.tree,c,b);c.direction=b}else {d=a.sortTreeByRecords(a.tree,f,b)}}return d},sortTreeByDimension:function(b,f,g){var c=!1,i=Ext.Array.from(f),a,e,d,h;b=b||[];e=b.length;if(e>0){a=b[0].dimension}if(Ext.Array.indexOf(i,a)>=0){if(a.sortable){h=a.direction;a.direction=g;Ext.Array.sort(b,a.sortFn);a.direction=h}c=a.sortable}for(d=0;d<e;d++){c=this.sortTreeByDimension(b[d].children,f,g)||c}return c},sortTreeByRecords:function(a,d,c){var b,e;a=a||[];e=a.length;if(e<=0){return !1}if(a[0].record){this.sortTreeRecords(a,d,c)}else {this.sortTreeLeaves(a,d,c)}for(b=0;b<e;b++){this.sortTreeByRecords(a[b].children,d,c)}return !0},sortTreeRecords:function(d,b,a){var c=this.matrix.naturalSort;a=a||'ASC';Ext.Array.sort(d||[],function(h,i){var e,f=h.record,g=i.record;if(!(f&&f.isModel&&g&&g.isModel)){return 0}e=c(f.get(b)||'',g.get(b)||'');if(e<0&&a==='DESC'){return 1}if(e>0&&a==='DESC'){return -1}return e})},sortTreeLeaves:function(i,h,a){var g=this.matrix.naturalSort,f=this.matrix.results,b=this.matrix.model,e=Ext.Array.indexOf(Ext.Array.pluck(b,'name'),h),d,c;if(e<0){return !1}d=b[e]['col'];c=b[e]['agg'];a=a||'ASC';Ext.Array.sort(i||[],function(k,l){var j,b,e;b=f.get(k.key,d);if(b){b=b.getValue(c)}else {b=0}e=f.get(l.key,d);if(e){e=e.getValue(c)}else {e=0}j=g(b,e);if(j<0&&a==='DESC'){return 1}if(j>0&&a==='DESC'){return -1}return j})}});Ext.define('Ext.pivot.axis.Local',{alternateClassName:['Mz.aggregate.axis.Local'],extend:'Ext.pivot.axis.Base',alias:'pivotaxis.local',processRecord:function(h){var c=this,i=[],f='',g=!0,j=c.dimensions.items.length,b,d,a,e;for(e=0;e<j;e++){a=c.dimensions.items[e];b=Ext.callback(a.groupFn,a.scope||'self.controller',[h],0,c.matrix.cmp);d=f?f+c.matrix.keysSeparator:'';b=Ext.isEmpty(b)?a.blankText:b;d+=c.matrix.getKey(b);if(a.filter instanceof Ext.pivot.filter.Label){g=a.filter.isMatch(b)}if(!g){break}i.push({value:b,sortValue:h.get(a.sortIndex),key:d,dimensionId:a.getId()});f=d}if(g){return i}else {return null}},buildTree:function(){this.callParent(arguments);this.filterTree()},filterTree:function(){var a=this,d=a.dimensions.items.length,c=!1,b;for(b=0;b<d;b++){c=c||(a.dimensions.items[b].filter instanceof Ext.pivot.filter.Value)}if(!c){return}a.matrix.filterApplied=!0;a.filterTreeItems(a.tree)},filterTreeItems:function(a){var c=this,e,b,d;if(!a||!Ext.isArray(a)||a.length<=0){return}e=a[0].dimension.filter;if(e&&(e instanceof Ext.pivot.filter.Value)){if(e.isTopFilter){d=e.applyFilter(c,a)||[]}else {d=Ext.Array.filter(a,c.canRemoveItem,c)}c.removeRecordsFromResults(d);c.removeItemsFromArray(a,d);for(b=0;b<d.length;b++){c.removeTreeChildren(d[b])}}for(b=0;b<a.length;b++){if(a[b].children){c.filterTreeItems(a[b].children);if(a[b].children.length===0){c.items.remove(a[b]);Ext.Array.erase(a,b,1);b--}}}},removeTreeChildren:function(a){var b,c;if(a.children){c=a.children.length;for(b=0;b<c;b++){this.removeTreeChildren(a.children[b])}}this.items.remove(a)},canRemoveItem:function(b){var a=this,e=(a.isLeftAxis?b.key:a.matrix.grandTotalKey),f=(a.isLeftAxis?a.matrix.grandTotalKey:b.key),d=a.matrix.results.get(e,f),c=b.dimension.filter;return (d?!c.isMatch(d.getValue(c.dimensionId)):!1)},removeItemsFromArray:function(b,c){for(var a=0;a<b.length;a++){if(Ext.Array.indexOf(c,b[a])>=0){Ext.Array.erase(b,a,1);a--}}},removeRecordsFromResults:function(b){for(var a=0;a<b.length;a++){this.removeRecordsByItem(b[a])}},removeRecordsByItem:function(f){var a=this,c,d,b,g,e;if(f.children){a.removeRecordsFromResults(f.children)}if(a.isLeftAxis){e=a.matrix.results.get(f.key,a.matrix.grandTotalKey);b=a.matrix.results.getByLeftKey(a.matrix.grandTotalKey)}else {e=a.matrix.results.get(a.matrix.grandTotalKey,f.key);b=a.matrix.results.getByTopKey(a.matrix.grandTotalKey)}if(!e){return}for(d=0;d<b.length;d++){a.removeItemsFromArray(b[d].records,e.records)}c=f.key.split(a.matrix.keysSeparator);c.length=c.length-1;while(c.length>0){if(a.isLeftAxis){b=a.matrix.results.getByLeftKey(c.join(a.matrix.keysSeparator))}else {b=a.matrix.results.getByTopKey(c.join(a.matrix.keysSeparator))}for(d=0;d<b.length;d++){a.removeItemsFromArray(b[d].records,e.records)}c.length=c.length-1}}});Ext.define('Ext.pivot.feature.PivotStore',{config:{store:null,grid:null,matrix:null,clsGrandTotal:'',clsGroupTotal:''},totalRowEvent:'pivottotal',groupRowEvent:'pivotgroup',itemRowEvent:'pivotitem',constructor:function(a){this.initConfig(a);return this.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.storeListeners,a.matrixListeners);a.setConfig({store:null,matrix:null,grid:null});a.storeInfo=a.storeListeners=null;a.callParent(arguments)},updateStore:function(b){var a=this;Ext.destroy(a.storeListeners);if(b){a.storeListeners=b.on({pivotstoreremodel:a.processStore,scope:a,destroyable:!0})}},updateMatrix:function(b){var a=this;Ext.destroy(a.matrixListeners);if(b){a.matrixListeners=b.on({groupexpand:a.onGroupExpand,groupcollapse:a.onGroupCollapse,scope:a,destroyable:!0})}},processStore:function(){var c=this,b=c.getStore(),e=c.getMatrix(),a=[],f,h,d,i,g;if(!e||!b){return}g=e.getColumns();b.suspendEvents();b.model.replaceFields(g,!0);c.storeInfo={};if(e.rowGrandTotalsPosition=='first'){a.push.apply(a,c.processGrandTotal()||[])}f=e.leftAxis.getTree();h=f.length;for(d=0;d<h;d++){i=f[d];a.push.apply(a,c.processGroup({group:i,previousExpanded:(d>0?f[d-1].expanded:!1)})||[])}if(e.rowGrandTotalsPosition=='last'){a.push.apply(a,c.processGrandTotal()||[])}b.loadData(a);b.resumeEvents();b.fireEvent('refresh',b)},processGroup:function(c){var a=this,b=a['processGroup'+Ext.String.capitalize(a.getMatrix().viewLayoutType)];if(!Ext.isFunction(b)){b=a.processGroupOutline}return b.call(a,c)},processGrandTotal:function(){var c=this,m=!1,b=c.getMatrix(),i={key:b.grandTotalKey},l=[],o=b.totals.length,k=b.leftAxis.dimensions.items,n=k.length,f,d,g,j,h,a,e;for(f=0;f<o;f++){j=b.totals[f];a=j.record;g=n;if(a&&a.isModel){c.storeInfo[a.internalId]={leftKey:i.key,rowStyle:'',rowClasses:[c.getClsGrandTotal()],rowEvent:c.totalRowEvent,rendererParams:{}};for(d=0;d<n;d++){h=k[d];if(b.viewLayoutType=='compact'||d===0){if(b.viewLayoutType=='compact'){e=b.compactViewKey;g=1}else {e=h.getId()}a.data[e]=j.title;c.storeInfo[a.internalId].rendererParams[e]={fn:'groupOutlineRenderer',group:i,colspan:g,hidden:!1,subtotalRow:!0};m=!0}else {c.storeInfo[a.internalId].rendererParams[h.id]={fn:'groupOutlineRenderer',group:i,colspan:0,hidden:m,subtotalRow:!0};g--}}c.storeInfo[a.internalId].rendererParams['topaxis']={fn:'topAxisRenderer'};l.push(a)}}return l},processGroupOutline:function(c){var d=this,b=c['group'],a=[];if(b.record){d.processRecordOutline({results:a,group:b})}else {d.processGroupOutlineWithChildren({results:a,group:b,previousExpanded:c.previousExpanded})}return a},processGroupOutlineWithChildren:function(b){var d=this,h=d.getMatrix(),a=b['group'],f=b['previousExpanded'],g,e,c,i;g=(!a.expanded||(a.expanded&&h.rowSubTotalsPosition=='first'));e=a.expanded?a.records.expanded:a.records.collapsed;d.processGroupHeaderRecordOutline({results:b.results,group:a,record:e,previousExpanded:f,hasSummaryData:g});if(a.expanded){if(a.children){i=a.children.length;for(c=0;c<i;c++){if(a.children[c]['children']){d.processGroupOutlineWithChildren({results:b.results,group:a.children[c]})}else {d.processRecordOutline({results:b.results,group:a.children[c]})}}}if(h.rowSubTotalsPosition=='last'){e=a.records.footer;d.processGroupHeaderRecordOutline({results:b.results,group:a,record:e,previousExpanded:f,subtotalRow:!0,hasSummaryData:!0})}}},processGroupHeaderRecordOutline:function(b){var a=this,n=a.getMatrix(),d=b['group'],c=b['record'],g=b['previousExpanded'],h=b['subtotalRow'],m=b['hasSummaryData'],j=n.leftAxis.dimensions.items,k=j.length,l=k,i=!1,f,e;a.storeInfo[c.internalId]={leftKey:d.key,rowStyle:'',rowClasses:[a.getClsGroupTotal()],rowEvent:a.groupRowEvent,rendererParams:{}};for(f=0;f<k;f++){e=j[f];if(e.id==d.dimension.id){a.storeInfo[c.internalId].rendererParams[e.id]={fn:'groupOutlineRenderer',group:d,colspan:l,hidden:!1,previousExpanded:g,subtotalRow:h};i=!0}else {a.storeInfo[c.internalId].rendererParams[e.id]={fn:'groupOutlineRenderer',group:d,colspan:0,hidden:i,previousExpanded:g,subtotalRow:h};l--}}a.storeInfo[c.internalId].rendererParams['topaxis']={fn:(m?'topAxisRenderer':'topAxisNoRenderer'),group:d};b.results.push(c)},processRecordOutline:function(f){var b=this,a=f['group'],g=!1,c=a.record,h=b.getMatrix().leftAxis.dimensions.items,i=h.length,d,e;b.storeInfo[c.internalId]={leftKey:a.key,rowStyle:'',rowClasses:[],rowEvent:b.itemRowEvent,rendererParams:{}};for(d=0;d<i;d++){e=h[d];if(e.id==a.dimension.id){g=!0}b.storeInfo[c.internalId].rendererParams[e.id]={fn:'recordOutlineRenderer',group:a,hidden:!g}}b.storeInfo[c.internalId].rendererParams['topaxis']={fn:'topAxisRenderer',group:a};f.results.push(c)},processGroupCompact:function(c){var d=this,b=c['group'],e=c['previousExpanded'],a=[];if(b.record){d.processRecordCompact({results:a,group:b})}else {d.processGroupCompactWithChildren({results:a,group:b,previousExpanded:e})}return a},processGroupCompactWithChildren:function(b){var d=this,g=d.getMatrix(),a=b['group'],e=b['previousExpanded'],f,c,h;f=(!a.expanded||(a.expanded&&g.rowSubTotalsPosition=='first'));d.processGroupHeaderRecordCompact({results:b.results,group:a,record:a.expanded?a.records.expanded:a.records.collapsed,previousExpanded:e,hasSummaryData:f});if(a.expanded){if(a.children){h=a.children.length;for(c=0;c<h;c++){if(a.children[c]['children']){d.processGroupCompactWithChildren({results:b.results,group:a.children[c]})}else {d.processRecordCompact({results:b.results,group:a.children[c]})}}}if(g.rowSubTotalsPosition=='last'){d.processGroupHeaderRecordCompact({results:b.results,group:a,record:a.records.footer,previousExpanded:e,subtotalRow:!0,hasSummaryData:!0})}}},processGroupHeaderRecordCompact:function(a){var b=this,h=b.getMatrix(),d=a['group'],c=a['record'],e=a['previousExpanded'],g=a['subtotalRow'],f=a['hasSummaryData'];b.storeInfo[c.internalId]={leftKey:d.key,rowStyle:'',rowClasses:[b.getClsGroupTotal()],rowEvent:b.groupRowEvent,rendererParams:{}};b.storeInfo[c.internalId].rendererParams[h.compactViewKey]={fn:'groupCompactRenderer',group:d,colspan:0,previousExpanded:e,subtotalRow:g};b.storeInfo[c.internalId].rendererParams['topaxis']={fn:(f?'topAxisRenderer':'topAxisNoRenderer'),group:d};a.results.push(c)},processRecordCompact:function(d){var a=this,c=d['group'],b=c.record;a.storeInfo[b.internalId]={leftKey:c.key,rowStyle:'',rowClasses:[],rowEvent:a.itemRowEvent,rendererParams:{}};a.storeInfo[b.internalId].rendererParams[a.getMatrix().compactViewKey]={fn:'recordCompactRenderer',group:c};a.storeInfo[b.internalId].rendererParams['topaxis']={fn:'topAxisRenderer',group:c};d.results.push(b)},processGroupTabular:function(c){var d=this,b=c['group'],a=[];if(b.record){d.processRecordTabular({results:a,group:b})}else {d.processGroupTabularWithChildren({results:a,group:b,previousExpanded:c.previousExpanded})}return a},processGroupTabularWithChildren:function(b,i){var d=this,j=d.getMatrix(),a=b['group'],f=b['previousExpanded'],g,e,c,h;if(!i){d.processGroupHeaderRecordTabular({results:b.results,group:a,previousExpanded:f,hasSummaryData:!a.expanded})}if(a.expanded){if(a.children){h=a.children.length;for(e=0;e<h;e++){c=a.children[e];if(e===0&&c.children&&c.expanded){d.processGroupTabularWithChildren({results:b.results,group:c},!0)}else if(e>0){if(c.children){d.processGroupTabularWithChildren({results:b.results,group:c})}else {d.processRecordTabular({results:b.results,group:c})}}}}if(j.rowSubTotalsPosition!=='none'){g=a.records.footer;d.processGroupHeaderRecordTabular({results:b.results,group:a,record:g,previousExpanded:f,subtotalRow:!0,hasSummaryData:!0})}}},getTabularGroupRecord:function(b){var a=b.record;if(!a){if(!b.expanded){a=b.records.collapsed}else {a=this.getTabularGroupRecord(b.children[0])}}return a},processGroupHeaderRecordTabular:function(i){var k=this,f=k.getMatrix(),g=i['group'],b=i['record'],n=i['previousExpanded'],o=i['subtotalRow'],t=i['hasSummaryData'],u=f.leftAxis.dimensions,p=u.length,s=p,m=!1,d={},q=[],r=k.itemRowEvent,h,c,a,j,e,l;if(!b){a=g;b=a.record;while(!b){d[a.dimension.id]={fn:'groupTabularRenderer',group:a,colspan:0,hidden:!1,previousExpanded:n,subtotalRow:o};if(a.children){if(!a.expanded){b=a.records.collapsed;d[a.dimension.id].colspan=p-a.level}else {a=a.children[0]}}else {b=a.record}}m=!1;for(h=0;h<p;h++){c=f.leftAxis.dimensions.items[h];if(d[c.id]){b.data[c.id]=d[c.id].group.name;m=!0}else if(m){d[c.id]={fn:'groupTabularRenderer',group:g,colspan:0,hidden:!0,previousExpanded:n,subtotalRow:o}}else {b.data[c.id]=''}}if(g.level>0){l=g;j=l.key.split(f.keysSeparator);j.length--;e=f.leftAxis.items.getByKey(j.join(f.keysSeparator));while(e&&e.children[0]==l){d[e.dimension.id]={fn:'groupTabularRenderer',group:e,colspan:0,hidden:!1,previousExpanded:n,subtotalRow:o};b.data[e.dimension.id]=e.name;l=e;j=l.key.split(f.keysSeparator);j.length--;e=f.leftAxis.items.getByKey(j.join(f.keysSeparator))}}}else {for(h=0;h<p;h++){c=f.leftAxis.dimensions.items[h];d[c.id]={fn:'groupTabularRenderer',group:g,colspan:0,hidden:!1,previousExpanded:n,subtotalRow:o};if(c.id==g.dimension.id){d[c.id].colspan=s;m=!0}else {d[c.id].hidden=m;s--}}a=g}if(t){q.push(k.getClsGroupTotal());r=k.groupRowEvent}k.storeInfo[b.internalId]={leftKey:g.key,rowStyle:'',rowClasses:q,rowEvent:r,rendererParams:d};k.storeInfo[b.internalId].rendererParams['topaxis']={fn:'topAxisRenderer',group:a};i.results.push(b)},processRecordTabular:function(f){var c=this,b=f['group'],g=!1,a=b.record,h=c.getMatrix().leftAxis.dimensions.items,i=h.length,e,d;c.storeInfo[a.internalId]={leftKey:b.key,rowStyle:'',rowClasses:[],rowEvent:c.itemRowEvent,rendererParams:{}};for(e=0;e<i;e++){d=h[e];if(d.id==b.dimension.id){g=!0}else {a.data[d.id]=null}c.storeInfo[a.internalId].rendererParams[d.id]={fn:'recordTabularRenderer',group:b,hidden:!g}}c.storeInfo[a.internalId].rendererParams['topaxis']={fn:'topAxisRenderer',group:b};f.results.push(a)},doExpandCollapse:function(e,d){var b=this,c=b.getGrid(),a;a=b.getMatrix().leftAxis.findTreeElement('key',e);if(!a){return}b.doExpandCollapseInternal(a.node,d);c.fireEvent((a.node.expanded?'pivotgroupexpand':'pivotgroupcollapse'),c,'row',a.node)},doExpandCollapseInternal:function(b,h){var f=this,a=f.getStore(),g=Ext.isClassic,e,c,d;b.expanded=!b.expanded;c=f.processGroup({group:b,previousExpanded:!1});b.expanded=!b.expanded;e=f.processGroup({group:b,previousExpanded:!1});if(e.length&&c.length&&(d=a.indexOf(c[0]))!==-1){a.suspendEvents();if(b.expanded){a.remove(a.getAt(d));a.insert(d,e)}else {a.remove(c);a.insert(d,e)}f.removeStoreInfoData(c);a.resumeEvents();if(g){a.fireEvent('replace',a,d,c,e)}else {a.fireEvent('refresh',a)}}},removeStoreInfoData:function(c){var d=c.length,b,a;for(a=0;a<d;a++){b=c[a];if(this.storeInfo[b.internalId]){delete this.storeInfo[b.internalId]}}},onGroupExpand:function(c,b,a){if(b=='row'){if(a){this.doExpandCollapseInternal(a,a.records.collapsed)}else {this.processStore()}}},onGroupCollapse:function(c,b,a){if(b=='row'){if(a){this.doExpandCollapseInternal(a,a.records.expanded)}else {this.processStore()}}}});Ext.define('Ext.pivot.result.Base',{alias:'pivotresult.base',mixins:['Ext.mixin.Factoryable'],leftKey:'',topKey:'',dirty:!1,values:null,matrix:null,constructor:function(b){var a=this;Ext.apply(a,b||{});a.values={};return a.callParent(arguments)},destroy:function(){var a=this;a.matrix=a.values=null;a.leftAxisItem=a.topAxisItem=null;return a.callParent(arguments)},calculate:Ext.emptyFn,calculateByFn:Ext.emptyFn,addValue:function(a,b){this.values[a]=b},getValue:function(a){return this.values[a]},hasValue:function(a){return (a in this.values)},getLeftAxisItem:function(){return this.matrix.leftAxis.items.getByKey(this.leftKey)},getTopAxisItem:function(){return this.matrix.topAxis.items.getByKey(this.topKey)}});Ext.define('Ext.pivot.result.Collection',{alternateClassName:['Mz.aggregate.matrix.Results'],requires:['Ext.pivot.MixedCollection','Ext.pivot.result.Base'],resultType:'base',items:null,matrix:null,constructor:function(b){var a=this;Ext.apply(a,b||{});a.items=new Ext.pivot.MixedCollection();a.items.getKey=function(a){return a.leftKey+'/'+a.topKey};return a.callParent(arguments)},destroy:function(){var a=this;Ext.destroy(a.items);a.matrix=a.items=null;a.callParent(arguments)},clear:function(){this.items.clear()},add:function(b,c){var a=this.get(b,c);if(!a){a=this.items.add(Ext.Factory.pivotresult({type:this.resultType,leftKey:b,topKey:c,matrix:this.matrix}))}return a},get:function(a,b){return this.items.getByKey(a+'/'+b)},remove:function(a,b){this.items.removeAtKey(a+'/'+b)},getByLeftKey:function(a){var b=this.items.filterBy(function(d,c){var b=String(c).split('/');return (a==b[0])});return b.getRange()},getByTopKey:function(a){var b=this.items.filterBy(function(d,c){var b=String(c).split('/');return (b.length>1&&a==b[1])});return b.getRange()},calculate:function(){var b=this.items.getCount(),a;for(a=0;a<b;a++){this.items.getAt(a).calculate()}}});Ext.define('Ext.pivot.matrix.Base',{alternateClassName:['Mz.aggregate.matrix.Abstract'],extend:'Ext.util.Observable',alias:'pivotmatrix.base',mixins:['Ext.mixin.Factoryable'],requires:['Ext.util.DelayedTask','Ext.data.ArrayStore','Ext.XTemplate','Ext.pivot.Aggregators','Ext.pivot.MixedCollection','Ext.pivot.axis.Base','Ext.pivot.dimension.Item','Ext.pivot.result.Collection'],resultType:'base',leftAxisType:'base',topAxisType:'base',textRowLabels:'Row labels',textTotalTpl:'Total ({name})',textGrandTotalTpl:'Grand total',keysSeparator:'#_#',grandTotalKey:'grandtotal',compactViewKey:'_compactview_',compactViewColumnWidth:200,viewLayoutType:'outline',rowSubTotalsPosition:'first',rowGrandTotalsPosition:'last',colSubTotalsPosition:'last',colGrandTotalsPosition:'last',showZeroAsBlank:!1,calculateAsExcel:!1,leftAxis:null,topAxis:null,aggregate:null,results:null,pivotStore:null,isDestroyed:!1,cmp:null,useNaturalSorting:!1,collapsibleRows:!0,collapsibleColumns:!0,isPivotMatrix:!0,serializeProperties:['viewLayoutType','rowSubTotalsPosition','rowGrandTotalsPosition','colSubTotalsPosition','colGrandTotalsPosition','showZeroAsBlank','collapsibleRows','collapsibleColumns'],constructor:function(a){var b=this.callParent(arguments);this.initialize(!0,a);return b},destroy:function(){var a=this;a.delayedTask.cancel();a.delayedTask=null;if(Ext.isFunction(a.onDestroy)){a.onDestroy()}Ext.destroy(a.results,a.leftAxis,a.topAxis,a.aggregate,a.pivotStore);a.results=a.leftAxis=a.topAxis=a.aggregate=a.pivotStore=null;if(Ext.isArray(a.columns)){a.columns.length=0}if(Ext.isArray(a.model)){a.model.length=0}if(Ext.isArray(a.totals)){a.totals.length=0}a.columns=a.model=a.totals=a.keysMap=a.cmp=a.modelInfo=null;a.isDestroyed=!0;a.callParent(arguments)},getKey:function(b){var a=this;a.keysMap=a.keysMap||{};if(!Ext.isDefined(a.keysMap[b])){a.keysMap[b]=Ext.id()}return a.keysMap[b]},naturalSort:(function(){var d=/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[\da-fA-F]+$|\d+)/g,a=/^\s+|\s+$/g,e=/\s+/g,f=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,g=/^0/,b=function(b,c){b=b||'';return (!b.match(g)||c==1)&&parseFloat(b)||b.replace(e,' ').replace(a,'')||0};return function(m,n){var o=String(m instanceof Date?m.getTime():(m||'')).replace(a,''),i=String(n instanceof Date?n.getTime():(n||'')).replace(a,''),k=o.replace(d,'\x00$1\x00').replace(/\0$/,'').replace(/^\0/,'').split('\x00'),r=i.replace(d,'\x00$1\x00').replace(/\0$/,'').replace(/^\0/,'').split('\x00'),j=parseInt(o.match(c),16)||(k.length!==1&&Date.parse(o)),l=parseInt(i.match(c),16)||j&&i.match(f)&&Date.parse(i)||null,e,g;if(l){if(j<l){return -1}else if(j>l){return 1}}for(var h=0,p=k.length,q=r.length,s=Math.max(p,q);h<s;h++){e=b(k[h],p);g=b(r[h],q);if(isNaN(e)!==isNaN(g)){return (isNaN(e))?1:-1}else if(typeof e!==typeof g){e+='';g+=''}if(e<g){return -1}if(e>g){return 1}}return 0}}()),initialize:function(d,b){var a=this,e=a.serializeProperties,c;b=b||{};a.initResults();if(d||b.aggregate){a.initAggregates(b.aggregate||[])}if(d||b.leftAxis){a.initLeftAxis(b.leftAxis||[])}if(d||b.topAxis){a.initTopAxis(b.topAxis||[])}for(c=0;c<e.length;c++){if(Ext.isDefined(b[e[c]])){a[e[c]]=b[e[c]]}}a.totals=[];a.modelInfo={};a.keysMap=null;if(!d){if(!a.collapsibleRows){a.leftAxis.expandAll()}if(!a.collapsibleColumns){a.topAxis.expandAll()}}if(d){a.pivotStore=new Ext.data.ArrayStore({autoDestroy:!1,fields:[]});a.delayedTask=new Ext.util.DelayedTask(a.startProcess,a);if(Ext.isFunction(a.onInitialize)){a.onInitialize()}}a.delayedTask.delay(5)},onInitialize:Ext.emptyFn,onDestroy:Ext.emptyFn,reconfigure:function(c){var a=this,b=Ext.clone(c||{});if(a.fireEvent('beforereconfigure',a,b)!==!1){if(Ext.isFunction(a.onReconfigure)){a.onReconfigure(b)}a.fireEvent('reconfigure',a,b);a.initialize(!1,b);a.clearData()}else {a.delayedTask.cancel()}},onReconfigure:Ext.emptyFn,serialize:function(){var a=this,e=a.serializeProperties,f=e.length,b={},c,d;for(c=0;c<f;c++){d=e[c];b[d]=a[d]}b.leftAxis=a.serializeDimensions(a.leftAxis.dimensions);b.topAxis=a.serializeDimensions(a.topAxis.dimensions);b.aggregate=a.serializeDimensions(a.aggregate);return b},serializeDimensions:function(b){var d=b.getCount(),c=[],a;for(a=0;a<d;a++){c.push(b.getAt(a).serialize())}return c},initResults:function(){Ext.destroy(this.results);this.results=new Ext.pivot.result.Collection({resultType:this.resultType,matrix:this})},initAggregates:function(b){var c=this,d,a;Ext.destroy(c.aggregate);c.aggregate=new Ext.pivot.MixedCollection();c.aggregate.getKey=function(a){return a.getId()};if(Ext.isEmpty(b)){return}b=Ext.Array.from(b);for(d=0;d<b.length;d++){a=b[d];if(!a.isInstance){Ext.applyIf(a,{isAggregate:!0,align:'right',showZeroAsBlank:c.showZeroAsBlank});a=new Ext.pivot.dimension.Item(a)}a.matrix=this;c.aggregate.add(a)}},initLeftAxis:function(b){var a=this;b=Ext.Array.from(b||[]);Ext.destroy(a.leftAxis);a.leftAxis=Ext.Factory.pivotaxis({type:a.leftAxisType,matrix:a,dimensions:b,isLeftAxis:!0})},initTopAxis:function(b){var a=this;b=Ext.Array.from(b||[]);Ext.destroy(a.topAxis);a.topAxis=Ext.Factory.pivotaxis({type:a.topAxisType,matrix:a,dimensions:b,isLeftAxis:!1})},clearData:function(){var a=this;a.fireEvent('cleardata',a);a.leftAxis.clear();a.topAxis.clear();a.results.clear();if(Ext.isArray(a.columns)){a.columns.length=0}if(Ext.isArray(a.model)){a.model.length=0}a.totals=[];a.modelInfo={};a.keysMap=null;if(a.pivotStore){a.pivotStore.removeAll(!0)}},startProcess:Ext.emptyFn,endProcess:function(){var a=this;a.leftAxis.getTree();a.topAxis.getTree();a.buildModelAndColumns();a.buildPivotStore();if(Ext.isFunction(a.onBuildStore)){a.onBuildStore(a.pivotStore)}a.fireEvent('storebuilt',a,a.pivotStore);a.fireEvent('done',a)},onBuildModel:Ext.emptyFn,onBuildColumns:Ext.emptyFn,onBuildRecord:Ext.emptyFn,onBuildTotals:Ext.emptyFn,onBuildStore:Ext.emptyFn,buildModelAndColumns:function(){var a=this;a.model=[{name:'id',type:'string'},{name:'isRowGroupHeader',type:'boolean',defaultValue:!1},{name:'isRowGroupTotal',type:'boolean',defaultValue:!1},{name:'isRowGrandTotal',type:'boolean',defaultValue:!1},{name:'leftAxisKey',type:'string',defaultValue:null}];a.internalCounter=0;a.columns=[];if(a.viewLayoutType=='compact'){a.generateCompactLeftAxis()}else {a.leftAxis.dimensions.each(a.parseLeftAxisDimension,a)}if(a.colGrandTotalsPosition=='first'){a.columns.push(a.parseAggregateForColumn(null,{text:a.textGrandTotalTpl,grandTotal:!0}))}Ext.Array.each(a.topAxis.getTree(),a.parseTopAxisItem,a);if(a.colGrandTotalsPosition=='last'){a.columns.push(a.parseAggregateForColumn(null,{text:a.textGrandTotalTpl,grandTotal:!0}))}if(Ext.isFunction(a.onBuildModel)){a.onBuildModel(a.model)}a.fireEvent('modelbuilt',a,a.model);if(Ext.isFunction(a.onBuildColumns)){a.onBuildColumns(a.columns)}a.fireEvent('columnsbuilt',a,a.columns)},getDefaultFieldInfo:function(a){return Ext.apply({isColGroupTotal:!1,isColGrandTotal:!1,leftAxisColumn:!1,topAxisColumn:!1,topAxisKey:null},a)},parseLeftAxisDimension:function(a){var b=this,c=a.getId();b.model.push({name:c,type:'auto'});b.columns.push(Ext.merge({dataIndex:c,text:a.header,dimension:a,leftAxis:!0},a.column));b.modelInfo[c]=b.getDefaultFieldInfo({leftAxisColumn:!0})},generateCompactLeftAxis:function(){var a=this;a.model.push({name:a.compactViewKey,type:'auto'});a.columns.push({dataIndex:a.compactViewKey,text:a.textRowLabels,leftAxis:!0,width:a.compactViewColumnWidth});a.modelInfo[a.compactViewKey]=a.getDefaultFieldInfo({leftAxisColumn:!0})},parseTopAxisItem:function(a){var b=this,d=[],e=[],h,c,i,g,f;if(!a.children){d=b.parseAggregateForColumn(a,null);if(a.level===0){b.columns.push(d)}else {return d}}else {if(b.colSubTotalsPosition=='first'){c=b.addColSummary(a);if(c){e.push(c)}}i=a.children.length;for(g=0;g<i;g++){f=b.parseTopAxisItem(a.children[g]);if(Ext.isArray(f)){Ext.Array.insert(d,d.length,f)}else {d.push(f)}}h={text:a.name,group:a,columns:d,key:a.key,xexpandable:!0,xgrouped:!0};if(a.level===0){b.columns.push(h)}e.push(h);if(b.colSubTotalsPosition=='last'){c=b.addColSummary(a);if(c){e.push(c)}}if(b.colSubTotalsPosition=='none'){c=b.addColSummary(a);if(c){e.push(c)}}return e}},addColSummary:function(a){var c=this,b,d=!1;b=c.parseAggregateForColumn(a,{text:a.expanded?a.getTextTotal():a.name,group:a,subTotal:!0});if(a.level===0){c.columns.push(b)}Ext.apply(b,{key:a.key,xexpandable:!0,xgrouped:!0});return b},parseAggregateForColumn:function(c,b){var a=this,e=[],d={},h=a.aggregate.getRange(),i=h.length,g,f;for(g=0;g<i;g++){f=h[g];a.internalCounter++;a.model.push({name:'c'+a.internalCounter,type:'auto',defaultValue:undefined,useNull:!0,col:c?c.key:a.grandTotalKey,agg:f.getId()});e.push(Ext.merge({dataIndex:'c'+a.internalCounter,text:f.header,topAxis:!0,subTotal:(b?b.subTotal===!0:!1),grandTotal:(b?b.grandTotal===!0:!1),dimension:f},f.column));a.modelInfo['c'+a.internalCounter]=a.getDefaultFieldInfo({isColGroupTotal:(b?b.subTotal===!0:!1),isColGrandTotal:(b?b.grandTotal===!0:!1),topAxisColumn:!0,topAxisKey:c?c.key:a.grandTotalKey})}if(e.length==0&&a.aggregate.getCount()==0){a.internalCounter++;d=Ext.apply({text:c?c.name:'',dataIndex:'c'+a.internalCounter},b||{})}else if(e.length==1){d=Ext.applyIf({text:c?c.name:''},e[0]);Ext.apply(d,b||{});if(b&&b.grandTotal&&a.aggregate.getCount()==1){d.text=a.aggregate.getAt(0).header||b.text}}else {d=Ext.apply({text:c?c.name:'',columns:e},b||{})}return d},buildPivotStore:function(){var a=this;if(Ext.isFunction(a.pivotStore.model.setFields)){a.pivotStore.model.setFields(a.model)}else {a.pivotStore.model.replaceFields(a.model,!0)}a.pivotStore.removeAll(!0);Ext.Array.each(a.leftAxis.getTree(),a.addRecordToPivotStore,a);a.addGrandTotalsToPivotStore()},addGrandTotalsToPivotStore:function(){var a=this,c=[],e,d,b;c.push({title:a.textGrandTotalTpl,values:a.preparePivotStoreRecordData({key:a.grandTotalKey},{isRowGrandTotal:!0})});if(Ext.isFunction(a.onBuildTotals)){a.onBuildTotals(c)}a.fireEvent('buildtotals',a,c);e=c.length;for(d=0;d<e;d++){b=c[d];if(Ext.isObject(b)&&Ext.isObject(b.values)){Ext.applyIf(b.values,{isRowGrandTotal:!0});a.totals.push({title:b.title||'',record:a.pivotStore.add(b.values)[0]})}}},addRecordToPivotStore:function(b){var a=this,c,d;if(!b.children){c=a.pivotStore.add(a.preparePivotStoreRecordData(b))[0];b.record=c;if(Ext.isFunction(a.onBuildRecord)){a.onBuildRecord(c,b)}a.fireEvent('recordbuilt',a,c,b)}else {b.records={};d=(a.viewLayoutType==='compact'?a.compactViewKey:b.dimensionId);b.records.collapsed=a.pivotStore.add(a.preparePivotStoreRecordData(b,{isRowGroupHeader:!0,isRowGroupTotal:!0}))[0];if(a.rowSubTotalsPosition==='first'&&a.viewLayoutType!=='tabular'){b.records.expanded=a.pivotStore.add(a.preparePivotStoreRecordData(b,{isRowGroupHeader:!0}))[0]}else {c={};c[d]=b.name;c.isRowGroupHeader=!0;b.records.expanded=a.pivotStore.add(c)[0];if(a.rowSubTotalsPosition==='last'||a.viewLayoutType==='tabular'){c=a.preparePivotStoreRecordData(b,{isRowGroupTotal:!0});c[d]=b.getTextTotal();b.records.footer=a.pivotStore.add(c)[0]}}Ext.Array.each(b.children,a.addRecordToPivotStore,a)}},preparePivotStoreRecordData:function(a,g){var d=this,c={},h=d.model.length,e,b,f;if(a){if(a.dimensionId){c[a.dimensionId]=a.name}c.leftAxisKey=a.key;for(e=0;e<h;e++){b=d.model[e];if(b.col&&b.agg){f=d.results.items.map[a.key+'/'+b.col];c[b.name]=f?f.values[b.agg]:null}}if(d.viewLayoutType==='compact'){c[d.compactViewKey]=a.name}}return Ext.applyIf(c,g)},getColumns:function(){return this.model},getColumnHeaders:function(){var a=this;if(!a.model){a.buildModelAndColumns()}return a.columns},isGroupRow:function(b){var a=this.leftAxis.findTreeElement('key',b);if(!a){return !1}return (a.node.children&&a.node.children.length==0)?0:a.level},isGroupCol:function(b){var a=this.topAxis.findTreeElement('key',b);if(!a){return !1}return (a.node.children&&a.node.children.length==0)?0:a.level},deprecated:{'6.0':{properties:{mztype:'type',mztypeLeftAxis:'leftAxisType',mztypeTopAxis:'topAxisType'}}}});Ext.define('Ext.pivot.result.Local',{extend:'Ext.pivot.result.Base',alias:'pivotresult.local',alternateClassName:['Mz.aggregate.matrix.Result'],records:null,constructor:function(a){this.records=[];return this.callParent(arguments)},destroy:function(){this.records.length=0;this.records=null;return this.callParent(arguments)},calculate:function(){var a=this,c,b,d=a.matrix.aggregate.getCount();for(c=0;c<d;c++){b=a.matrix.aggregate.getAt(c);a.addValue(b.getId(),Ext.callback(b.aggregatorFn,b.getScope()||'self.controller',[a.records,b.dataIndex,a.matrix,a.leftKey,a.topKey],0,a.matrix.cmp))}},calculateByFn:function(e,d,b){var a=this,c;if(Ext.isString(b)){b=Ext.pivot.Aggregators[b]}c=b(a.records,d,a.matrix,a.leftKey,a.topKey);a.addValue(e,c);return c},addRecord:function(a){this.records.push(a)},removeRecord:function(a){Ext.Array.remove(this.records,a)}});Ext.define('Ext.pivot.matrix.Local',{alternateClassName:['Mz.aggregate.matrix.Local'],extend:'Ext.pivot.matrix.Base',alias:'pivotmatrix.local',requires:['Ext.pivot.matrix.Base','Ext.pivot.axis.Local','Ext.pivot.result.Local'],isLocalMatrix:!0,resultType:'local',leftAxisType:'local',topAxisType:'local',store:null,recordsPerJob:1000,timeBetweenJobs:2,onInitialize:function(){var a=this;a.localDelayedTask=new Ext.util.DelayedTask(a.delayedProcess,a);a.storeCleanDelayedTask=new Ext.util.DelayedTask(a.onOriginalStoreCleanDelayed,a);a.storeChangedDelayedTask=new Ext.util.DelayedTask(a.onOriginalStoreChangedDelayed,a);a.initializeStore({store:a.store});a.callParent(arguments)},initializeStore:function(d){var a=this,b,c;a.processedRecords={};if(d.store){c=d.store}else {if(a.store){if(a.store.isStore&&!a.storeListeners){b=a.store}else {c=a.store}}}if(c){b=Ext.getStore(c||'');if(Ext.isEmpty(b)&&Ext.isString(c)){b=Ext.create(c)}}if(b&&b.isStore){Ext.destroy(a.storeListeners);if(a.store&&a.store.autoDestroy&&b!=a.store){Ext.destroy(a.store)}a.store=b;a.storeListeners=a.store.on({refresh:a.startProcess,beforeload:a.onOriginalStoreBeforeLoad,add:a.onOriginalStoreAdd,update:a.onOriginalStoreUpdate,remove:a.onOriginalStoreRemove,commit:a.onOriginalStoreClean,reject:a.onOriginalStoreClean,clear:a.startProcess,scope:a,destroyable:!0});if(b.isLoaded()){a.startProcess()}}},onReconfigure:function(a){this.initializeStore(a);this.callParent(arguments)},onDestroy:function(){var a=this;a.localDelayedTask.cancel();a.localDelayedTask=null;a.storeCleanDelayedTask.cancel();a.storeCleanDelayedTask=null;a.storeChangedDelayedTask.cancel();a.storeChangedDelayedTask=null;if(Ext.isArray(a.records)){a.records.length=0}a.records=a.changedRecords=null;Ext.destroy(a.storeListeners);if(a.store&&a.store.isStore&&a.store.autoDestroy){Ext.destroy(a.store)}a.store=a.storeListeners=a.processedRecords=null;a.callParent(arguments)},onOriginalStoreBeforeLoad:function(a){this.fireEvent('start',this)},createStoreChangesQueue:function(){var a=this;a.changedRecords=a.changedRecords||{};a.changedRecords.add=a.changedRecords.add||[];a.changedRecords.update=a.changedRecords.update||[];a.changedRecords.remove=a.changedRecords.remove||[]},dropStoreChangesQueue:function(){var a=this;if(a.changedRecords){a.changedRecords.add.length=0;a.changedRecords.update.length=0;a.changedRecords.remove.length=0}},onOriginalStoreAdd:function(c,b){var a=this;a.createStoreChangesQueue();Ext.Array.insert(a.changedRecords.add,a.changedRecords.add.length,b);a.storeChangedDelayedTask.delay(100)},onOriginalStoreUpdate:function(c,b){var a=this;a.createStoreChangesQueue();if(Ext.Array.indexOf(a.changedRecords.add,b)<0){Ext.Array.insert(a.changedRecords.update,a.changedRecords.update.length,[b])}a.storeChangedDelayedTask.delay(100)},onOriginalStoreRemove:function(g,c,f,d){var a=this,e=c.length,b;if(d){return}a.createStoreChangesQueue();for(b=0;b<e;b++){Ext.Array.remove(a.changedRecords.update,c[b]);Ext.Array.remove(a.changedRecords.add,c[b])}Ext.Array.insert(a.changedRecords.remove,a.changedRecords.remove.length,c);a.storeChangedDelayedTask.delay(100)},onOriginalStoreChangedDelayed:function(){var a=this,b=a.changedRecords;if(a.isDestroyed){return}a.storeChanged=!!(b.add.length||b.update.length||b.remove.length);if(a.storeChanged){a.onOriginalStoreAddDelayed();a.onOriginalStoreUpdateDelayed();a.onOriginalStoreRemoveDelayed()}},onOriginalStoreAddDelayed:function(){var c=this,g=[],f=!1,d,b,e,h,a;e=c.changedRecords.add;d=e.length;if(!d){return}for(b=0;b<d;b++){h=e[b];c.processRecord(h,b,d);a=c.processedRecords[h.internalId];f=f||a.left.length||a.top.length;if(a.left.length){Ext.Array.insert(g,g.length,a.left)}}e.length=0;if(f){c.leftAxis.rebuildTree();c.topAxis.rebuildTree()}d=g.length;if(d){for(b=0;b<d;b++){a=g[b];if((a.children&&!a.records)||(!a.children&&!a.record)){c.addRecordToPivotStore(a)}}}c.recalculateResults(c.store,e,f)},onOriginalStoreUpdateDelayed:function(){var a=this,i=[],h=!1,c,b,m,f,g,d,j,e,k,l;f=a.changedRecords.update;c=f.length;if(!c){return}for(b=0;b<c;b++){g=f[b];j=a.processedRecords[g.internalId];a.removeRecordFromResults(g);a.processRecord(g,b,c);e=a.processedRecords[g.internalId];if(j&&e){k=Ext.Array.equals(j.left,e.left);l=Ext.Array.equals(j.top,e.top);h=h||!k||!l;if(!k){Ext.Array.insert(i,i.length,e.left)}}}f.length=0;if(h){a.leftAxis.rebuildTree();a.topAxis.rebuildTree()}c=i.length;for(b=0;b<c;b++){d=i[b];if((d.children&&!d.records)||(!d.children&&!d.record)){a.addRecordToPivotStore(d)}}a.recalculateResults(a.store,f,h)},onOriginalStoreRemoveDelayed:function(){var a=this,e,d,b,c;b=a.changedRecords.remove;e=b.length;if(!e){return}for(d=0;d<e;d++){c=a.removeRecordFromResults(b[d])||c}b.length=0;if(c){a.leftAxis.rebuildTree();a.topAxis.rebuildTree()}a.recalculateResults(a.store,b,c)},onOriginalStoreClean:function(){var a=this;if(a.localDelayedTask.id){a.dropStoreChangesQueue();a.storeChanged=!1}else {a.storeCleanDelayedTask.delay(100)}},onOriginalStoreCleanDelayed:function(){var a=this,c,d,b;if(a.isDestroyed){return}c=a.pivotStore.getRange();d=c.length;for(b=0;b<d;b++){c[b].commit(!0)}a.storeChanged=!1;a.fireEvent('afterupdate',a,!1)},removeRecordFromResults:function(g){var b=this,c=b.processedRecords[g.internalId],e=b.grandTotalKey,i=!1,a,f,d,h,j,k;if(!c){return i}a=b.results.get(e,e);if(a){a.removeRecord(g);if(a.records.length===0){b.results.remove(e,e)}}j=c.top.length;for(d=0;d<j;d++){f=c.top[d];a=b.results.get(e,f.key);if(a){a.removeRecord(g);if(a.records.length===0){b.results.remove(e,f.key);b.topAxis.items.remove(f);i=!0}}}j=c.left.length;for(d=0;d<j;d++){f=c.left[d];a=b.results.get(f.key,e);if(a){a.removeRecord(g);if(a.records.length===0){b.results.remove(f.key,e);b.leftAxis.items.remove(f);i=!0}}k=c.top.length;for(h=0;h<k;h++){a=b.results.get(c.left[d].key,c.top[h].key);if(a){a.removeRecord(g);if(a.records.length===0){b.results.remove(c.left[d].key,c.top[h].key)}}}}return i},recalculateResults:function(d,c,b){var a=this;a.fireEvent('beforeupdate',a,b);a.buildModelAndColumns();a.results.calculate();Ext.Array.each(a.leftAxis.getTree(),a.updateRecordToPivotStore,a);a.updateGrandTotalsToPivotStore();a.fireEvent('afterupdate',a,b)},updateGrandTotalsToPivotStore:function(){var a=this,c=[],b;if(a.totals.length<=0){return}c.push({title:a.textGrandTotalTpl,values:a.preparePivotStoreRecordData({key:a.grandTotalKey})});if(Ext.isFunction(a.onBuildTotals)){a.onBuildTotals(c)}a.fireEvent('buildtotals',a,c);if(a.totals.length===c.length){for(b=0;b<a.totals.length;b++){if(Ext.isObject(c[b])&&Ext.isObject(c[b].values)&&(a.totals[b].record instanceof Ext.data.Model)){delete (c[b].values.id);a.totals[b].record.set(c[b].values)}}}},updateRecordToPivotStore:function(a){var c=this,d,b;if(!a.children){if(a.record){b=c.preparePivotStoreRecordData(a);delete (b['id']);a.record.set(b)}}else {if(a.records){d=(c.viewLayoutType==='compact'?c.compactViewKey:a.dimensionId);b=c.preparePivotStoreRecordData(a);delete (b['id']);delete (b[d]);a.records.collapsed.set(b);if(a.records.expanded){a.records.expanded.set(b)}if(a.records.footer){a.records.footer.set(b)}}Ext.Array.each(a.children,c.updateRecordToPivotStore,c)}},startProcess:function(){var a=this;if(!a.store||(a.store&&!a.store.isStore)||a.isDestroyed||a.store.isLoading()){return}a.dropStoreChangesQueue();a.clearData();a.localDelayedTask.delay(50)},delayedProcess:function(){var a=this;if(a.isDestroyed){return}a.fireEvent('start',a);a.records=a.store.getRange();if(a.records.length==0){a.endProcess();return}a.statusInProgress=!1;a.processRecords(0)},processRecords:function(d){var a=this,b=d,c;if(a.isDestroyed){return}c=a.records.length;a.statusInProgress=!0;while(b<c&&b<d+a.recordsPerJob&&a.statusInProgress){a.processRecord(a.records[b],b,c);b++}if(b>=c){a.statusInProgress=!1;a.results.calculate();a.leftAxis.buildTree();a.topAxis.buildTree();if(a.filterApplied){a.results.calculate()}a.records=null;a.endProcess();return}if(a.statusInProgress&&c>0){Ext.defer(a.processRecords,a.timeBetweenJobs,a,[b])}},processRecord:function(d,l,m){var a=this,f=a.grandTotalKey,g,e,c,h,j,k,i,b;a.processedRecords[d.internalId]=i={left:[],top:[]};g=a.leftAxis.processRecord(d);e=a.topAxis.processRecord(d);if(g&&e){a.results.add(f,f).addRecord(d);j=e.length;for(c=0;c<j;c++){b=e[c];a.topAxis.addItem(b);i.top.push(a.topAxis.items.map[b.key]);a.results.add(f,b.key).addRecord(d)}k=g.length;for(c=0;c<k;c++){b=g[c];a.leftAxis.addItem(b);i.left.push(a.leftAxis.items.map[b.key]);a.results.add(b.key,f).addRecord(d);for(h=0;h<j;h++){a.results.add(b.key,e[h].key).addRecord(d)}}}a.fireEvent('progress',a,l+1,m)},getRecordsByRowGroup:function(e){var c=this.results.getByLeftKey(e),d=c.length,b=[],a;for(a=0;a<d;a++){Ext.Array.insert(b,b.length,c[a].records||[])}return b},getRecordsByColGroup:function(e){var c=this.results.getByTopKey(e),d=c.length,b=[],a;for(a=0;a<d;a++){Ext.Array.insert(b,b.length,c[a].records||[])}return b},getRecordsByGroups:function(c,b){var a=this.results.get(c,b);return (a?a.records||[]:[])}});Ext.define('Ext.pivot.matrix.Remote',{alternateClassName:['Mz.aggregate.matrix.Remote'],extend:'Ext.pivot.matrix.Base',alias:'pivotmatrix.remote',isRemoteMatrix:!0,url:'',timeout:3000,onBeforeRequest:Ext.emptyFn,onRequestException:Ext.emptyFn,onInitialize:function(){var a=this;a.remoteDelayedTask=new Ext.util.DelayedTask(a.delayedProcess,a);a.callParent(arguments)},onDestroy:function(){this.remoteDelayedTask.cancel();this.remoteDelayedTask=null;this.callParent()},startProcess:function(){var a=this;if(Ext.isEmpty(a.url)){return}a.clearData();a.fireEvent('start',a);a.statusInProgress=!1;a.remoteDelayedTask.delay(5)},delayedProcess:function(){var a=this,d=a.serialize(),c,b;b={keysSeparator:a.keysSeparator,grandTotalKey:a.grandTotalKey,leftAxis:d.leftAxis,topAxis:d.topAxis,aggregate:d.aggregate};c=a.fireEvent('beforerequest',a,b);if(c!==!1){if(Ext.isFunction(a.onBeforeRequest)){c=a.onBeforeRequest(b)}}if(c===!1){a.endProcess()}else {Ext.Ajax.request({url:a.url,timeout:a.timeout,jsonData:b,callback:a.processRemoteResults,scope:a})}},processRemoteResults:function(k,i,g){var d=this,h=!i,f=Ext.JSON.decode(g.responseText,!0),c,b,e,a;if(i){h=(!f||!f['success'])}if(h){d.fireEvent('requestexception',d,g);if(Ext.isFunction(d.onRequestException)){d.onRequestException(g)}d.endProcess();return}c=Ext.Array.from(f.leftAxis||[]);e=c.length;for(a=0;a<e;a++){b=c[a];if(Ext.isObject(b)){d.leftAxis.addItem(b)}}c=Ext.Array.from(f.topAxis||[]);e=c.length;for(a=0;a<e;a++){b=c[a];if(Ext.isObject(b)){d.topAxis.addItem(b)}}c=Ext.Array.from(f.results||[]);e=c.length;for(a=0;a<e;a++){b=c[a];if(Ext.isObject(b)){var j=d.results.add(b.leftKey||'',b.topKey||'');Ext.Object.each(b.values||{},j.addValue,j)}}d.endProcess()}});Ext.define('Ext.pivot.plugin.Exporter',{alternateClassName:['Mz.pivot.plugin.ExcelExport'],alias:['plugin.pivotexporter','plugin.mzexcelexport'],extend:'Ext.exporter.Plugin',lockableScope:'top',init:function(a){var b=this;return b.callParent([a])},prepareData:function(i){var a=this,p,b,c,h,m,j,f,g,n,k,d,l,e,o;a.matrix=b=a.cmp.getMatrix();a.onlyExpandedNodes=(i&&i.onlyExpandedNodes);if(!a.onlyExpandedNodes){a.setColumnsExpanded(b.topAxis.getTree(),!0)}h=Ext.clone(b.getColumnHeaders());m=a.getColumnHeaders(h,i);d=a.getDataIndexColumns(h);if(!a.onlyExpandedNodes){a.setColumnsExpanded(b.topAxis.getTree())}c={columns:m,groups:[]};a.extractGroups(c,b.leftAxis.getTree(),d);k=b.totals.length;n=d.length;if(k){c.summaries=[];for(f=0;f<k;f++){j=b.totals[f];l={cells:[{value:j.title}]};for(g=1;g<n;g++){e=j.record.data[d[g].dataIndex];l.cells.push({value:(e==null||e===0)&&b.showZeroAsBlank?'':e})}c.summaries.push(l)}}a.matrix=a.onlyExpandedNodes=null;return new Ext.exporter.data.Table(c)},setColumnsExpanded:function(b,c){for(var a=0;a<b.length;a++){if(Ext.isDefined(c)){b[a].backupExpanded=b[a].expanded;b[a].expanded=c}else {b[a].expanded=b[a].backupExpanded;b[a].backupExpanded=null}if(b[a].children){this.setColumnsExpanded(b[a].children,c)}}},getColumnHeaders:function(e,f){var g=[],h=e.length,c,b,a,d;for(c=0;c<h;c++){a=e[c];d=this.onlyExpandedNodes?(!a.group||a.group.expanded||(!a.group.expanded&&a.subTotal)):!0;if(d){b={text:(a.subTotal&&a.group&&a.group.expanded?a.group.getTextTotal():a.text)};if(a.columns){b.columns=this.getColumnHeaders(a.columns,f)}else {b.width=a.dimension?a.dimension.getWidth():a.width||100;b.style=a.dimension?this.getExportStyle(a.dimension.getExportStyle(),f):null}g.push(b)}}return g},getDataIndexColumns:function(e){var b=[],c,a,d;for(c=0;c<e.length;c++){a=e[c];d=this.onlyExpandedNodes?(!a.group||a.group.expanded||(!a.group.expanded&&a.subTotal)):!0;if(d){if(a.dataIndex){b.push({dataIndex:a.dataIndex,agg:a.dimension?a.dimension.getId():null})}else if(a.columns){Ext.Array.insert(b,b.length,this.getDataIndexColumns(a.columns))}}}return b},extractGroups:function(e,l,g){var i,c,n,m,j,a,h,f,k,b,d;n=l.length;for(i=0;i<n;i++){a=l[i];if(a.record){e.rows=e.rows||[];d=[];h={cells:d};for(c=0;c<g.length;c++){b=a.record.data[g[c].dataIndex];d.push({value:(b==null||b===0)&&this.matrix.showZeroAsBlank?'':b})}e.rows.push(h)}else if(a.children){e.groups=e.groups||[];f={text:a.name};j=this.onlyExpandedNodes?a.expanded:!0;if(j){this.extractGroups(f,a.children,g)}f.summaries=[];d=[{value:(j?a.getTextTotal():a.value)}];h={cells:d};k=(a.expanded?a.records.expanded:a.records.collapsed);m=g.length;for(c=1;c<m;c++){b=k.data[g[c].dataIndex];d.push({value:(b==null||b===0)&&this.matrix.showZeroAsBlank?'':b})}f.summaries.push(h);e.groups.push(f)}}}});Ext.define('Ext.pivot.plugin.configurator.FieldSettings',{$configStrict:!1,config:{cls:'',style:null,fixed:[],allowed:['leftAxis','topAxis','aggregate'],aggregators:['sum','avg','min','max','count','countNumbers','groupSumPercentage','groupCountPercentage','variance','varianceP','stdDev','stdDevP'],renderers:{},formatters:{}},isFieldSettings:!0,constructor:function(a){this.initConfig(a||{});return this.callParent(arguments)},getDefaultEmptyArray:function(b){var a=this['_'+b];if(!a){a=[];this['set'+Ext.String.capitalize(b)](a)}return a},applyArrayValues:function(c,a,b){if(a==null||(a&&Ext.isArray(a))){return a}if(a){if(!b){b=this['get'+Ext.String.capitalize(c)]()}Ext.Array.splice(b,0,b.length,a)}return b},getFixed:function(){return this.getDefaultEmptyArray('fixed')},applyFixed:function(a,b){return this.applyArrayValues('fixed',a,b)},getAllowed:function(){return this.getDefaultEmptyArray('allowed')},applyAllowed:function(a,b){return this.applyArrayValues('allowed',a,b)},getAggregators:function(){return this.getDefaultEmptyArray('aggregators')},applyAggregators:function(a,b){return this.applyArrayValues('aggregators',a,b)},isFixed:function(a){var b;if(!a){return !1}b=a.getFieldType();return Ext.Array.indexOf(this.getFixed(),b)>=0},isAllowed:function(b){var c=this.getFixed(),a;if(!b){return !1}a=b.getFieldType();if(c.length){return Ext.Array.indexOf(c,a)>=0}return (a==='all')||(Ext.Array.indexOf(this.getAllowed(),a)>=0)}});Ext.define('Ext.pivot.plugin.configurator.Field',{extend:'Ext.pivot.dimension.Item',requires:['Ext.pivot.plugin.configurator.FieldSettings'],config:{editor:null,settings:{}},isField:!0,clone:function(){return new Ext.pivot.plugin.configurator.Field(Ext.applyIf({id:Ext.id()},this.getInitialConfig()))},getConfiguration:function(b){var a=this.callParent([b]);if(a.settings){a.settings=a.settings.getConfig()}return a},updateAggregator:function(b,d){var a,c;this.callParent([b,d]);if(b){a=this.getSettings();c=a.getAggregators();if(c.length===0){Ext.Array.remove(a.getAllowed(),'aggregate')}else {Ext.Array.include(c,b)}}},getSettings:function(){var a=this.settings;if(!a){a=new Ext.pivot.plugin.configurator.FieldSettings({});this.setSettings(a)}return a},applySettings:function(a,b){if(a==null||(a&&a.isFieldSettings)){return a}if(a){if(!b){b=this.getSettings()}b.setConfig(a)}if(b){this.setAggregator(this.getAggregator())}return b},getFieldText:function(){var a=this.getHeader();if(this.isAggregate){a+=' ('+this.getAggText()+')'}return a},getAggText:function(c){var a=Ext.pivot.Aggregators,b=c||this.getAggregator();if(Ext.isFunction(b)){return a.customText}return a[b+'Text']||a.customText}});Ext.define('Ext.pivot.update.Base',{extend:'Ext.mixin.Observable',alias:'pivotupdate.base',mixins:['Ext.mixin.Factoryable'],config:{leftKey:null,topKey:null,matrix:null,dataIndex:null,value:null},destroy:function(){Ext.unasap(this.updateTimer);this.setMatrix(null);this.callParent()},getResult:function(){var a=this.getMatrix();return a?a.results.get(this.getLeftKey(),this.getTopKey()):null},update:function(){var a=this;Ext.unasap(a.updateTimer);return new Ext.Promise(function(d,b){var c=a.getResult();if(c){if(a.fireEvent('beforeupdate',a)!==!1){a.updateTimer=Ext.asap(a.onUpdate,a,[c,d,b])}else {b('Operation canceled!')}}else {b('No Result found!')}})},onUpdate:function(c,a,b){this.fireEvent('update',this);a(this)}});Ext.define('Ext.pivot.update.Increment',{extend:'Ext.pivot.update.Base',alias:'pivotupdate.increment',onUpdate:function(f,h,i){if(this.destroyed){return}var e=this.getDataIndex(),a=parseFloat(this.getValue()),c=f.records,g,b,d;if(isNaN(a)){a=null}if(c&&a){g=c.length;for(b=0;b<g;b++){d=c[b];d.set(e,d.get(e)+a)}}this.callParent([f,h,i])}});Ext.define('Ext.pivot.update.Overwrite',{extend:'Ext.pivot.update.Base',alias:'pivotupdate.overwrite',onUpdate:function(d,g,h){if(this.destroyed){return}var f=this.getDataIndex(),c=parseFloat(this.getValue()),b=d.records,e,a;if(isNaN(c)){c=null}if(b){e=b.length;for(a=0;a<e;a++){b[a].set(f,c)}}this.callParent([d,g,h])}});Ext.define('Ext.pivot.update.Percentage',{extend:'Ext.pivot.update.Base',alias:'pivotupdate.percentage',onUpdate:function(f,h,i){if(this.destroyed){return}var e=this.getDataIndex(),a=parseFloat(this.getValue()),c=f.records,g,b,d;if(isNaN(a)){a=null}if(c){g=c.length;for(b=0;b<g;b++){d=c[b];d.set(e,a===null?null:Math.floor(d.get(e)*a/100))}}this.callParent([f,h,i])}});Ext.define('Ext.pivot.update.Uniform',{extend:'Ext.pivot.update.Base',alias:'pivotupdate.uniform',onUpdate:function(e,h,i){if(this.destroyed){return}var g=this.getDataIndex(),d=e.records,a=parseFloat(this.getValue()),b,c,f;if(isNaN(a)){a=null}if(d){b=d.length;if(b>0){f=(a===null?null:(a/b));for(c=0;c<b;c++){d[c].set(g,f)}}}this.callParent([e,h,i])}});Ext.define('Ext.pivot.cell.Cell',{extend:'Ext.grid.cell.Cell',xtype:'pivotgridcell',config:{eventCell:!0,collapsible:null},outlineGroupHeaderCls:Ext.baseCSSPrefix+'pivot-grid-group-header-outline',outlineCellHiddenCls:Ext.baseCSSPrefix+'pivot-grid-outline-cell-hidden',outlineCellGroupExpandedCls:Ext.baseCSSPrefix+'pivot-grid-outline-cell-previous-expanded',compactGroupHeaderCls:Ext.baseCSSPrefix+'pivot-grid-group-header-compact',compactLayoutPadding:25,tabularGroupHeaderCls:Ext.baseCSSPrefix+'pivot-grid-group-header-tabular',encodeHtml:!1,onRender:function(){var a=this,b=a.dataIndex,d=a.getViewModel(),e=a.getRecord(),c;a.callParent();if(d&&b){c=a.row.getGrid().getMatrix();d.setData({column:c.modelInfo[b]||{},value:a.getValue(),record:e})}},handleEvent:function(n,p){var c=this,j=c.row,f=j.getGrid(),m=c.getRecord(),d={grid:f},g,h,o,i,k,e,l,a,b;if(!m){return}h=j.getEventName()||'';g=j.getRecordInfo(m);l=f.getMatrix();i=c.getColumn();a=g.rendererParams[i._dataIndex];if(!a){a=g.rendererParams['topaxis']}a=a?a.group:null;k=a?a.key:g.leftKey;Ext.apply(d,{cell:c,leftKey:k,leftItem:a,column:i});if(c.getEventCell()){h+='cell';e=f.getTopAxisKey(d.column);d.topKey=e;if(e){b=l.topAxis.findTreeElement('key',e);b=b?b.node:null;if(b){Ext.apply(d,{topItem:b,dimensionId:b.dimensionId})}}}o=f.fireEvent(h+n,d,p);if(o!==!1&&n=='tap'&&c.getCollapsible()){if(a.expanded){a.collapse()}else {a.expand()}}return !1},updateRecord:function(a,c){var b=this.getViewModel();this.callParent([a,c]);if(b){b.setData({value:this.getValue(),record:a})}}});Ext.define('Ext.pivot.cell.Group',{extend:'Ext.pivot.cell.Cell',xtype:'pivotgridgroupcell',config:{innerGroupStyle:null,innerGroupCls:null,userGroupStyle:null,userGroupCls:null},innerTemplate:[{reference:'iconElement',classList:[Ext.baseCSSPrefix+'pivot-grid-group-icon',Ext.baseCSSPrefix+'font-icon']},{reference:'groupElement',classList:[Ext.baseCSSPrefix+'pivot-grid-group-title']}],groupCls:Ext.baseCSSPrefix+'pivot-grid-group',groupHeaderCls:Ext.baseCSSPrefix+'pivot-grid-group-header',groupHeaderCollapsibleCls:Ext.baseCSSPrefix+'pivot-grid-group-header-collapsible',groupHeaderCollapsedCls:Ext.baseCSSPrefix+'pivot-grid-group-header-collapsed',updateCellCls:function(b,d){var a=this,c=typeof b=='string'?b.split(' '):Ext.Array.from(b);a.callParent([b,d]);a.setEventCell(c.indexOf(a.groupHeaderCls)<0);a.setCollapsible(c.indexOf(a.groupHeaderCollapsibleCls)>=0)},updateInnerGroupStyle:function(a){this.groupElement.applyStyles(a)},updateInnerGroupCls:function(b,a){this.groupElement.replaceCls(a,b)},updateUserGroupStyle:function(a){this.groupElement.applyStyles(a)},updateUserGroupCls:function(b,a){this.groupElement.replaceCls(a,b)},updateRawValue:function(a){var c=this.groupElement.dom,b=a==null?'':a;if(this.getEncodeHtml()){c.textContent=b}else {c.innerHTML=b}},updateRecord:function(e,d){var b=this,a=b.row.getRecordInfo(),c=b.dataIndex;if(a&&c){a=a.rendererParams[c];if(a&&b[a.fn]){b[a.fn](a,b.row.getGrid())}else {b.setCellCls('')}}b.callParent([e,d])},groupOutlineRenderer:function(c,e){var a=this,b='',d=c.group;if(e.getMatrix().viewLayoutType=='compact'){a.bodyElement.setStyle(e.isRTL()?'padding-right':'padding-left','0')}if(c.colspan>0){b+=a.groupHeaderCls+' '+a.outlineGroupHeaderCls;if(!c.subtotalRow){if(d&&d.children&&d.axis.matrix.collapsibleRows){b+=' '+a.groupHeaderCollapsibleCls;if(!c.group.expanded){b+=' '+a.groupHeaderCollapsedCls}}if(c.previousExpanded){b+=' '+a.outlineCellGroupExpandedCls}}a.setCellCls(b);a.setInnerGroupCls(a.groupCls);return}a.setCellCls(a.outlineCellHiddenCls)},recordOutlineRenderer:function(b,c){var a=this;if(b.hidden){a.setCellCls(a.outlineCellHiddenCls);return}a.setCellCls(a.groupHeaderCls)},groupCompactRenderer:function(c,e){var a=this,b='',d=c.group;a.bodyElement.setStyle(e.isRTL()?'padding-right':'padding-left',(a.compactLayoutPadding*d.level)+'px');b+=a.groupHeaderCls+' '+a.compactGroupHeaderCls;if(!c.subtotalRow){if(d&&d.children&&d.axis.matrix.collapsibleRows){b+=' '+a.groupHeaderCollapsibleCls;if(!c.group.expanded){b+=' '+a.groupHeaderCollapsedCls}}if(c.previousExpanded){b+=' '+a.outlineCellGroupExpandedCls}}a.setCellCls(b);a.setInnerGroupCls(a.groupCls)},recordCompactRenderer:function(b,c){var a=this;a.bodyElement.setStyle(c.isRTL()?'padding-right':'padding-left',(a.compactLayoutPadding*b.group.level)+'px');a.setCellCls(a.groupHeaderCls+' '+a.compactGroupHeaderCls)},groupTabularRenderer:function(d,e){var a=this,b='',c=d.group;b+=a.groupHeaderCls+' '+a.tabularGroupHeaderCls;if(!d.subtotalRow&&!d.hidden){if(c&&c.children&&c.axis.matrix.collapsibleRows){b+=' '+a.groupHeaderCollapsibleCls;if(!c.expanded){b+=' '+a.groupHeaderCollapsedCls}}}a.setCellCls(b);a.setInnerGroupCls(a.groupCls)},recordTabularRenderer:function(b){var a=this;if(b.hidden){a.setCellCls(a.outlineCellHiddenCls);return}a.setCellCls(a.groupHeaderCls)}});Ext.define('Ext.pivot.Row',{extend:'Ext.grid.Row',xtype:'pivotgridrow',requires:['Ext.pivot.cell.Group'],config:{recordInfo:null,rowCls:null,eventName:null},summaryDataCls:Ext.baseCSSPrefix+'pivot-summary-data',summaryRowCls:Ext.baseCSSPrefix+'pivot-grid-group-total',grandSummaryRowCls:Ext.baseCSSPrefix+'pivot-grid-grand-total',onRender:function(){this.callParent();var a=this.getViewModel();if(a){a.set('columns',this.getRefOwner().getMatrix().modelInfo)}},destroy:function(){this.setRecordInfo(null);this.callParent()},updateRecord:function(c,d){var a=this,b;if(a.destroying||a.destroyed){return}b=a.getRefOwner().getRecordInfo(c);a.setRecordInfo(b);if(b){a.setRowCls(b.rowClasses);a.setEventName(b.rowEvent)}a.callParent([c,d])}});Ext.define('Ext.pivot.Grid',{extend:'Ext.grid.Grid',xtype:'pivotgrid',requires:['Ext.LoadMask','Ext.pivot.Row','Ext.pivot.feature.PivotStore','Ext.pivot.matrix.Local','Ext.pivot.matrix.Remote','Ext.data.ArrayStore'],isPivotGrid:!0,isPivotComponent:!0,enableLoadMask:!0,enableColumnSort:!0,startRowGroupsCollapsed:!0,startColGroupsCollapsed:!0,cellSelector:'.'+Ext.baseCSSPrefix+'gridcell',clsGroupTotal:Ext.baseCSSPrefix+'pivot-grid-group-total',clsGrandTotal:Ext.baseCSSPrefix+'pivot-grid-grand-total',groupHeaderCollapsedCls:Ext.baseCSSPrefix+'pivot-grid-group-header-collapsed',groupHeaderCollapsibleCls:Ext.baseCSSPrefix+'pivot-grid-group-header-collapsible',summaryDataCls:Ext.baseCSSPrefix+'pivot-summary-data',groupCls:Ext.baseCSSPrefix+'pivot-grid-group',relayedMatrixEvents:['beforereconfigure','reconfigure','start','progress','done','modelbuilt','columnsbuilt','recordbuilt','buildtotals','storebuilt','groupexpand','groupcollapse','beforerequest','requestexception'],config:{matrix:{type:'local'},leftAxisCellConfig:{xtype:'pivotgridgroupcell'},topAxisCellConfig:{xtype:'pivotgridcell'}},variableHeights:!0,itemConfig:{xtype:'pivotgridrow'},classCLs:Ext.baseCSSPrefix+'pivot-grid',initialize:function(){var a=this;a.setColumns([]);a.setStore(new Ext.data.ArrayStore({$internal:!0,fields:[]}));a.pivotDataSource=new Ext.pivot.feature.PivotStore({store:a.getStore(),grid:a,matrix:a.getMatrix(),clsGrandTotal:a.clsGrandTotal,clsGroupTotal:a.clsGroupTotal,summaryDataCls:a.summaryDataCls});a.getHeaderContainer().on({columntap:'handleColumnTap',headergrouptap:'handleHeaderGroupTap',scope:a});return a.callParent()},destroy:function(){var a=this;Ext.destroy(a.matrixRelayedListeners,a.matrixListeners,a.headerCtListeners,a.lockedHeaderCtListeners);Ext.destroy(a.pivotDataSource);a.matrixRelayedListeners=a.matrixListeners=a.headerCtListeners=a.lockedHeaderCtListeners=null;a.setMatrix(null);a.callParent();a.lastColumnSorted=a.store=Ext.destroy(a.store)},applyMatrix:function(a,b){Ext.destroy(b);if(a==null){return a}if(a&&a.isPivotMatrix){a.cmp=this;return a}Ext.applyIf(a,{type:'local'});a.cmp=this;return Ext.Factory.pivotmatrix(a)},updateMatrix:function(b,c){var a=this;Ext.destroy(c,a.matrixListeners,a.matrixRelayedListeners);if(b){a.matrixListeners=b.on({cleardata:a.onMatrixClearData,start:a.onMatrixProcessStart,progress:a.onMatrixProcessProgress,done:a.onMatrixDataReady,afterupdate:a.onMatrixAfterUpdate,groupexpand:a.onMatrixGroupExpandCollapse,groupcollapse:a.onMatrixGroupExpandCollapse,scope:a,destroyable:!0});a.matrixRelayedListeners=a.relayEvents(b,a.relayedMatrixEvents,'pivot');if(a.pivotDataSource){a.pivotDataSource.setMatrix(b)}}},refreshView:function(){var a=this;if(a.destroyed||a.destroying){return}a.getStore().fireEvent('pivotstoreremodel',a)},updateHeaderContainerColumns:function(e){var b=this,h=[],a,j,c,g,d,f,i;if(e){d=b.getColumnForGroup(b.getHeaderContainer().innerItems,e);if(d.found){c=d.item.getParent();j=d.index;i=c.items.length;for(f=0;f<i;f++){g=c.items.getAt(f);if(g.group==e){h.push(g)}}c.remove(h);a=Ext.clone(b.pivotColumns);b.preparePivotColumns(a);a=b.getVisiblePivotColumns(b.prepareVisiblePivotColumns(a),e);c.insert(j,a)}}else {a=Ext.clone(b.pivotColumns);b.preparePivotColumns(a);a=b.prepareVisiblePivotColumns(a);b.setColumns(a)}},getColumnForGroup:function(e,d){var f=e.length,a={found:!1,index:-1,item:null},c,b;for(c=0;c<f;c++){b=e[c];if(b.group==d){a.found=!0;a.index=c;a.item=b}else if(b.innerItems){a=this.getColumnForGroup(b.innerItems,d)}if(a.found){break}}return a},onMatrixClearData:function(){var a=this;a.getStore().removeAll(!0);a.setColumns([]);if(!a.expandedItemsState){a.lastColumnsState=null}a.sortedColumn=null},onMatrixProcessStart:function(){if(this.enableLoadMask){this.setMasked({xtype:'loadmask',indicator:!0})}},onMatrixProcessProgress:function(d,c,b){var a=((c||0.1)*100)/(b||0.1);if(this.enableLoadMask){this.getMasked().setMessage(Ext.util.Format.number(a,'0')+'%')}},onMatrixDataReady:function(a){this.refreshMatrixData(a,!1)},onMatrixAfterUpdate:function(b,a){if(a){this.refreshMatrixData(b,!0)}else {this.refreshView()}},onMatrixGroupExpandCollapse:function(c,b,a){if(b=='col'){this.updateHeaderContainerColumns(a)}},refreshMatrixData:function(b,k){var a=this,c=b.getColumnHeaders(),g=!1,h=a.getTopAxisCellConfig(),i=b.leftAxis.items.items,j=b.topAxis.items.items,d,f,e;if(a.enableLoadMask){a.setMasked(!1)}if(h){h.zeroValue=b.showZeroAsBlank?'':'0'}if(!k){if(a.expandedItemsState){f=i.length;for(d=0;d<f;d++){e=i[d];if(Ext.Array.indexOf(a.expandedItemsState['rows'],e.key)>=0){e.expanded=!0;g=!0}}f=j.length;for(d=0;d<f;d++){e=j[d];if(Ext.Array.indexOf(a.expandedItemsState['cols'],e.key)>=0){e.expanded=!0;g=!0}}if(g){c=b.getColumnHeaders();delete a.expandedItemsState}}else {if(b.collapsibleRows){a.doExpandCollapseTree(b.leftAxis.getTree(),!a.startRowGroupsCollapsed)}if(b.collapsibleColumns){a.doExpandCollapseTree(b.topAxis.getTree(),!a.startColGroupsCollapsed);c=b.getColumnHeaders()}}}a.pivotColumns=Ext.clone(c);c=Ext.clone(a.pivotColumns);a.preparePivotColumns(c);a.restorePivotColumnsState(c);c=a.prepareVisiblePivotColumns(c);a.setColumns(c);if(!Ext.isEmpty(a.sortedColumn)){b.leftAxis.sortTreeByField(a.sortedColumn.dataIndex,a.sortedColumn.direction)}a.getStore().fireEvent('pivotstoreremodel',a);if(!Ext.isEmpty(a.sortedColumn)){a.updateColumnSortState(a.sortedColumn.dataIndex,a.sortedColumn.direction)}a.lastColumnSorted=null},getVisiblePivotColumns:function(d,e){var b=[],f=d.length,c,a;for(c=0;c<f;c++){a=d[c];if(a.group==e){b.push(a)}if(a.columns){b=Ext.Array.merge(b,this.getVisiblePivotColumns(a.columns,e))}}return b},prepareVisiblePivotColumns:function(c){var e=c.length,d=[],b,a,f;for(b=0;b<e;b++){a=c[b];if(!a.hidden){d.push(a)}if(a.columns){a.columns=this.prepareVisiblePivotColumns(a.columns)}}return d},preparePivotColumns:function(d){var b=this,e={menuDisabled:!0,sortable:!1,lockable:!1},f=d?d.length:0,c,a;for(c=0;c<f;c++){a=d[c];a.cls=a.cls||'';Ext.apply(a,e);if(a.leftAxis){if(a.cell){Ext.applyIf(a.cell,Ext.clone(b.getLeftAxisCellConfig()))}else {Ext.apply(a,{cell:Ext.clone(b.getLeftAxisCellConfig())})}}else if(a.topAxis){if(a.cell){Ext.applyIf(a.cell,Ext.clone(b.getTopAxisCellConfig()))}else {Ext.apply(a,{cell:Ext.clone(b.getTopAxisCellConfig())})}}if(a.subTotal){a.cls=b.clsGroupTotal}if(a.group&&a.xgrouped){if(a.group.expanded){if(!a.subTotal&&this._matrix.collapsibleColumns){a.cls+=(Ext.isEmpty(a.cls)?'':' ')+b.groupHeaderCollapsibleCls}}else {if(a.subTotal&&this._matrix.collapsibleColumns){a.cls+=(Ext.isEmpty(a.cls)?'':' ')+b.groupHeaderCollapsibleCls+' '+b.groupHeaderCollapsedCls}}if(a.subTotal){a.text=a.group.expanded?a.group.getTextTotal():Ext.String.format('<div class="'+Ext.baseCSSPrefix+'pivot-grid-group-icon '+Ext.baseCSSPrefix+'font-icon"></div>'+'<div class="'+this.groupCls+'">{0}</div>',a.group.name)}else if(a.group){a.text=Ext.String.format('<div class="'+Ext.baseCSSPrefix+'pivot-grid-group-icon '+Ext.baseCSSPrefix+'font-icon"></div>'+'<div class="'+this.groupCls+'">{0}</div>',a.group.name)}a.xexpandable=a.subTotal?!a.group.expanded:a.group.expanded;if((!a.group.expanded&&!a.subTotal)||(a.group.expanded&&a.subTotal&&this.getMatrix().colSubTotalsPosition=='none')){a.hidden=!0}}if(a.grandTotal){a.cls=b.clsGrandTotal}if(Ext.isEmpty(a.columns)){if(a.dimension){Ext.apply(a,{renderer:a.dimension?a.dimension.getRenderer():!1,formatter:a.dimension?a.dimension.getFormatter():!1,scope:a.dimension?a.dimension.scope:null,align:a.dimension.align});if(a.dimension.flex>0){a.flex=a.flex||a.dimension.flex}else {a.width=a.width||a.dimension.width}a.cell=Ext.merge(a.cell,a.dimension.cellConfig)}if(a.cell&&a.cell.bind&&!a.cell.viewModel){a.cell.bind=b.processBindKey(a.cell.bind,a.dataIndex)}}else {b.preparePivotColumns(a.columns)}}},processBindKey:function(a,d){var b,e,f,c,g;if(Ext.isString(a)){g=a.replace('{column','{columns.'+d);return g.replace('{value','{record.'+d)}else if(Ext.isObject(a)){b=Ext.Object.getAllKeys(a)}else if(Ext.isArray(a)){b=a}if(b){f=b.length;for(c=0;c<f;c++){e=b[c];a[e]=this.processBindKey(a[e],d)}}return a},reconfigurePivot:function(a){var b=this.getMatrix();a=a||{};if(b){if(a.type&&b.type!==a.type){this.setMatrix(a)}else {b.reconfigure(a)}}else {this.setMatrix(a)}},doExpandCollapseTree:function(b,c){var a;for(a=0;a<b.length;a++){b[a].expanded=c;if(b[a].children){this.doExpandCollapseTree(b[a].children,c)}}},doExpandCollapse:function(f,e,b,d){var c=this.getMatrix(),a;if(!c){return}a=(f=='row'?c.leftAxis:c.topAxis)['findTreeElement']('key',e);if(!a){return}a=a.node;b=Ext.isDefined(b)?b:!a.expanded;if(b){a.expand(d)}else {a.collapse(d)}},expandRow:function(b,a){this.doExpandCollapse('row',b,!0,a)},collapseRow:function(b,a){this.doExpandCollapse('row',b,!1,a)},expandCol:function(b,a){this.doExpandCollapse('col',b,!0,a)},collapseCol:function(b,a){this.doExpandCollapse('col',b,!1,a)},expandAll:function(){this.expandAllColumns();this.expandAllRows()},expandAllRows:function(){this.getMatrix().leftAxis.expandAll()},expandAllColumns:function(){this.getMatrix().topAxis.expandAll()},collapseAll:function(){this.collapseAllRows();this.collapseAllColumns()},collapseAllRows:function(){this.getMatrix().leftAxis.collapseAll()},collapseAllColumns:function(){this.getMatrix().topAxis.collapseAll()},setStore:function(a){var b;if(!a||(a&&a.$internal)){this.callParent([a])}else {b=this.getMatrix();if(b&&b instanceof Ext.pivot.matrix.Local){b.reconfigure({store:a})}}},getTopAxisKey:function(c){var f=this,e=f.getMatrix(),b=e.getColumns(),d=null,a;if(!c){return null}for(a=0;a<b.length;a++){if(b[a].name===c.getDataIndex()){d=b[a].col;break}}return d},getTopAxisItem:function(a){return this.getMatrix().topAxis.items.getByKey(this.getTopAxisKey(a))},getLeftAxisItem:function(b){var a;if(!b){return null}a=this.pivotDataSource.storeInfo[b.internalId];return a?this.getMatrix().leftAxis.items.getByKey(a.leftKey):null},getStateProperties:function(){return ['viewLayoutType','rowSubTotalsPosition','rowGrandTotalsPosition','colSubTotalsPosition','colGrandTotalsPosition','aggregate','leftAxis','topAxis','enableColumnSort','sortedColumn']},getPivotColumnsState:function(){var c=this,a,b;if(!c.lastColumnsState){b=c.getDataIndexColumns(c.getMatrix().getColumnHeaders());c.lastColumnsState={};for(a=0;a<b.length;a++){if(b[a].dataIndex){c.lastColumnsState[b[a].dataIndex]={width:b[a].width,flex:b[a].flex||0}}}}b=c.getColumns();for(a=0;a<b.length;a++){if(b[a].dataIndex){c.lastColumnsState[b[a].dataIndex]={width:b[a].rendered?b[a].getWidth():b[a].width,flex:b[a].flex||0}}}return c.lastColumnsState},getDataIndexColumns:function(b){var c=[],a;for(a=0;a<b.length;a++){if(b[a].dataIndex){c.push(b[a].dataIndex)}else if(Ext.isArray(b[a].columns)){c=Ext.Array.merge(c,this.getDataIndexColumns(b[a].columns))}}return c},restorePivotColumnsState:function(a){this.parsePivotColumnsState(this.getPivotColumnsState(),a)},parsePivotColumnsState:function(d,b){var c,a;if(!b){return}for(a=0;a<b.length;a++){c=d[b[a].dataIndex];if(c){if(c.flex){b[a].flex=c.flex}else if(c.width){b[a].width=c.width}}this.parsePivotColumnsState(d,b[a].columns)}},onChildTap:function(a){this.handleRowEvent('tap',a.event);this.callParent([a])},onChildTapHold:function(a){this.handleRowEvent('taphold',a.event);this.callParent([a])},onChildSingleTap:function(a){this.handleRowEvent('singletap',a.event);this.callParent([a])},onChildDoubleTap:function(a){this.handleRowEvent('doubletap',a.event);this.callParent([a])},handleRowEvent:function(e,d){var a=Ext.fly(d.getTarget(this.cellSelector)),c=this.getNavigationModel(),b;if(a&&a.component&&a.component.handleEvent){a.component.handleEvent(e,d);if(c){b=c.getLocation();if(b){b.refresh()}}}},handleColumnTap:function(e,a,d){var c=this,b;if(a.xexpandable){this.handleHeaderGroupTap(e,a,d);return !1}if(!c.enableColumnSort){return}b=(a.$axisSortDirection==='ASC')?'DESC':'ASC';if((a.leftAxis||a.topAxis)&&!Ext.isEmpty(a.getDataIndex())){if(c.getMatrix().leftAxis.sortTreeByField(a.getDataIndex(),b)){a.$axisSortDirection=b;c.refreshView();c.updateSortIndicator(a,b);d.stopEvent()}}return !1},updateSortIndicator:function(b,c){var a=this.lastColumnSorted;if(a){a.setSortState(null);if(b.topAxis&&a.leftAxis){a.$axisSortDirection=null}}b.setSortState(c);this.lastColumnSorted=b},handleHeaderGroupTap:function(c,a,b){if(a.xexpandable&&this._matrix.collapsibleColumns){b.stopEvent();this.doExpandCollapse('col',a.key)}return !1},isRTL:function(){if(Ext.isFunction(this.isLocalRtl)){return this.isLocalRtl()}return !1},getRecordInfo:function(a){return a?this.pivotDataSource.storeInfo[a.internalId]:null},onColumnRemove:function(b,a){if(a===this.lastColumnSorted){this.lastColumnSorted=null}return this.callParent([b,a])},privates:{discardMeasureRow:!0}});Ext.define('Ext.pivot.plugin.configurator.Column',{extend:'Ext.dataview.ListItem',requires:['Ext.pivot.plugin.configurator.Field'],alias:'widget.pivotconfigfield',userCls:Ext.baseCSSPrefix+'pivot-grid-config-column',filteredCls:Ext.baseCSSPrefix+'pivot-grid-config-column-filter',ascSortIconCls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn-sort-asc',descSortIconCls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn-sort-desc',config:{deleteCmp:{xtype:'component',cls:[Ext.baseCSSPrefix+'pivot-grid-config-column-btn',Ext.baseCSSPrefix+'pivot-grid-config-column-btn-delete'],docked:'right',hidden:!0},moveCmp:{xtype:'component',cls:[Ext.baseCSSPrefix+'pivot-grid-config-column-btn',Ext.baseCSSPrefix+'pivot-grid-config-column-btn-move'],docked:'left'},sortCmp:{xtype:'component',cls:Ext.baseCSSPrefix+'pivot-grid-config-column-btn',docked:'right',hidden:!0}},applyDeleteCmp:function(a,b){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,b)}return a},updateDeleteCmp:function(a,b){if(a){this.add(a)}Ext.destroy(b)},applyMoveCmp:function(a,b){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,b)}return a},updateMoveCmp:function(a,b){if(a){this.add(a)}Ext.destroy(b)},applySortCmp:function(a,b){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,b)}return a},updateSortCmp:function(a,b){if(a){this.add(a)}Ext.destroy(b)},getField:function(){return this.getRecord().get('field')},updateRecord:function(d,c){var b=this,f=b.innerElement,a,e;this.callParent([d,c]);if(!d){return}if(c){e=c.get('field');if(e){a=c.get('field').getSettings();b.resetStyle(f,a.getStyle());b.removeCls(a.getCls())}}e=d.get('field');if(e){a=d.get('field').getSettings();f.setStyle(a.getStyle());b.addCls(a.getCls());b.refreshData()}},refreshData:function(){var a=this,i=a.getDeleteCmp(),e=a.getRecord(),f=e.get('field'),h=f.getSettings(),b=a.dataview||a.getDataview(),c=b.getFieldType?b:b.up('pivotconfigcontainer'),g=c.getFieldType(),d;if(g!=='all'){d=h.isFixed(c);i.setHidden(d)}e.set('text',f.getFieldText());a.updateSortCmpCls();a.updateFilterCls()},updateFilterCls:function(){var a=this,b=a.dataview||a.getDataview(),c=b.getFieldType?b:b.up('pivotconfigcontainer'),d=c.getFieldType();if(d!=='all'){if(a.getField().getFilter()){a.addCls(a.filteredCls)}else {a.removeCls(a.filteredCls)}}},updateSortCmpCls:function(){var a=this,c=a.dataview||a.getDataview(),f=c.getFieldType?c:c.up('pivotconfigcontainer'),d=f.getFieldType(),e=a.getField(),b=a.getSortCmp();if(d==='leftAxis'||d==='topAxis'){b.show();b.setUserCls('');if(e.getSortable()){if(e.getDirection()==='ASC'){b.setUserCls(a.ascSortIconCls)}else {b.setUserCls(a.descSortIconCls)}}}else {b.hide()}},resetStyle:function(e,d){var b={},c=Ext.Object.getAllKeys(d),f=c.length,a;for(a=0;a<f;a++){b[c[a]]=null}e.setStyle(b)},onApplyFilterSettings:function(b,a){this.getField().setFilter(a);this.updateFilterCls();this.applyChanges()},onRemoveFilter:function(){this.getField().setFilter(null);this.updateFilterCls();this.applyChanges()},applyChanges:function(){var a=this.dataview||this.getDataView();if(a){a.applyChanges()}}});Ext.define('Ext.pivot.plugin.configurator.DragZone',{extend:'Ext.drag.Source',requires:['Ext.drag.proxy.Placeholder'],groups:'pivotfields',proxy:{type:'placeholder',cursorOffset:[-20,30],placeholderCls:Ext.baseCSSPrefix+'pivot-drag-proxy-placeholder',validCls:Ext.baseCSSPrefix+'pivot-drag-proxy-placeholder-valid',invalidCls:Ext.baseCSSPrefix+'pivot-drag-proxy-placeholder-invalid'},handle:'.'+Ext.baseCSSPrefix+'listitem',platformConfig:{phone:{activateOnLongPress:!0}},constructor:function(a){var b=a.getList();this.panel=a;this.list=b;this.callParent([{element:b.getScrollable().getElement()}])},onDragStart:function(b){var c=Ext.fly(b.eventTarget).up(this.getHandle()),d='<span class="x-pivot-drag-placeholder-icon">&nbsp;</span><span>{0}</span>',a;if(!c||!c.component){return}a=c.component.getRecord();b.setData('record',a);b.setData('sourceList',this.list);this.getProxy().setHtml(Ext.String.format(d,a.get('text')))}});Ext.define('Ext.pivot.plugin.configurator.DropZone',{extend:'Ext.drag.Target',groups:'pivotfields',leftIndicatorCls:Ext.baseCSSPrefix+'pivot-grid-left-indicator',rightIndicatorCls:Ext.baseCSSPrefix+'pivot-grid-right-indicator',listItemSelector:'.'+Ext.baseCSSPrefix+'listitem',listSelector:'.'+Ext.baseCSSPrefix+'list',constructor:function(a){var b=a.getList();this.panel=a;this.list=b;this.callParent([{element:b.getScrollable().getElement()}])},getLeftIndicator:function(){if(!this.leftIndicator){this.self.prototype.leftIndicator=Ext.getBody().createChild({cls:this.leftIndicatorCls,html:"&#160;"});this.self.prototype.indicatorWidth=this.leftIndicator.dom.offsetWidth;this.self.prototype.indicatorOffset=Math.round(this.indicatorWidth/2)}return this.leftIndicator},getRightIndicator:function(){if(!this.rightIndicator){this.self.prototype.rightIndicator=Ext.getBody().createChild({cls:this.rightIndicatorCls,html:"&#160;"})}return this.rightIndicator},accepts:function(f){var c=f.data,d=c.record,a=c.sourceList,b=this.panel,e=b.up('pivotconfigpanel');if(!d){return !0}if(!a.isXType('pivotconfigcontainer')){a=a.up('pivotconfigcontainer')}return d.get('field').getSettings().isAllowed(b)&&e.isAllowed(a,b,c.record)},onDragMove:function(a){if(a.valid){this.positionIndicator(a)}else {this.hideIndicators()}},onDragLeave:function(a){this.hideIndicators()},onDrop:function(e){var b=e.data,a=b.sourceList,c=this.panel,d=c.up('pivotconfigpanel');this.hideIndicators();if(!d){return}if(!a.isXType('pivotconfigcontainer')){a=a.up('pivotconfigcontainer')}d.dragDropField(a,c,b.record,b.position)},positionIndicator:function(n){var b=this,i=-1,k=b.getLeftIndicator(),j=b.getRightIndicator(),m=b.indicatorWidth,q=b.indicatorOffset,a,e,d,c,f,o,g,p,h,l;a=b.getCursorElement(n,b.listItemSelector);if(a){e=a.component;h='tl';l='tr';i=e.$dataIndex}else {h='bl';l='br';i=b.list.getViewItems().length;e=b.list.getItemAt(i-1);if(e){a=e.element}else {a=b.getCursorElement(n,b.listSelector)}}d=k.getAlignToXY(a,h);c=j.getAlignToXY(a,l);d[0]-=1;c[0]-=m;if(h==='tl'){d[1]-=m;c[1]-=m}f=g=-q;f+=a.getX();o=f+a.getWidth();g+=a.getY();p=g+a.getHeight();d[0]=Ext.Number.constrain(d[0],f,o);c[0]=Ext.Number.constrain(c[0],f,o);d[1]=Ext.Number.constrain(d[1],g,p);c[1]=Ext.Number.constrain(c[1],g,p);k.show();j.show();k.setXY(d);j.setXY(c);n.setData('position',i)},hideIndicators:function(){this.getLeftIndicator().hide();this.getRightIndicator().hide()},getCursorElement:function(f,c,e,b){var a=f.cursor.current,d=Ext.drag.Manager.elementFromPoint(a.x,a.y);return Ext.fly(d).up(c,e,b)}});Ext.define('Ext.pivot.plugin.configurator.Container',{extend:'Ext.Panel',alias:'widget.pivotconfigcontainer',requires:['Ext.pivot.plugin.configurator.Column','Ext.pivot.plugin.configurator.DragZone','Ext.pivot.plugin.configurator.DropZone','Ext.dataview.List'],config:{fieldType:'all',emptyText:null,store:{type:'array',fields:[{name:'text',type:'string'},{name:'field',type:'auto'}]},list:{xclass:'Ext.dataview.List',handleSorting:!1,handleFiltering:!1,isConfiguratorContainer:!0,disableSelection:!0,itemConfig:{xtype:'pivotconfigfield'},deferEmptyText:!1,touchAction:{panX:!1,pinchZoom:!1,doubleTapZoom:!1},itemRipple:!1}},layout:'fit',initialize:function(){var a=this,b=a.getList();a.callParent();a.dragZone=new Ext.pivot.plugin.configurator.DragZone(a);a.dropZone=new Ext.pivot.plugin.configurator.DropZone(a);if(a.getFieldType()!=='all'){b.element.on({delegate:'.'+Ext.baseCSSPrefix+'pivot-grid-config-column-btn',tap:a.handleColumnBtnTap,scope:a});b.element.on({delegate:'.'+Ext.baseCSSPrefix+'listitem-body-el',tap:a.handleColumnTap,scope:a})}},destroy:function(){Ext.destroyMembers(this,'storeListeners','dragZone','dropZone');this.callParent()},updateFieldType:function(a){if(a!=='all'){this.setUserCls(Ext.baseCSSPrefix+'pivot-grid-config-container')}},updateEmptyText:function(b){var a=this.getList();if(a){a.setEmptyText(b)}},applyList:function(a,c){var b;if(a){b=this.getStore();if(a.isComponent){a.setStore(b)}else {a.store=b;a.emptyText=this.getEmptyText();a=Ext.factory(a,Ext.dataview.List,c)}}return a},updateList:function(a){if(a){this.add(a)}},applyStore:function(a){return Ext.Factory.store(a)},updateStore:function(b,c){var a=this;Ext.destroy(a.storeListeners);if(b){a.storeListeners=b.on({datachanged:a.applyChanges,scope:a})}},applyChanges:function(){if(this.getFieldType()!=='all'){this.fireEvent('configchange',this)}},addField:function(a,d){var e=this,c=e.getStore(),f=e.getFieldType(),b={};a.isAggregate=(f==='aggregate');Ext.apply(b,{field:a,text:a.getFieldText()});if(d>=0){c.insert(d,b)}else {c.add(b)}},removeField:function(a){this.getStore().remove(a);a.set('field',null)},moveField:function(b,c){var a=this.getStore(),d=a.indexOf(b);if(c===-1&&d===a.getCount()-1){return}a.remove(b);if(c>=0){a.insert(c,b)}else {a.add(b)}},handleColumnBtnTap:function(e){var a=this,b=Ext.fly(e.currentTarget),c=b.up('.'+a.getList().baseCls+'item').component,d=c.getRecord();if(!d){return}if(b.hasCls(Ext.baseCSSPrefix+'pivot-grid-config-column-btn-delete')){a.fireEvent('removefield',a,c,d);return}if(b.hasCls(Ext.baseCSSPrefix+'pivot-grid-config-column-btn-tools')){a.fireEvent('toolsbtnpressed',a,c)}},handleColumnTap:function(e){var a=this,d=Ext.fly(e.currentTarget),b=d.up('.'+a.getList().baseCls+'item').component,c=b.getRecord();if(!c){return}a.fireEvent('toolsbtnpressed',a,b)}});Ext.define('Ext.pivot.plugin.configurator.PanelController',{extend:'Ext.app.ViewController',alias:'controller.pivotconfigpanel',destroy:function(){var a=this;a.pivotListeners=a.matrixProperties=Ext.destroy(a.pivotListeners);a.callParent()},closeMe:function(){var a=this.getView();a.fireEvent('close',a)},cancelConfiguration:function(){this.refreshDimensions();this.matrixProperties=null;this.closeMe()},applyConfiguration:function(){this.applyChanges().then(function(a){a.closeMe()})},showSettings:function(){var b=this.getView(),d=b.getPivot(),a=d.getMatrix().serialize(),c=b.down('#settings');delete (a.leftAxis);delete (a.topAxis);delete (a.aggregate);if(d.fireEvent('beforeshowpivotsettings',b,{container:c,settings:a})!==!1){b.setActiveItem(c);c.setMatrixProperties(a);d.fireEvent('showpivotsettings',b,{container:c,settings:a})}},backToMainView:function(){this.getView().setActiveItem('#main')},onPivotChanged:function(c,b){var a=this;Ext.destroy(a.pivotListeners);if(b){a.pivotListeners=b.getMatrix().on({done:a.onPivotDone,scope:a,destroyable:!0})}},onFieldsChanged:function(b,a){if(!a){return}this.refreshDimensions()},onBeforeApplyPivotSettings:function(c,b){var a=this.getView();return a.getPivot().fireEvent('beforeapplypivotsettings',a,{container:c,settings:b})},onApplyPivotSettings:function(c,a){var b=this.getView();this.matrixProperties=a;this.onConfigChanged();return b.getPivot().fireEvent('applypivotsettings',b,{container:c,settings:a})},onBeforeApplyConfigFieldSettings:function(c,b){var a=this.getView();return a.getPivot().fireEvent('beforeapplyconfigfieldsettings',a,{container:c,settings:b})},onApplyConfigFieldSettings:function(c,b){var a=this.getView();this.onConfigChanged();return a.getPivot().fireEvent('applyconfigfieldsettings',a,{container:c,settings:b})},onConfigChanged:function(){this.configurationChanged=!0},showCard:function(k,i){var b=this.getView(),h=b.getPivot(),f=i.getField().getSettings(),a=b.down('#field'),g=[],e,d,c,j;if(h.fireEvent('beforeshowconfigfieldsettings',b,{container:a,settings:f})!==!1){b.setActiveItem(a);a.setFieldItem(i);e=this.getAggregateContainer().getStore();j=e.getCount();for(c=0;c<j;c++){d=e.getAt(c).get('field');g.push([d.getHeader(),d.getId()])}a.getViewModel().getStore('sDimensions').loadData(g);h.fireEvent('showconfigfieldsettings',b,{container:a,settings:f})}},onRemoveField:function(b,d,c){var a=this.getView();a.dragDropField(b,a.getAllFieldsContainer(),c)},refreshDimensions:function(){var a=this,l=a.getView(),k=l.getPivot(),b=k?k.getMatrix():null,f,c,d,e,i,g,h,j;if(!b){return}a.internalReconfiguration=!0;e=a.getAllFieldsContainer();f=a.getTopAxisContainer();c=a.getLeftAxisContainer();d=a.getAggregateContainer();e.getStore().removeAll();f.getStore().removeAll();c.getStore().removeAll();d.getStore().removeAll();j=l.getFields().clone();i=a.getConfigFields(b.topAxis.dimensions.getRange());g=a.getConfigFields(b.leftAxis.dimensions.getRange());h=a.getConfigFields(b.aggregate.getRange());a.addFieldsToConfigurator(j.getRange(),e);a.addFieldsToConfigurator(i,f);a.addFieldsToConfigurator(g,c);a.addFieldsToConfigurator(h,d);a.internalReconfiguration=!1},onPivotDone:function(){if(this.internalReconfiguration){this.internalReconfiguration=!1}else {this.refreshDimensions()}},reconfigurePivot:function(e,f){var a=this,d=a.getView(),c=d.getPivot(),b={topAxis:a.getFieldsFromContainer(a.getTopAxisContainer(),!0),leftAxis:a.getFieldsFromContainer(a.getLeftAxisContainer(),!0),aggregate:a.getFieldsFromContainer(a.getAggregateContainer(),!0)};Ext.apply(b,a.matrixProperties);a.internalReconfiguration=!0;if(c.fireEvent('beforeconfigchange',d,b)!==!1){c.getMatrix().reconfigure(b);c.fireEvent('configchange',d,b)}e(a)},getAllFieldsContainer:function(){return this.lookupReference('fieldsCt')},getLeftAxisContainer:function(){return this.lookupReference('fieldsLeftCt')},getTopAxisContainer:function(){return this.lookupReference('fieldsTopCt')},getAggregateContainer:function(){return this.lookupReference('fieldsAggCt')},applyChanges:function(){var a=this;return new Ext.Promise(function(b,c){var d=a.getView();if(a.configurationChanged){a.configurationChanged=!1;if(d.isHidden()||a.internalReconfiguration){c(a);return}Ext.asap(a.reconfigurePivot,a,[b,c])}else {b(a)}})},getFieldsFromContainer:function(g,e){var d=g.getStore(),f=d.getCount(),c=[],a,b;for(a=0;a<f;a++){b=d.getAt(a).get('field');c.push(e===!0?b.getConfiguration():b)}return c},addFieldsToConfigurator:function(c,b){var d=c.length,a;b.getStore().removeAll();for(a=0;a<d;a++){b.addField(c[a],-1)}b.getList().refresh()},getConfigFields:function(d){var g=d.length,f=this.getView().getFields(),e=[],b,a,c;for(b=0;b<g;b++){c=d[b];a=f.byDataIndex.get(c.dataIndex);if(a){a=a.clone();a.setConfig(c.getInitialConfig());e.push(a)}}return e}});Ext.define('Ext.pivot.plugin.configurator.model.Select',{extend:'Ext.data.Model',fields:[{name:'text',type:'string'},{name:'value',type:'auto'},{name:'type',type:'integer'}]});Ext.define('Ext.pivot.plugin.configurator.store.Select',{extend:'Ext.data.ArrayStore',alias:'store.pivotselect',model:'Ext.pivot.plugin.configurator.model.Select'});Ext.define('Ext.pivot.plugin.configurator.FormController',{extend:'Ext.app.ViewController',alias:'controller.pivotconfigform',init:function(a){var b=this.getViewModel();b.getStore('sSorters').loadData([[a.sortClearText,'none'],[a.sortAscText,'ASC'],[a.sortDescText,'DESC']]);b.getStore('sFilters').loadData([[a.clearFilterText,'none'],[a.labelFiltersText,'label'],[a.valueFiltersText,'value'],[a.top10FiltersText,'top10']]);b.getStore('sTopOrder').loadData([[a.topOrderTopText,'top'],[a.topOrderBottomText,'bottom']]);b.getStore('sTopType').loadData([[a.topTypeItemsText,'items'],[a.topTypePercentText,'percent'],[a.topTypeSumText,'sum']]);b.getStore('sAlign').loadData([[a.alignLeftText,'left'],[a.alignCenterText,'center'],[a.alignRightText,'right']]);b.set('labelFilterText',a.labelFilterText);b.set('valueFilterText',a.valueFilterText);b.set('requiredMessage',a.requiredFieldText)},applySettings:function(){var j=this.getViewModel(),e=this.getView(),g=e.getFieldItem(),h=g.getField(),b=Ext.clone(j.get('form')),d,i,c,a,f;if(!e.isValid()){return}if(b.align&&b.align.isModel){b.align=b.align.get('value')}if(h.isAggregate){if(b.formatter&&b.formatter.isModel){d=b.formatter}else {i=j.getStore('sFormatters');d=i.findRecord('value',b.formatter,0,!1,!0,!0)}if(d){if(d.get('type')==1){b.formatter=d.get('value');b.renderer=null}else {b.renderer=d.get('value');b.formatter=null}}if(b.aggregator&&b.aggregator.isModel){b.aggregator=b.aggregator.get('value')}}else {c=b.direction;if(c&&c.isModel){c=c.get('value')}b.sortable=(c!=='none');b.direction=c||'ASC';a=b.filter;f=a.type.isModel?a.type.get('value'):a.type;if(!a||!a.type||f==='none'){a=null}else {a.type=f;if(a.operator&&a.operator.isModel){a.operator=a.operator.get('value')}if(a.dimensionId&&a.dimensionId.isModel){a.dimensionId=a.dimensionId.get('value')}if(a.topType&&a.topType.isModel){a.topType=a.topType.get('value')}if(a.topOrder&&a.topOrder.isModel){a.topOrder=a.topOrder.get('value')}if(a.type==='top10'){a.type='value';a.operator='top10'}if(a.operator==='between'||a.operator==='not between'){a.value=[a.from,a.to]}delete (a.from);delete (a.to);if(a.type==='label'){delete (a.dimensionId);delete (a.topSort);delete (a.topType);delete (a.topOrder)}}b.filter=a}if(e.fireEvent('beforeapplyconfigfieldsettings',e,b)!==!1){h.setConfig(b);g.refreshData();e.fireEvent('applyconfigfieldsettings',e,b);this.cancelSettings()}},cancelSettings:function(){var a=this.getView();a.setFieldItem(null);a.fireEvent('close',a)},onFieldItemChanged:function(q,p){var i=this.getViewModel(),h={},l=[],o=[],g,j,m,n,k,f,b,d,c,a,e;if(!p){i.set('form',h);return}g=p.getField();c=g.getConfig();Ext.apply(h,{dataIndex:c.dataIndex,header:c.header});if(g.isAggregate){j=g.getSettings();m=j.getFormatters();n=j.getRenderers();k=j.getAggregators();f=k.length;for(b=0;b<f;b++){o.push([g.getAggText(k[b]),k[b]])}d=Ext.Object.getAllKeys(m||{});f=d.length;for(b=0;b<f;b++){l.push([d[b],m[d[b]],1])}d=Ext.Object.getAllKeys(n||{});f=d.length;for(b=0;b<f;b++){l.push([d[b],n[d[b]],2])}i.getStore('sFormatters').loadData(l);i.getStore('sAggregators').loadData(o);e=c.formatter;if(Ext.isFunction(e)){e=null}if(!e&&!Ext.isFunction(c.renderer)){e=c.renderer}Ext.apply(h,{formatter:e,aggregator:c.aggregator,align:c.align})}else {a=c.filter;Ext.apply(h,{direction:(c.sortable?c.direction:'none'),filter:{type:(a?(a.type==='value'&&a.operator==='top10'?'top10':a.type):'none'),operator:(a?(a.type==='value'&&a.operator==='top10'?'top10':a.operator):null),value:(a?a.value:null),from:(a?(Ext.isArray(a.value)?a.value[0]:null):null),to:(a?(Ext.isArray(a.value)?a.value[1]:null):null),caseSensitive:(a?a.caseSensitive:!1),topSort:(a?a.topSort:!1),topOrder:(a?a.topOrder:!1),topType:(a?a.topType:!1),dimensionId:(a?a.dimensionId:null)}})}i.set('form',h)},prepareOperators:function(d){var a=this.getView(),c=this.getViewModel(),b;b=[[a.equalsLText,'='],[a.doesNotEqualLText,'!='],[a.greaterThanLText,'>'],[a.greaterThanOrEqualToLText,'>='],[a.lessThanLText,'<'],[a.lessThanOrEqualToLText,'<='],[a.betweenLText,'between'],[a.notBetweenLText,'not between']];if(d==='label'){Ext.Array.insert(b,3,[[a.beginsWithLText,'begins'],[a.doesNotBeginWithLText,'not begins'],[a.endsWithLText,'ends'],[a.doesNotEndWithLText,'not ends'],[a.containsLText,'contains'],[a.doesNotContainLText,'not contains']])}c.getStore('sOperators').loadData(b)},onChangeFilterType:function(c,a){var b=a&&a.isModel?a.get('value'):a;if(b==='label'||b==='value'){this.prepareOperators(b)}}});Ext.define('Ext.pivot.plugin.configurator.Form',{extend:'Ext.form.Panel',requires:['Ext.pivot.plugin.configurator.store.Select','Ext.pivot.plugin.configurator.FormController','Ext.form.FieldSet','Ext.field.Toggle','Ext.field.Select','Ext.field.Radio','Ext.field.Text','Ext.field.Hidden','Ext.layout.VBox','Ext.layout.HBox','Ext.TitleBar'],xtype:'pivotconfigform',controller:'pivotconfigform',viewModel:{stores:{sFormatters:{type:'pivotselect'},sAggregators:{type:'pivotselect'},sSorters:{type:'pivotselect'},sFilters:{type:'pivotselect'},sOperators:{type:'pivotselect'},sTopOrder:{type:'pivotselect'},sTopType:{type:'pivotselect'},sDimensions:{type:'pivotselect'},sAlign:{type:'pivotselect'}},data:{requiredMessage:null,labelFilterText:null,valueFilterText:null},formulas:{filterType:{bind:{bindTo:'{form.filter.type}',deep:!0},get:function(a){return a&&a.isModel?a.get('value'):a}},filterOperator:{bind:{bindTo:'{form.filter.operator}',deep:!0},get:function(a){return a&&a.isModel?a.get('value'):a}},filterOperatorValue:{bind:'{filterCommon && !(filterOperator === "between" || filterOperator === "not between")}',get:function(a){return a}},filterOperatorBetween:{bind:'{filterCommon && (filterOperator === "between" || filterOperator === "not between")}',get:function(a){return a}},filterCommon:{bind:'{filterType === "label" || filterType === "value"}',get:function(a){return a}},filterLabel:{bind:'{filterType === "label"}',get:function(a){return a}},filterValue:{bind:'{filterType === "value"}',get:function(a){return a}},filterTop10:{bind:'{filterType === "top10"}',get:function(a){return a}}}},eventedConfig:{fieldItem:null,title:null},listeners:{fielditemchange:'onFieldItemChanged'},defaults:{xtype:'fieldset',defaults:{labelAlign:'top'}},showAnimation:{type:'slideIn',duration:250,easing:'ease-out',direction:'left'},hideAnimation:{type:'slideOut',duration:250,easing:'ease-in',direction:'right'},okText:'Ok',cancelText:'Cancel',formatText:'Format as',summarizeByText:'Summarize by',customNameText:'Custom name',sourceNameText:'The source name for this field is "{form.dataIndex}"',sortText:'Sort',filterText:'Filter',sortResultsText:'Sort results',alignText:'Align',alignLeftText:'Left',alignCenterText:'Center',alignRightText:'Right',caseSensitiveText:'Case sensitive',valueText:'Value',fromText:'From',toText:'To',labelFilterText:'Show items for which the label',valueFilterText:'Show items for which',top10FilterText:'Show',sortAscText:'Sort A to Z',sortDescText:'Sort Z to A',sortClearText:'Disable sorting',clearFilterText:'Disable filtering',labelFiltersText:'Label filters',valueFiltersText:'Value filters',top10FiltersText:'Top 10 filters',equalsLText:'equals',doesNotEqualLText:'does not equal',beginsWithLText:'begins with',doesNotBeginWithLText:'does not begin with',endsWithLText:'ends with',doesNotEndWithLText:'does not end with',containsLText:'contains',doesNotContainLText:'does not contain',greaterThanLText:'is greater than',greaterThanOrEqualToLText:'is greater than or equal to',lessThanLText:'is less than',lessThanOrEqualToLText:'is less than or equal to',betweenLText:'is between',notBetweenLText:'is not between',topOrderTopText:'Top',topOrderBottomText:'Bottom',topTypeItemsText:'Items',topTypePercentText:'Percent',topTypeSumText:'Sum',requiredFieldText:'This field is required',operatorText:'Operator',dimensionText:'Dimension',orderText:'Order',typeText:'Type',updateFieldItem:function(d){var a=this,b,c;a.removeAll(!0,!0);if(!d){return}c=d.getField();b=[{xtype:'titlebar',docked:'top',titleAlign:'left',bind:{title:'{form.header}'},items:[{text:a.cancelText,align:'right',ui:'alt',handler:'cancelSettings'},{text:a.okText,align:'right',ui:'alt',handler:'applySettings',margin:'0 0 0 5'}]},{bind:{instructions:a.sourceNameText},items:[{label:a.customNameText,xtype:'textfield',name:'header',required:!0,requiredMessage:a.requiredFieldText,bind:'{form.header}'}]}];if(c.isAggregate){b.push({items:[{label:a.alignText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'align',bind:{store:'{sAlign}',value:'{form.align}'}},{label:a.formatText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'formatter',bind:{store:'{sFormatters}',value:'{form.formatter}'}},{label:a.summarizeByText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'aggregator',bind:{store:'{sAggregators}',value:'{form.aggregator}'}}]})}else {b.push({xtype:'fieldset',items:[{label:a.sortText,labelAlign:'top',xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'sort',bind:{store:'{sSorters}',value:'{form.direction}'}},{label:a.filterText,labelAlign:'top',xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'filter',bind:{store:'{sFilters}',value:'{form.filter.type}'},listeners:{change:'onChangeFilterType'}}]},{defaults:{labelAlign:'top'},bind:{hidden:'{!filterCommon}',title:'{filterLabel ? labelFilterText : valueFilterText}'},items:[{xtype:'selectfield',autoSelect:!1,placeholder:a.dimensionText,name:'dimensionId',bind:{store:'{sDimensions}',value:'{form.filter.dimensionId}',hidden:'{!filterValue}',required:'{filterValue}',requiredMessage:'{filterValue ? requiredMessage : null}'}},{xtype:'selectfield',autoSelect:!1,placeholder:a.operatorText,name:'operator',bind:{store:'{sOperators}',value:'{form.filter.operator}',required:'{filterCommon}',requiredMessage:'{filterCommon ? requiredMessage : null}'}},{xtype:'textfield',placeholder:a.valueText,name:'value',bind:{value:'{form.filter.value}',hidden:'{filterOperatorBetween}',required:'{filterOperatorValue}',requiredMessage:'{filterOperatorValue ? requiredMessage : null}'}},{xtype:'textfield',placeholder:a.fromText,name:'from',bind:{value:'{form.filter.from}',hidden:'{filterOperatorValue}',required:'{filterOperatorBetween}',requiredMessage:'{filterOperatorBetween ? requiredMessage : null}'}},{xtype:'textfield',placeholder:a.toText,name:'to',bind:{value:'{form.filter.to}',hidden:'{filterOperatorValue}',required:'{filterOperatorBetween}',requiredMessage:'{filterOperatorBetween ? requiredMessage : null}'}},{xtype:'togglefield',label:a.caseSensitiveText,name:'caseSensitive',bind:'{form.filter.caseSensitive}'}]},{xtype:'fieldset',title:a.top10FilterText,defaults:{labelAlign:'top'},bind:{hidden:'{!filterTop10}'},items:[{xtype:'selectfield',autoSelect:!1,placeholder:a.orderText,name:'topOrder',bind:{store:'{sTopOrder}',value:'{form.filter.topOrder}',required:'{filterTop10}',requiredMessage:'{filterTop10 ? requiredMessage : null}'}},{xtype:'textfield',placeholder:a.valueText,name:'topValue',bind:{value:'{form.filter.value}',required:'{filterTop10}',requiredMessage:'{filterTop10 ? requiredMessage : null}'}},{xtype:'selectfield',autoSelect:!1,placeholder:a.typeText,name:'topType',bind:{store:'{sTopType}',value:'{form.filter.topType}',required:'{filterTop10}',requiredMessage:'{filterTop10 ? requiredMessage : null}'}},{xtype:'selectfield',autoSelect:!1,placeholder:a.dimensionText,name:'topDimensionId',bind:{store:'{sDimensions}',value:'{form.filter.dimensionId}',required:'{filterTop10}',requiredMessage:'{filterTop10 ? requiredMessage : null}'}},{xtype:'togglefield',label:a.sortResultsText,name:'topSort',bind:'{form.filter.topSort}'}]})}a.add(b)}});Ext.define('Ext.pivot.plugin.configurator.SettingsController',{extend:'Ext.app.ViewController',alias:'controller.pivotsettings',init:function(a){var b=this.getViewModel();b.getStore('sLayout').loadData([[a.outlineLayoutText,'outline'],[a.compactLayoutText,'compact'],[a.tabularLayoutText,'tabular']]);b.getStore('sPositions').loadData([[a.firstPositionText,'first'],[a.hidePositionText,'none'],[a.lastPositionText,'last']]);b.getStore('sYesNo').loadData([[a.yesText,!0],[a.noText,!1]])},applySettings:function(){var d=this.getViewModel(),c=this.getView(),a=Ext.clone(d.get('form')),b;for(b in a){if(a[b]&&a[b].isModel){a[b]=a[b].get('value')}}if(c.fireEvent('beforeapplypivotsettings',c,a)!==!1){c.fireEvent('applypivotsettings',c,a);this.cancelSettings()}},cancelSettings:function(){var a=this.getView();a.setMatrixProperties(null);a.fireEvent('close',a)},onMatrixPropertiesChanged:function(b,a){this.getViewModel().set('form',a)}});Ext.define('Ext.pivot.plugin.configurator.Settings',{extend:'Ext.form.Panel',requires:['Ext.pivot.plugin.configurator.store.Select','Ext.pivot.plugin.configurator.SettingsController','Ext.form.FieldSet','Ext.field.Select','Ext.layout.VBox','Ext.layout.HBox','Ext.TitleBar'],xtype:'pivotsettings',controller:'pivotsettings',viewModel:{stores:{sLayout:{type:'pivotselect'},sPositions:{type:'pivotselect'},sYesNo:{type:'pivotselect'}}},eventedConfig:{matrixProperties:null},listeners:{matrixpropertieschange:'onMatrixPropertiesChanged'},defaults:{xtype:'fieldset',defaults:{labelAlign:'top'}},showAnimation:{type:'slideIn',duration:250,easing:'ease-out',direction:'left'},hideAnimation:{type:'slideOut',duration:250,easing:'ease-in',direction:'right'},titleText:'Settings',okText:'Ok',cancelText:'Cancel',layoutText:'Layout',outlineLayoutText:'Outline',compactLayoutText:'Compact',tabularLayoutText:'Tabular',firstPositionText:'First',hidePositionText:'Hide',lastPositionText:'Last',rowSubTotalPositionText:'Row subtotal position',columnSubTotalPositionText:'Column subtotal position',rowTotalPositionText:'Row total position',columnTotalPositionText:'Column total position',showZeroAsBlankText:'Show zero as blank',yesText:'Yes',noText:'No',updateMatrixProperties:function(c){var a=this,b;a.removeAll(!0,!0);if(!c){return}b=[{xtype:'titlebar',docked:'top',titleAlign:'left',title:a.titleText,items:[{text:a.cancelText,align:'right',ui:'alt',handler:'cancelSettings'},{text:a.okText,align:'right',ui:'alt',handler:'applySettings',margin:'0 0 0 5'}]},{label:a.layoutText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'viewLayoutType',bind:{store:'{sLayout}',value:'{form.viewLayoutType}'}},{label:a.rowSubTotalPositionText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'rowSubTotalsPosition',bind:{store:'{sPositions}',value:'{form.rowSubTotalsPosition}'}},{label:a.columnSubTotalPositionText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'colSubTotalsPosition',bind:{store:'{sPositions}',value:'{form.colSubTotalsPosition}'}},{label:a.rowTotalPositionText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'rowGrandTotalsPosition',bind:{store:'{sPositions}',value:'{form.rowGrandTotalsPosition}'}},{label:a.columnTotalPositionText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'colGrandTotalsPosition',bind:{store:'{sPositions}',value:'{form.colGrandTotalsPosition}'}},{label:a.showZeroAsBlankText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,name:'showZeroAsBlank',bind:{store:'{sYesNo}',value:'{form.showZeroAsBlank}'}}];a.add(b)}});Ext.define('Ext.pivot.plugin.configurator.Panel',{extend:'Ext.Panel',requires:['Ext.pivot.plugin.configurator.Container','Ext.pivot.plugin.configurator.DragZone','Ext.pivot.plugin.configurator.DropZone','Ext.pivot.plugin.configurator.PanelController','Ext.pivot.plugin.configurator.Form','Ext.pivot.plugin.configurator.Settings','Ext.layout.HBox','Ext.layout.VBox','Ext.layout.Card','Ext.TitleBar','Ext.Promise'],alias:'widget.pivotconfigpanel',controller:'pivotconfigpanel',isPivotConfigPanel:!0,cls:Ext.baseCSSPrefix+'pivot-grid-config-panel',showAnimation:{type:'slideIn',duration:250,easing:'ease-out',direction:'left'},hideAnimation:{type:'slideOut',duration:250,easing:'ease-in',direction:'right'},panelTitle:'Configuration',panelAllFieldsText:'Drop Unused Fields Here',panelAllFieldsTitle:'All fields',panelTopFieldsText:'Drop Column Fields Here',panelTopFieldsTitle:'Column labels',panelLeftFieldsText:'Drop Row Fields Here',panelLeftFieldsTitle:'Row labels',panelAggFieldsText:'Drop Agg Fields Here',panelAggFieldsTitle:'Values',cancelText:'Cancel',okText:'Done',eventedConfig:{pivot:null,fields:null},listeners:{pivotchange:'onPivotChanged',fieldschange:'onFieldsChanged'},layout:'card',initialize:function(){this.setup();return this.callParent()},dragDropField:function(a,b,e,h){var f=this,m=f.getPivot(),d=e.get('field'),i=a.getFieldType(),g=b.getFieldType(),j=f.getController(),l=j.getTopAxisContainer(),k=j.getLeftAxisContainer(),c;if(m.fireEvent('beforemoveconfigfield',this,{fromContainer:a,toContainer:b,field:d})!==!1){if(a!=b){if(g==='all'){a.removeField(e)}else if(g==='aggregate'){b.addField(d,h);if(i!=='all'){a.removeField(e)}}else {c=f.findFieldInContainer(d,b);if(c){return}if(g==='leftAxis'){c=f.findFieldInContainer(d,l);a=c?l:a}else {c=f.findFieldInContainer(d,k);a=c?k:a}if(c){a.removeField(c);b.addField(d)}else {if(i==='aggregate'){a.removeField(e)}b.addField(d,h)}}}else {b.moveField(e,h)}}},isAllowed:function(b,a,f){var d=!0,g=f.get('field'),e=b&&b.getFieldType(),c=a&&a.getFieldType();if(e==='aggregate'&&(c==='leftAxis'||c==='topAxis')){d=!this.findFieldInContainer(g,a)}return d},findFieldInContainer:function(f,d){var c=d.getStore(),e=c.getCount(),a,b;for(a=0;a<e;a++){b=c.getAt(a);if(b.get('field').getDataIndex()==f.getDataIndex()){return b}}},setup:function(){var a=this,b={configchange:'onConfigChanged',toolsbtnpressed:'showCard',removefield:'onRemoveField'};a.add([{itemId:'main',xtype:'container',layout:{type:'hbox',align:'stretch'},defaults:{flex:1},items:[{xtype:'titlebar',docked:'top',title:a.panelTitle,titleAlign:'left',items:[{xtype:'tool',type:'gear',align:'right',handler:'showSettings'},{text:a.cancelText,align:'right',ui:'alt',handler:'cancelConfiguration'},{text:a.okText,align:'right',ui:'alt',handler:'applyConfiguration',margin:'0 0 0 5'}]},{reference:'fieldsCt',xtype:'pivotconfigcontainer',title:a.panelAllFieldsTitle,emptyText:a.panelAllFieldsText,fieldType:'all',listeners:b},{xtype:'container',layout:{type:'vbox',align:'stretch'},defaults:{xtype:'pivotconfigcontainer',flex:1},items:[{reference:'fieldsAggCt',title:a.panelAggFieldsTitle,emptyText:a.panelAggFieldsText,fieldType:'aggregate',listeners:b},{reference:'fieldsLeftCt',title:a.panelLeftFieldsTitle,emptyText:a.panelLeftFieldsText,fieldType:'leftAxis',listeners:b},{reference:'fieldsTopCt',title:a.panelTopFieldsTitle,emptyText:a.panelTopFieldsText,fieldType:'topAxis',listeners:b}]}]},{itemId:'field',xtype:'pivotconfigform',listeners:{close:'backToMainView',beforeapplyconfigfieldsettings:'onBeforeApplyConfigFieldSettings',applyconfigfieldsettings:'onApplyConfigFieldSettings'}},{itemId:'settings',xtype:'pivotsettings',listeners:{close:'backToMainView',beforeapplypivotsettings:'onBeforeApplyPivotSettings',applypivotsettings:'onApplyPivotSettings'}}])},getAllFieldsContainer:function(){return this.lookup('fieldsCt')},getAllFieldsHeader:function(){return this.getAllFieldsContainer().getHeader()},setAllFieldsContainerVisible:function(a){this.getAllFieldsContainer().setHidden(!a)},getLeftAxisContainer:function(){return this.lookup('fieldsLeftCt')},getLeftAxisHeader:function(){return this.getLeftAxisContainer().getHeader()},setLeftAxisContainerVisible:function(a){this.getLeftAxisContainer().setHidden(!a)},getTopAxisContainer:function(){return this.lookup('fieldsTopCt')},getTopAxisHeader:function(){return this.getTopAxisContainer().getHeader()},setTopAxisContainerVisible:function(a){this.getTopAxisContainer().setHidden(!a)},getAggregateContainer:function(){return this.lookup('fieldsAggCt')},getAggregateHeader:function(){return this.getAggregateContainer().getHeader()},setAggregateContainerVisible:function(a){this.getAggregateContainer().setHidden(!a)}});Ext.define('Ext.pivot.plugin.Configurator',{extend:'Ext.plugin.Abstract',requires:['Ext.util.Collection','Ext.pivot.plugin.configurator.Panel'],alias:'plugin.pivotconfigurator',config:{fields:[],width:400,panel:{lazy:!0,$value:{xtype:'pivotconfigpanel',hidden:!0,floated:!0,modal:!0,hideOnMaskTap:!0,right:0,height:'100%'}},pivot:null},init:function(a){this.setPivot(a)},destroy:function(){this.setConfig({pivot:null,panel:null});this.callParent()},enable:function(){this.disabled=!1;this.showConfigurator()},disable:function(){this.disabled=!0;this.hideConfigurator()},applyPanel:function(a,b){if(a){a=a.isInstance?a:Ext.create(a)}return a},updatePanel:function(a,d){var b=this,c=this.getPivot();Ext.destroy(d,b.panelListeners);if(a){b.panelListeners=a.on({hiddenchange:'onPanelHiddenChange',close:'hideConfigurator',scope:b,destroyable:!0});a.setConfig({pivot:c,fields:b.getFields()});c.add(a)}},onPanelHiddenChange:function(b,a){this.getPivot().fireEvent(a?'hideconfigpanel':'showconfigpanel',b)},updatePivot:function(b,c){var a=this;Ext.destroy(a.pivotListeners);if(c){c.showConfigurator=c.hideConfigurator=null}if(b){b.showConfigurator=Ext.bind(a.showConfigurator,a);b.hideConfigurator=Ext.bind(a.hideConfigurator,a);if(b.initialized){a.onPivotInitialized()}else {b.on({initialize:'onPivotInitialized',single:!0,scope:a})}}},getWidth:function(){var c=this.getPivot(),b=Ext.Viewport,a=100;if(c&&c.element){a=c.element.getWidth()}if(b){a=Math.min(a,b.element.getHeight(),b.element.getWidth())}return Ext.Number.constrain(this._width,100,a)},onPivotInitialized:function(){var h=this,m=h.getPivot(),d=h.getFields(),g=m.getMatrix(),p=m.getHeaderContainer&&m.getHeaderContainer(),k=[],i={},o=!1,n,c,f,j,e,b,a,l;if(d.length===0&&g instanceof Ext.pivot.matrix.Local){o=!0;n=g.store;c=n?n.model.getFields():[];e=c.length;for(b=0;b<e;b++){j=c[b].getName();if(!d.byDataIndex.get(j)){d.add({header:Ext.String.capitalize(j),dataIndex:j})}}}c=Ext.Array.merge(g.leftAxis.dimensions.getRange(),g.topAxis.dimensions.getRange(),g.aggregate.getRange());e=c.length;for(b=0;b<e;b++){a=c[b].getConfig();delete (a.matrix);delete (a.values);delete (a.id);f=d.byDataIndex.get(a.dataIndex);if(!f){d.add(a)}else if(o){if(!i[a.dataIndex]){i[a.dataIndex]=0}delete (a.header);i[a.dataIndex]++;k.push(a)}}e=k.length;for(b=0;b<e;b++){a=k[b];if(i[a.dataIndex]===1){f=d.byDataIndex.get(a.dataIndex);if(f){l=f.getConfig();Ext.merge(l,a);f.setConfig(l)}}}h.isReady=!0;h.doneSetup=!1;if(p){h.pivotListeners=p.renderElement.on({longpress:'showConfigurator',scope:this})}},hideConfigurator:function(){var a=this.getPanel();if(a){a.hide()}},showConfigurator:function(){var a=this.getPanel();if(a){a.setWidth(this.getWidth());a.show()}},getFields:function(){var a=this._fields;if(!a){a=new Ext.util.Collection({extraKeys:{byDataIndex:'dataIndex'},decoder:function(a){return (a&&a.isField)?a:new Ext.pivot.plugin.configurator.Field(a||{})}});this.setFields(a)}return a},applyFields:function(a,b){if(a==null||(a&&a.isCollection)){return a}if(a){if(!b){b=this.getFields()}b.splice(0,b.length,a)}return b},deprecated:{'6.5':{configs:{panelWrapper:null,panelWrap:null}}}});Ext.define('Ext.pivot.plugin.DrillDown',{alias:['plugin.pivotdrilldown'],extend:'Ext.plugin.Abstract',requires:['Ext.pivot.Grid','Ext.Panel','Ext.layout.Fit','Ext.TitleBar','Ext.Button','Ext.data.proxy.Memory','Ext.data.Store','Ext.grid.plugin.PagingToolbar'],config:{columns:null,width:500,pageSize:25,remoteStore:null,panel:{lazy:!0,$value:{xtype:'panel',hidden:!0,floated:!0,modal:!0,hideOnMaskTap:!0,right:0,height:'100%',showAnimation:{type:'slideIn',duration:250,easing:'ease-out',direction:'left'},hideAnimation:{type:'slideOut',duration:250,easing:'ease-in',direction:'right'},layout:'fit',items:[{docked:'top',xtype:'titlebar',itemId:'title',items:{xtype:'button',text:'Done',ui:'action',align:'right',itemId:'done'}},{xtype:'grid',itemId:'grid',plugins:{gridpagingtoolbar:!0}}]}},pivot:null},titleText:'Drill down',doneText:'Done',init:function(a){this.setPivot(a);return this.callParent([a])},destroy:function(){this.setConfig({pivot:null,panel:null});this.callParent()},updatePivot:function(a){Ext.destroy(this.gridListeners);if(a){this.gridListeners=a.on({pivotitemcelldoubletap:'showPanel',pivotgroupcelldoubletap:'showPanel',pivottotalcelldoubletap:'showPanel',scope:this,destroyable:!0})}},applyPanel:function(a,b){if(a){a=a.isInstance?a:Ext.create(a)}return a},updatePanel:function(b,c){var a=this,d=this.getPivot();Ext.destroy(c,a.panelListeners,a.buttonListeners);if(b){a.panelListeners=b.on({hiddenchange:'onPanelHiddenChange',scope:a,destroyable:!0});b.down('#title').setTitle(a.titleText);a.buttonListeners=b.down('#done').on({tap:'hidePanel',scope:a,destroyable:!0});a.initializeStoreAndColumns();d.add(b)}},initializeStoreAndColumns:function(){var b=this,i=b.getPanel(),g=b.getPivot().getMatrix(),f=Ext.Array.from(b.getColumns()||[]),e=b.getPageSize(),c,a,d,k,h,j;if(!g||!i||!(j=i.down('#grid'))){return}if(g.isLocalMatrix){c=g.store.model.getFields();a=new Ext.data.Store({pageSize:e,fields:Ext.clone(c),proxy:{type:'memory',enablePaging:(e>0),reader:{type:'array'}}});if(f.length===0){k=c.length;for(d=0;d<k;d++){h=c[d];f.push({text:Ext.String.capitalize(h.name),dataIndex:h.name,xtype:'column'})}}}else {a=Ext.getStore(b.getRemoteStore());if(a&&a.isStore){a.setPageSize(e);a.setRemoteFilter(!0)}}j.setConfig({store:a,columns:f})},onPanelHiddenChange:function(b,a){this.getPivot().fireEvent(a?'hidedrilldownpanel':'showdrilldownpanel',b)},getWidth:function(){var c=this.getPivot(),b=Ext.Viewport,a=100;if(c&&c.element){a=c.element.getWidth()}if(b){a=Math.min(a,b.element.getHeight(),b.element.getWidth())}return Ext.Number.constrain(this._width,100,a)},showPanel:function(g){var c=this,d=c.getPanel(),f=c.getPivot().getMatrix(),a,h,b,e;if(c.disabled){return}a=f.results.get(g.leftKey,g.topKey);if(!a||!d||!(h=d.down('#grid'))){return}b=h.getStore();if(f.isLocalMatrix){b.getProxy().setData(a.records);b.loadPage(1)}else {e=Ext.Array.merge(c.getFiltersFromParams(a.getLeftAxisItem()?a.getLeftAxisItem().data:{}),c.getFiltersFromParams(a.getTopAxisItem()?a.getTopAxisItem().data:{}));b.clearFilter(!0);if(e.length>0){b.addFilter(e)}else {b.load()}}d.setWidth(c.getWidth());d.show()},hidePanel:function(){var a=this.getPanel();if(a){a.hide()}},getFiltersFromParams:function(c){var d=[],a,e,b;if(Ext.isObject(c)){b=Ext.Object.getKeys(c);e=b.length;for(a=0;a<e;a++){d.push({property:b[a],exactMatch:!0,value:c[b[a]]})}}return d}});Ext.define('Ext.pivot.plugin.rangeeditor.PanelController',{extend:'Ext.app.ViewController',alias:'controller.pivotrangeeditor',applySettings:function(){var a=this.getViewModel().get('form'),c=Ext.bind(this.cancelSettings,this),b;if(a&&a.type&&a.type.isModel){a.type=a.type.get('value')}b=Ext.Factory.pivotupdate(a);this.updaterListeners=this.getView().relayEvents(b,['beforeupdate','update']);b.update().then(c,c)},cancelSettings:function(){var a=this.getView();this.updaterListeners=Ext.destroy(this.updaterListeners);a.fireEvent('close',a)}});Ext.define('Ext.pivot.plugin.rangeeditor.Panel',{extend:'Ext.form.Panel',requires:['Ext.pivot.plugin.rangeeditor.PanelController','Ext.form.FieldSet','Ext.field.Select','Ext.field.Number','Ext.layout.VBox','Ext.TitleBar','Ext.Button'],xtype:'pivotrangeeditor',controller:'pivotrangeeditor',viewModel:{stores:{sTypes:{type:'array',fields:['value','text'],autoDestroy:!0}}},showAnimation:{type:'slideIn',duration:250,easing:'ease-out',direction:'left'},hideAnimation:{type:'slideOut',duration:250,easing:'ease-in',direction:'right'},titleText:'Range editor',valueText:'Value',fieldText:'Source field is "{form.dataIndex}"',typeText:'Type',okText:'Ok',cancelText:'Cancel',initialize:function(){var a=this;a.add([{xtype:'titlebar',docked:'top',title:a.titleText,titleAlign:'left',items:[{text:a.cancelText,align:'right',ui:'alt',handler:'cancelSettings'},{text:a.okText,align:'right',ui:'alt',handler:'applySettings',margin:'0 0 0 5'}]},{xtype:'fieldset',bind:{instructions:a.fieldText},defaults:{labelAlign:'top'},items:[{label:a.typeText,xtype:'selectfield',autoSelect:!1,useClearIcon:!0,bind:{store:'{sTypes}',value:'{form.type}'}},{label:a.valueText,xtype:'numberfield',bind:'{form.value}'}]}]);return a.callParent()}});Ext.define('Ext.pivot.plugin.RangeEditor',{alias:['plugin.pivotrangeeditor'],extend:'Ext.plugin.Abstract',requires:['Ext.pivot.Grid','Ext.pivot.plugin.rangeeditor.Panel','Ext.Panel','Ext.layout.Fit','Ext.pivot.update.Increment','Ext.pivot.update.Overwrite','Ext.pivot.update.Percentage','Ext.pivot.update.Uniform'],config:{updaters:[['percentage','Percentage'],['increment','Increment'],['overwrite','Overwrite'],['uniform','Uniform']],defaultUpdater:'uniform',width:400,panel:{lazy:!0,$value:{xtype:'pivotrangeeditor',hidden:!0,floated:!0,modal:!0,hideOnMaskTap:!0,right:0,height:'100%'}},pivot:null},init:function(a){this.setPivot(a);return this.callParent([a])},destroy:function(){this.setConfig({pivot:null,panel:null});this.callParent()},applyPanel:function(a,b){if(a){a=a.isInstance?a:Ext.create(a)}return a},updatePanel:function(a,d){var b=this,c=this.getPivot();Ext.destroy(d,b.panelListeners);if(a){b.panelListeners=a.on({hiddenchange:'onPanelHiddenChange',close:'hidePanel',scope:b,destroyable:!0});a.getViewModel().getStore('sTypes').loadData(b.getUpdaters());c.relayEvents(a,['beforeupdate','update'],'pivot');c.add(a)}},onPanelHiddenChange:function(b,a){this.getPivot().fireEvent(a?'hiderangeeditorpanel':'showrangeeditorpanel',b)},updatePivot:function(b,c){var a=this;Ext.destroy(a.gridListeners);if(b){a.gridListeners=b.on({pivotitemcelldoubletap:'showPanel',pivotgroupcelldoubletap:'showPanel',pivottotalcelldoubletap:'showPanel',scope:a,destroyable:!0})}},getWidth:function(){var c=this.getPivot(),b=Ext.Viewport,a=100;if(c&&c.element){a=c.element.getWidth()}if(b){a=Math.min(a,b.element.getHeight(),b.element.getWidth())}return Ext.Number.constrain(this._width,100,a)},showPanel:function(a,k,j){var b=this,i=b.getPivot(),c=b.getPanel(),g=i.getMatrix(),h,d,e,f;if(b.disabled){return}d=g.results.get(a.leftKey,a.topKey);if(!d||!c){return}h=c.getViewModel();e=a.column;f=e.dimension.getDataIndex();h.set('form',{leftKey:a.leftKey,topKey:a.topKey,dataIndex:f,value:d.getValue(e.dimension.getId()),type:b.getDefaultUpdater(),matrix:g});c.setWidth(b.getWidth());c.show()},hidePanel:function(){var a=this.getPanel();if(a){a.hide()}},deprecated:{'6.5':{configs:{panelWrapper:null,panelWrap:null}}}});